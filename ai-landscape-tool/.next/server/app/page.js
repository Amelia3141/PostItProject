(()=>{var e={};e.id=931,e.ids=[931],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},1808:e=>{"use strict";e.exports=require("net")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},1267:e=>{"use strict";e.exports=require("worker_threads")},9555:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GlobalError:()=>o.a,__next_app__:()=>d,originalPathname:()=>h,pages:()=>u,routeModule:()=>f,tree:()=>c});var r=n(482),i=n(9108),s=n(2563),o=n.n(s),a=n(8300),l={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>a[e]);n.d(t,l);let c=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(n.bind(n,1136)),"/Users/ameliag/Downloads/ai-landscape-tool/ai-landscape-tool/src/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(n.bind(n,1342)),"/Users/ameliag/Downloads/ai-landscape-tool/ai-landscape-tool/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(n.t.bind(n,9361,23)),"next/dist/client/components/not-found-error"]}],u=["/Users/ameliag/Downloads/ai-landscape-tool/ai-landscape-tool/src/app/page.tsx"],h="/page",d={require:n,loadChunk:()=>Promise.resolve()},f=new r.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},5857:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,2583,23)),Promise.resolve().then(n.t.bind(n,6840,23)),Promise.resolve().then(n.t.bind(n,8771,23)),Promise.resolve().then(n.t.bind(n,3225,23)),Promise.resolve().then(n.t.bind(n,9295,23)),Promise.resolve().then(n.t.bind(n,3982,23))},5766:()=>{},2521:(e,t,n)=>{Promise.resolve().then(n.bind(n,3531))},1633:(e,t,n)=>{"use strict";var r=n(2781).Stream,i=n(3837),s=n(6778),o=n(3355),a=n(490),l=n(8435),c=n(1436),u=function(e,t,n){this.writable=!0,n=n||{},this._stream=t.socket,this._ping=n.ping||this.DEFAULT_PING,this._retry=n.retry||this.DEFAULT_RETRY;var r=s.isSecureRequest(e)?"https:":"http:";this.url=r+"//"+e.headers.host+e.url,this.lastEventId=e.headers["last-event-id"]||"",this.readyState=a.CONNECTING;var i=new o,l=this;if(n.headers)for(var c in n.headers)i.set(c,n.headers[c]);if(this._stream&&this._stream.writable){process.nextTick(function(){l._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var u="HTTP/1.1 200 OK\r\nContent-Type: text/event-stream\r\nCache-Control: no-cache, no-store\r\nConnection: close\r\n"+i.toString()+"\r\nretry: "+Math.floor(1e3*this._retry)+"\r\n\r\n";this._write(u),this._stream.on("drain",function(){l.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){l.ping()},1e3*this._ping)),["error","end"].forEach(function(e){l._stream.on(e,function(){l.close()})})}};i.inherits(u,r),u.isEventSource=function(e){return"GET"===e.method&&(e.headers.accept||"").split(/\s*,\s*/).indexOf("text/event-stream")>=0};var h={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(e){if(!this.writable)return!1;try{return this._stream.write(e,"utf8")}catch(e){return!1}},_open:function(){if(this.readyState===a.CONNECTING){this.readyState=a.OPEN;var e=new c("open");e.initEvent("open",!1,!1),this.dispatchEvent(e)}},write:function(e){return this.send(e)},end:function(e){void 0!==e&&this.write(e),this.close()},send:function(e,t){if(this.readyState>a.OPEN)return!1;e=String(e).replace(/(\r\n|\r|\n)/g,"$1data: ");var n="";return(t=t||{}).event&&(n+="event: "+t.event+"\r\n"),t.id&&(n+="id: "+t.id+"\r\n"),n+="data: "+e+"\r\n\r\n",this._write(n)},ping:function(){return this._write(":\r\n\r\n")},close:function(){if(this.readyState>a.OPEN)return!1;this.readyState=a.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var e=new c("close");return e.initEvent("close",!1,!1),this.dispatchEvent(e),!0}};for(var d in h)u.prototype[d]=h[d];for(var f in l)u.prototype[f]=l[f];e.exports=u},1453:(e,t,n)=>{"use strict";var r=n(3837),i=n(6778),s=n(490),o=function(e,t,n,r,o){o=o||{},this._stream=t,this._driver=i.http(e,{maxLength:o.maxLength,protocols:r});var a=this;if(this._stream&&this._stream.writable){if(!this._stream.readable)return this._stream.end();var l=function(){a._stream.removeListener("data",l)};this._stream.on("data",l),s.call(this,o),process.nextTick(function(){a._driver.start(),a._driver.io.write(n)})}};r.inherits(o,s),o.isWebSocket=function(e){return i.isWebSocket(e)},o.validateOptions=function(e,t){i.validateOptions(e,t)},o.WebSocket=o,o.Client=n(9131),o.EventSource=n(1633),e.exports=o},490:(e,t,n)=>{"use strict";var r=n(2781).Stream,i=n(3837),s=n(6778),o=n(8435),a=n(1436),l=function(e){e=e||{},s.validateOptions(e,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var t=e.headers;if(t)for(var n in t)this._driver.setHeader(n,t[n]);var r=e.extensions;r&&[].concat(r).forEach(this._driver.addExtension,this._driver),this._ping=e.ping,this._pingId=0,this.readyState=l.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var i=this;this._driver.on("open",function(e){i._open()}),this._driver.on("message",function(e){i._receiveMessage(e.data)}),this._driver.on("close",function(e){i._beginClose(e.reason,e.code)}),this._driver.on("error",function(e){i._emitError(e.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){i.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){i._pingId+=1,i.ping(i._pingId.toString())},1e3*this._ping)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))};i.inherits(l,r),l.CONNECTING=0,l.OPEN=1,l.CLOSING=2,l.CLOSED=3,l.CLOSE_TIMEOUT=3e4;var c={write:function(e){return this.send(e)},end:function(e){void 0!==e&&this.send(e),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(e){return!(this.readyState>l.OPEN)&&(e instanceof Buffer||(e=String(e)),this._driver.messages.write(e))},ping:function(e,t){return!(this.readyState>l.OPEN)&&this._driver.ping(e,t)},close:function(e,t){if(void 0===e&&(e=1e3),void 0===t&&(t=""),1e3!==e&&(e<3e3||e>4999))throw Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+e+" is neither.");if(this.readyState<l.CLOSING){var n=this;this._closeTimer=setTimeout(function(){n._beginClose("",1006)},l.CLOSE_TIMEOUT)}this.readyState!==l.CLOSED&&(this.readyState=l.CLOSING),this._driver.close(t,e)},_configureStream:function(){var e=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(t){this._stream.on(t,function(){e._finalizeClose()})},this),this._stream.on("error",function(t){e._emitError("Network error: "+e.url+": "+t.message),e._finalizeClose()})},_open:function(){if(this.readyState===l.CONNECTING){this.readyState=l.OPEN,this.protocol=this._driver.protocol||"";var e=new a("open");e.initEvent("open",!1,!1),this.dispatchEvent(e)}},_receiveMessage:function(e){if(this.readyState>l.OPEN)return!1;this.readable&&this.emit("data",e);var t=new a("message",{data:e});t.initEvent("message",!1,!1),this.dispatchEvent(t)},_emitError:function(e){if(!(this.readyState>=l.CLOSING)){var t=new a("error",{message:e});t.initEvent("error",!1,!1),this.dispatchEvent(t)}},_beginClose:function(e,t){this.readyState!==l.CLOSED&&(this.readyState=l.CLOSING,this._closeParams=[e,t],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==l.CLOSED){this.readyState=l.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var e=this._closeParams?this._closeParams[0]:"",t=new a("close",{code:this._closeParams?this._closeParams[1]:1006,reason:e});t.initEvent("close",!1,!1),this.dispatchEvent(t)}}};for(var u in c)l.prototype[u]=c[u];for(var h in o)l.prototype[h]=o[h];e.exports=l},1436:e=>{"use strict";var t=function(e,t){for(var n in this.type=e,t)this[n]=t[n]};t.prototype.initEvent=function(e,t,n){this.type=e,this.bubbles=t,this.cancelable=n},t.prototype.stopPropagation=function(){},t.prototype.preventDefault=function(){},t.CAPTURING_PHASE=1,t.AT_TARGET=2,t.BUBBLING_PHASE=3,e.exports=t},8435:(e,t,n)=>{"use strict";var r=n(1436);e.exports={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(e,t,n){this.on(e,t)},removeEventListener:function(e,t,n){this.removeListener(e,t)},dispatchEvent:function(e){e.target=e.currentTarget=this,e.eventPhase=r.AT_TARGET,this["on"+e.type]&&this["on"+e.type](e),this.emit(e.type,e)}}},9131:(e,t,n)=>{"use strict";var r=n(3837),i=n(1808),s=n(4404),o=n(7310),a=n(6778),l=n(490);n(1436);var c={"http:":80,"https:":443,"ws:":80,"wss:":443},u=["https:","wss:"],h=function(e,t,n){n=n||{},this.url=e,this._driver=a.client(this.url,{maxLength:n.maxLength,protocols:t}),["open","error"].forEach(function(e){this._driver.on(e,function(){y.headers=y._driver.headers,y.statusCode=y._driver.statusCode})},this);var r=n.proxy||{},h=o.parse(r.origin||this.url),d=h.port||c[h.protocol],f=u.indexOf(h.protocol)>=0,p=function(){y._onConnect()},g=n.net||{},m=n.tls||{},_=r.origin?r.tls||{}:m,y=this;g.host=_.host=h.hostname,g.port=_.port=d,m.ca=m.ca||n.ca,_.servername=_.servername||h.hostname,this._stream=f?s.connect(_,p):i.connect(g,p),r.origin&&this._configureProxy(r,m),l.call(this,n)};r.inherits(h,l),h.prototype._onConnect=function(){(this._proxy||this._driver).start()},h.prototype._configureProxy=function(e,t){var n,r=o.parse(this.url),i=u.indexOf(r.protocol)>=0,a=this;if(this._proxy=this._driver.proxy(e.origin),e.headers)for(n in e.headers)this._proxy.setHeader(n,e.headers[n]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(i){var e={socket:a._stream,servername:r.hostname};for(n in t)e[n]=t[n];a._stream=s.connect(e),a._configureStream()}a._driver.io.pipe(a._stream),a._stream.pipe(a._driver.io),a._driver.start()}),this._proxy.on("error",function(e){a._driver.emit("error",e)})},e.exports=h},2735:(e,t)=>{function n(e){if(void 0!==e&&e!==n.REQUEST&&e!==n.RESPONSE)throw Error("type must be REQUEST or RESPONSE");void 0===e||this.initialize(e),this.maxHeaderSize=n.maxHeaderSize}t.m=n,n.prototype.initialize=function(e,t){if(e!==n.REQUEST&&e!==n.RESPONSE)throw Error("type must be REQUEST or RESPONSE");this.type=e,this.state=e+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1},n.encoding="ascii",n.maxHeaderSize=81920,n.REQUEST="REQUEST",n.RESPONSE="RESPONSE";var r=n.kOnHeaders=1,i=n.kOnHeadersComplete=2,s=n.kOnBody=3,o=n.kOnMessageComplete=4;n.prototype[r]=n.prototype[i]=n.prototype[s]=n.prototype[o]=function(){};var a=!0;Object.defineProperty(n,"kOnExecute",{get:function(){return a=!1,99}});var l=n.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"],c=l.indexOf("CONNECT");n.prototype.reinitialize=n,n.prototype.close=n.prototype.pause=n.prototype.resume=n.prototype.remove=n.prototype.free=function(){},n.prototype._compatMode0_11=!1,n.prototype.getAsyncId=function(){return 0};var u={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};n.prototype.execute=function(e,t,r){if(!(this instanceof n))throw TypeError("not a HTTPParser");t=t||0,r="number"==typeof r?r:e.length,this.chunk=e,this.offset=t;var i=this.end=t+r;try{for(;this.offset<i&&!this[this.state](););}catch(e){if(this.isUserCall)throw e;return this.hadError=!0,e}return(this.chunk=null,r=this.offset-t,u[this.state]&&(this.headerSize+=r,this.headerSize>(this.maxHeaderSize||n.maxHeaderSize)))?Error("max header size exceeded"):r};var h={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};n.prototype.finish=function(){if(!this.hadError){if(!h[this.state])return Error("invalid state for EOF");"BODY_RAW"===this.state&&this.userCall()(this[o]())}},n.prototype.consume=n.prototype.unconsume=n.prototype.getCurrentBuffer=function(){},n.prototype.userCall=function(){this.isUserCall=!0;var e=this;return function(t){return e.isUserCall=!1,t}},n.prototype.nextRequest=function(){this.userCall()(this[o]()),this.reinitialize(this.type)},n.prototype.consumeLine=function(){for(var e=this.end,t=this.chunk,r=this.offset;r<e;r++)if(10===t[r]){var i=this.line+t.toString(n.encoding,this.offset,r);return"\r"===i.charAt(i.length-1)&&(i=i.substr(0,i.length-1)),this.line="",this.offset=r+1,i}this.line+=t.toString(n.encoding,this.offset,this.end),this.offset=this.end};var d=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,f=/^[ \t]+(.*[^ \t])/;n.prototype.parseHeader=function(e,t){if(-1!==e.indexOf("\r"))throw m("HPE_LF_EXPECTED");var n=d.exec(e),r=n&&n[1];if(r)t.push(r),t.push(n[2]);else{var i=f.exec(e);i&&t.length&&(t[t.length-1]&&(t[t.length-1]+=" "),t[t.length-1]+=i[1])}};var p=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;n.prototype.REQUEST_LINE=function(){var e=this.consumeLine();if(e){var t=p.exec(e);if(null===t)throw m("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?t[1]:l.indexOf(t[1]),-1===this.info.method)throw Error("invalid request method");this.info.url=t[2],this.info.versionMajor=+t[3],this.info.versionMinor=+t[4],this.body_bytes=0,this.state="HEADER"}};var g=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;function m(e){var t=Error("Parse Error");return t.code=e,t}n.prototype.RESPONSE_LINE=function(){var e=this.consumeLine();if(e){var t=g.exec(e);if(null===t)throw m("HPE_INVALID_CONSTANT");this.info.versionMajor=+t[1],this.info.versionMinor=+t[2];var n=this.info.statusCode=+t[3];this.info.statusMessage=t[4],((n/100|0)==1||204===n||304===n)&&(this.body_bytes=0),this.state="HEADER"}},n.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(-1!==this.connection.indexOf("close"))return!1}else if(-1===this.connection.indexOf("keep-alive"))return!1;return null!==this.body_bytes||!!this.isChunked},n.prototype.HEADER=function(){var e=this.consumeLine();if(void 0!==e){var t=this.info;if(e)this.parseHeader(e,t.headers);else{for(var r,s,o=t.headers,l=!1,u=!1,h=0;h<o.length;h+=2)switch(o[h].toLowerCase()){case"transfer-encoding":this.isChunked="chunked"===o[h+1].toLowerCase();break;case"content-length":if(r=+o[h+1],l){if(r!==this.body_bytes)throw m("HPE_UNEXPECTED_CONTENT_LENGTH")}else l=!0,this.body_bytes=r;break;case"connection":this.connection+=o[h+1].toLowerCase();break;case"upgrade":u=!0}if(this.isChunked&&l&&(l=!1,this.body_bytes=null),u&&-1!=this.connection.indexOf("upgrade")?t.upgrade=this.type===n.REQUEST||101===t.statusCode:t.upgrade=t.method===c,this.isChunked&&t.upgrade&&(this.isChunked=!1),t.shouldKeepAlive=this.shouldKeepAlive(),2===(s=a?this.userCall()(this[i](t)):this.userCall()(this[i](t.versionMajor,t.versionMinor,t.headers,t.method,t.url,t.statusCode,t.statusMessage,t.upgrade,t.shouldKeepAlive))))return this.nextRequest(),!0;if(this.isChunked&&!s)this.state="BODY_CHUNKHEAD";else{if(s||0===this.body_bytes)return this.nextRequest(),t.upgrade;null===this.body_bytes?this.state="BODY_RAW":this.state="BODY_SIZED"}}}},n.prototype.BODY_CHUNKHEAD=function(){var e=this.consumeLine();void 0!==e&&(this.body_bytes=parseInt(e,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")},n.prototype.BODY_CHUNK=function(){var e=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[s](this.chunk.slice(this.offset,this.offset+e),0,e)),this.offset+=e,this.body_bytes-=e,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")},n.prototype.BODY_CHUNKEMPTYLINE=function(){var e=this.consumeLine();if(void 0!==e){if(""!==e)throw Error("Expected empty line");this.state="BODY_CHUNKHEAD"}},n.prototype.BODY_CHUNKTRAILERS=function(){var e=this.consumeLine();void 0!==e&&(e?this.parseHeader(e,this.trailers):(this.trailers.length&&this.userCall()(this[r](this.trailers,"")),this.nextRequest()))},n.prototype.BODY_RAW=function(){this.userCall()(this[s](this.chunk.slice(this.offset,this.end),0,this.end-this.offset)),this.offset=this.end},n.prototype.BODY_SIZED=function(){var e=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[s](this.chunk.slice(this.offset,this.offset+e),0,e)),this.offset+=e,this.body_bytes-=e,this.body_bytes||this.nextRequest()},["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(e){var t=n["kOn"+e];Object.defineProperty(n.prototype,"on"+e,{get:function(){return this[t]},set:function(e){return this._compatMode0_11=!0,c="CONNECT",this[t]=e}})})},2295:(e,t,n)=>{"use strict";e.exports=n(6372).vendored["react-ssr"].ReactJsxRuntime},5299:(e,t,n)=>{/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var r=n(4300),i=r.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(s(r,t),t.Buffer=o),o.prototype=Object.create(i.prototype),s(i,o),o.from=function(e,t,n){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return r.SlowBuffer(e)}},80:(e,t,n)=>{"use strict";/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(3729);"function"==typeof Object.is&&Object.is,r.useState,r.useEffect,r.useLayoutEffect,r.useDebugValue,t.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:function(e,t){return t()}},7986:(e,t,n)=>{"use strict";/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(3729),i=n(8145),s="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=i.useSyncExternalStore,a=r.useRef,l=r.useEffect,c=r.useMemo,u=r.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,r,i){var h=a(null);if(null===h.current){var d={hasValue:!1,value:null};h.current=d}else d=h.current;var f=o(e,(h=c(function(){function e(e){if(!l){if(l=!0,o=e,e=r(e),void 0!==i&&d.hasValue){var t=d.value;if(i(t,e))return a=t}return a=e}if(t=a,s(o,e))return t;var n=r(e);return void 0!==i&&i(t,n)?(o=e,t):(o=e,a=n)}var o,a,l=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,n,r,i]))[0],h[1]);return l(function(){d.hasValue=!0,d.value=f},[f]),u(f),f}},8145:(e,t,n)=>{"use strict";e.exports=n(80)},4657:(e,t,n)=>{"use strict";e.exports=n(7986)},6778:(e,t,n)=>{"use strict";var r=n(533),i=n(5409),s=n(9588);e.exports={client:function(e,t){return void 0===(t=t||{}).masking&&(t.masking=!0),new i(e,t)},server:function(e){return void 0===(e=e||{}).requireMasking&&(e.requireMasking=!0),new s(e)},http:function(){return s.http.apply(s,arguments)},isSecureRequest:function(e){return s.isSecureRequest(e)},isWebSocket:function(e){return r.isWebSocket(e)},validateOptions:function(e,t){r.validateOptions(e,t)}}},533:(e,t,n)=>{"use strict";var r=n(5299).Buffer,i=n(2361).EventEmitter,s=n(3837),o=n(5340),a=n(3355),l=n(1162),c=function(e,t,n){i.call(this),c.validateOptions(n||{},["maxLength","masking","requireMasking","protocols"]),this._request=e,this._reader=new l,this._options=n||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new a,this.__queue=[],this.readyState=0,this.url=t,this.io=new o.IO(this),this.messages=new o.Messages(this),this._bindEventListeners()};s.inherits(c,i),c.isWebSocket=function(e){var t=e.headers.connection||"",n=e.headers.upgrade||"";return"GET"===e.method&&t.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&"websocket"===n.toLowerCase()},c.validateOptions=function(e,t){for(var n in e)if(0>t.indexOf(n))throw Error("Unrecognized option: "+n)};var u={MAX_LENGTH:67108863,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var e=this;this.messages.on("error",function(){}),this.on("message",function(t){var n=e.messages;n.readable&&n.emit("data",t.data)}),this.on("error",function(t){var n=e.messages;n.readable&&n.emit("error",t)}),this.on("close",function(){var t=e.messages;t.readable&&(t.readable=t.writable=!1,t.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(e){return!1},setHeader:function(e,t){return!(this.readyState>0)&&(this._headers.set(e,t),!0)},start:function(){var e;if(0!==this.readyState)return!1;if(!c.isWebSocket(this._request))return this._failHandshake(Error("Not a WebSocket request"));try{e=this._handshakeResponse()}catch(e){return this._failHandshake(e)}return this._write(e),-1!==this._stage&&this._open(),!0},_failHandshake:function(e){var t=new a;return t.set("Content-Type","text/plain"),t.set("Content-Length",r.byteLength(e.message,"utf8")),t=["HTTP/1.1 400 Bad Request",t.toString(),e.message],this._write(r.from(t.join("\r\n"),"utf8")),this._fail("protocol_error",e.message),!1},text:function(e){return this.frame(e)},binary:function(e){return!1},ping:function(){return!1},pong:function(){return!1},close:function(e,t){return 1===this.readyState&&(this.readyState=3,this.emit("close",new c.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(e){this.frame.apply(this,e)},this),this.__queue=[],this.emit("open",new c.OpenEvent)},_queue:function(e){return this.__queue.push(e),!0},_write:function(e){var t=this.io;t.readable&&t.emit("data",e)},_fail:function(e,t){this.readyState=2,this.emit("error",Error(t)),this.close()}};for(var h in u)c.prototype[h]=u[h];c.ConnectEvent=function(){},c.OpenEvent=function(){},c.CloseEvent=function(e,t){this.code=e,this.reason=t},c.MessageEvent=function(e){this.data=e},c.PingEvent=function(e){this.data=e},c.PongEvent=function(e){this.data=e},e.exports=c},5409:(e,t,n)=>{"use strict";var r=n(5299).Buffer,i=n(6113),s=n(7310),o=n(3837),a=n(3515),l=n(533),c=n(8388),u=n(4887),h=function(e,t){this.version="hybi-"+c.VERSION,c.call(this,null,e,t),this.readyState=-1,this._key=h.generateKey(),this._accept=c.generateAccept(this._key),this._http=new a("response");var n=s.parse(this.url),i=n.auth&&r.from(n.auth,"utf8").toString("base64");if(0>this.VALID_PROTOCOLS.indexOf(n.protocol))throw Error(this.url+" is not a valid WebSocket URL");this._pathname=(n.pathname||"/")+(n.search||""),this._headers.set("Host",n.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",c.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),i&&this._headers.set("Authorization","Basic "+i)};o.inherits(h,c),h.generateKey=function(){return i.randomBytes(16).toString("base64")};var d={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(e,t){return new u(this,e,t)},start:function(){return -1===this.readyState&&(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(e){if(3!==this.readyState){if(this.readyState>0)return c.prototype.parse.call(this,e);this._http.parse(e),this._http.isComplete()&&(this._validateHandshake(),3!==this.readyState&&(this._open(),this.parse(this._http.body)))}},_handshakeRequest:function(){var e=this._extensions.generateOffer();e&&this._headers.set("Sec-WebSocket-Extensions",e);var t=["GET "+this._pathname+" HTTP/1.1",this._headers.toString(),""];return r.from(t.join("\r\n"),"utf8")},_failHandshake:function(e){e="Error during WebSocket handshake: "+e,this.readyState=3,this.emit("error",Error(e)),this.emit("close",new l.CloseEvent(this.ERRORS.protocol_error,e))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(101!==this._http.statusCode)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var e=this._http.headers,t=e.upgrade||"",n=e.connection||"",r=e["sec-websocket-accept"]||"",i=e["sec-websocket-protocol"]||"";if(""===t)return this._failHandshake("'Upgrade' header is missing");if("websocket"!==t.toLowerCase())return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(""===n)return this._failHandshake("'Connection' header is missing");if("upgrade"!==n.toLowerCase())return this._failHandshake("'Connection' header value is not 'Upgrade'");if(r!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,""!==i){if(0>this._protocols.indexOf(i))return this._failHandshake("Sec-WebSocket-Protocol mismatch");this.protocol=i}try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(e){return this._failHandshake(e.message)}}};for(var f in d)h.prototype[f]=d[f];e.exports=h},5131:(e,t,n)=>{"use strict";var r=n(5299).Buffer,i=n(533),s=n(3837),o=function(e,t,n){i.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)};s.inherits(o,i);var a={close:function(){return 3!==this.readyState&&(this.readyState=3,this.emit("close",new i.CloseEvent(null,null)),!0)},parse:function(e){this.readyState>1||(this._reader.put(e),this._reader.eachByte(function(e){var t;switch(this._stage){case -1:this._body.push(e),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(e);break;case 1:if(this._length=(127&e)+128*this._length,this._closing&&0===this._length)return this.close();(128&e)!=128&&(0===this._length?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(255===e)this._stage=0,t=r.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new i.MessageEvent(t));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(e),this._buffer.length>this._maxLength)return this.close()}},this))},frame:function(e){if(0===this.readyState)return this._queue([e]);if(this.readyState>1)return!1;"string"!=typeof e&&(e=e.toString());var t=r.byteLength(e),n=r.allocUnsafe(t+2);return n[0]=0,n.write(e,1),n[n.length-1]=255,this._write(n),!0},_handshakeResponse:function(){var e=["HTTP/1.1 101 Web Socket Protocol Handshake",this._headers.toString(),""];return r.from(e.join("\r\n"),"utf8")},_parseLeadingByte:function(e){(128&e)==128?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(var l in a)o.prototype[l]=a[l];e.exports=o},5377:(e,t,n)=>{"use strict";var r=n(5299).Buffer,i=n(533),s=n(5131),o=n(6113),a=n(3837),l=function(e){return parseInt((e.match(/[0-9]/g)||[]).join(""),10)},c=function(e){return(e.match(/ /g)||[]).length},u=function(e,t,n){s.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)};a.inherits(u,s);var h={BODY_SIZE:8,start:function(){return!!s.prototype.start.call(this)&&(this._started=!0,this._sendHandshakeBody(),!0)},close:function(){return 3!==this.readyState&&(1===this.readyState&&this._write(r.from([255,0])),this.readyState=3,this.emit("close",new i.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var e=this._request.headers,t=e["sec-websocket-key1"],n=e["sec-websocket-key2"];if(!t)throw Error("Missing required header: Sec-WebSocket-Key1");if(!n)throw Error("Missing required header: Sec-WebSocket-Key2");var i=l(t),s=c(t),o=l(n),a=c(n);if(i%s!=0||o%a!=0)throw Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[i/s,o/a];var e=["HTTP/1.1 101 WebSocket Protocol Handshake",this._headers.toString(),""];return r.from(e.join("\r\n"),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var e=o.createHash("md5"),t=r.allocUnsafe(8+this.BODY_SIZE);return t.writeUInt32BE(this._keyValues[0],0),t.writeUInt32BE(this._keyValues[1],4),r.from(this._body).copy(t,8,0,this.BODY_SIZE),e.update(t),r.from(e.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var e=this._handshakeSignature();e&&(this._write(e),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(e){if(255!==e)return s.prototype._parseLeadingByte.call(this,e);this._closing=!0,this._length=0,this._stage=1}};for(var d in h)u.prototype[d]=h[d];e.exports=u},3355:e=>{"use strict";var t=function(){this.clear()};t.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"],t.prototype.clear=function(){this._sent={},this._lines=[]},t.prototype.set=function(e,t){if(void 0!==t){e=this._strip(e),t=this._strip(t);var n=e.toLowerCase();(!this._sent.hasOwnProperty(n)||this.ALLOWED_DUPLICATES.indexOf(n)>=0)&&(this._sent[n]=!0,this._lines.push(e+": "+t+"\r\n"))}},t.prototype.toString=function(){return this._lines.join("")},t.prototype._strip=function(e){return e.toString().replace(/^ */,"").replace(/ *$/,"")},e.exports=t},8388:(e,t,n)=>{"use strict";var r=n(5299).Buffer,i=n(6113),s=n(3837),o=n(7999),a=n(533),l=n(4643),c=n(1357),u=function(e,t,n){if(a.apply(this,arguments),this._extensions=new o,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},"string"==typeof this._protocols&&(this._protocols=this._protocols.split(/ *, */)),this._request){var r=this._request.headers["sec-websocket-protocol"],i=this._protocols;void 0!==r&&("string"==typeof r&&(r=r.split(/ *, */)),this.protocol=r.filter(function(e){return i.indexOf(e)>=0})[0]),this.version="hybi-"+u.VERSION}};s.inherits(u,a),u.VERSION="13",u.mask=function(e,t,n){if(!t||0===t.length)return e;n=n||0;for(var r=0,i=e.length-n;r<i;r++)e[n+r]=e[n+r]^t[r%4];return e},u.generateAccept=function(e){var t=i.createHash("sha1");return t.update(e+u.GUID),t.digest("base64")},u.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var h={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(e){return this._extensions.add(e),!0},parse:function(e){this._reader.put(e);for(var t=!0;t;)switch(this._stage){case 0:(t=this._reader.read(1))&&this._parseOpcode(t[0]);break;case 1:(t=this._reader.read(1))&&this._parseLength(t[0]);break;case 2:(t=this._reader.read(this._frame.lengthBytes))&&this._parseExtendedLength(t);break;case 3:(t=this._reader.read(4))&&(this._stage=4,this._frame.maskingKey=t);break;case 4:(t=this._reader.read(this._frame.length))&&(this._stage=0,this._emitFrame(t));break;default:t=null}},text:function(e){return!(this.readyState>1)&&this.frame(e,"text")},binary:function(e){return!(this.readyState>1)&&this.frame(e,"binary")},ping:function(e,t){return!(this.readyState>1)&&(e=e||"",t&&(this._pingCallbacks[e]=t),this.frame(e,"ping"))},pong:function(e){return!(this.readyState>1)&&(e=e||"",this.frame(e,"pong"))},close:function(e,t){return(e=e||"",t=t||this.ERRORS.normal_closure,this.readyState<=0)?(this.readyState=3,this.emit("close",new a.CloseEvent(t,e)),!0):1===this.readyState&&(this.readyState=2,this._extensions.close(function(){this.frame(e,"close",t)},this),!0)},frame:function(e,t,n){if(this.readyState<=0)return this._queue([e,t,n]);if(this.readyState>2)return!1;e instanceof Array&&(e=r.from(e)),"number"==typeof e&&(e=e.toString());var s,o,a=new c,u="string"==typeof e;a.rsv1=a.rsv2=a.rsv3=!1,a.opcode=this.OPCODES[t||(u?"text":"binary")],s=u?r.from(e,"utf8"):e,n&&(o=s,(s=r.allocUnsafe(2+o.length)).writeUInt16BE(n,0),o.copy(s,2)),a.data=s;var h=function(e){var t=new l;t.final=!0,t.rsv1=e.rsv1,t.rsv2=e.rsv2,t.rsv3=e.rsv3,t.opcode=e.opcode,t.masked=!!this._masking,t.length=e.data.length,t.payload=e.data,t.masked&&(t.maskingKey=i.randomBytes(4)),this._sendFrame(t)};return this.MESSAGE_OPCODES.indexOf(a.opcode)>=0?this._extensions.processOutgoingMessage(a,function(e,t){if(e)return this._fail("extension_error",e.message);h.call(this,t)},this):h.call(this,a),!0},_sendFrame:function(e){var t=e.length,n=t<=125?2:t<=65535?4:10,i=n+(e.masked?4:0),s=r.allocUnsafe(i+t),o=e.masked?this.MASK:0;s[0]=(e.final?this.FIN:0)|(e.rsv1?this.RSV1:0)|(e.rsv2?this.RSV2:0)|(e.rsv3?this.RSV3:0)|e.opcode,t<=125?s[1]=o|t:t<=65535?(s[1]=126|o,s.writeUInt16BE(t,2)):(s[1]=127|o,s.writeUInt32BE(Math.floor(t/4294967296),2),s.writeUInt32BE(t%4294967296,6)),e.payload.copy(s,i),e.masked&&(e.maskingKey.copy(s,n),u.mask(s,e.maskingKey,i)),this._write(s)},_handshakeResponse:function(){var e=this._request.headers["sec-websocket-key"],t=this._request.headers["sec-websocket-version"];if(t!==u.VERSION)throw Error("Unsupported WebSocket version: "+t);if("string"!=typeof e)throw Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",u.generateAccept(e)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var n=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);n&&this._headers.set("Sec-WebSocket-Extensions",n);var i=["HTTP/1.1 101 Switching Protocols",this._headers.toString(),""];return r.from(i.join("\r\n"),"utf8")},_shutdown:function(e,t,n){delete this._frame,delete this._message,this._stage=5;var r=1===this.readyState;this.readyState=2,this._extensions.close(function(){r&&this.frame(t,"close",e),this.readyState=3,n&&this.emit("error",Error(t)),this.emit("close",new a.CloseEvent(e,t))},this)},_fail:function(e,t){this.readyState>1||this._shutdown(this.ERRORS[e],t,!0)},_parseOpcode:function(e){var t=[this.RSV1,this.RSV2,this.RSV3].map(function(t){return(e&t)===t}),n=this._frame=new l;return(n.final=(e&this.FIN)===this.FIN,n.rsv1=t[0],n.rsv2=t[1],n.rsv3=t[2],n.opcode=e&this.OPCODE,this._stage=1,this._extensions.validFrameRsv(n))?0>this.OPCODE_CODES.indexOf(n.opcode)?this._fail("protocol_error","Unrecognized frame opcode: "+n.opcode):0>this.MESSAGE_OPCODES.indexOf(n.opcode)&&!n.final?this._fail("protocol_error","Received fragmented control frame: opcode = "+n.opcode):this._message&&this.OPENING_OPCODES.indexOf(n.opcode)>=0?this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished"):void 0:this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+(n.rsv1?1:0)+", reserved2 = "+(n.rsv2?1:0)+", reserved3 = "+(n.rsv3?1:0))},_parseLength:function(e){var t=this._frame;if(t.masked=(e&this.MASK)===this.MASK,t.length=e&this.LENGTH,t.length>=0&&t.length<=125){if(this._stage=t.masked?3:4,!this._checkFrameLength())return}else this._stage=2,t.lengthBytes=126===t.length?2:8;if(this._requireMasking&&!t.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(e){var t=this._frame;if(t.length=this._readUInt(e),this._stage=t.masked?3:4,0>this.MESSAGE_OPCODES.indexOf(t.opcode)&&t.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+t.length);if(!this._checkFrameLength())return},_checkFrameLength:function(){return!((this._message?this._message.length:0)+this._frame.length>this._maxLength)||(this._fail("too_large","WebSocket frame length too large"),!1)},_emitFrame:function(e){var t,n,r,i,s,o=this._frame,l=o.payload=u.mask(e,o.maskingKey),h=o.opcode;if(delete this._frame,h===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(o)}if((h===this.OPCODES.text||h===this.OPCODES.binary)&&(this._message=new c,this._message.pushFrame(o)),o.final&&this.MESSAGE_OPCODES.indexOf(h)>=0)return this._emitMessage(this._message);h===this.OPCODES.close&&(n=l.length>=2?l.readUInt16BE(0):null,r=l.length>2?this._encode(l.slice(2)):null,0!==l.length&&!(null!==n&&n>=this.MIN_RESERVED_ERROR&&n<=this.MAX_RESERVED_ERROR)&&0>this.ERROR_CODES.indexOf(n)&&(n=this.ERRORS.protocol_error),(l.length>125||l.length>2&&!r)&&(n=this.ERRORS.protocol_error),this._shutdown(n||this.DEFAULT_ERROR_CODE,r||"")),h===this.OPCODES.ping&&(this.frame(l,"pong"),this.emit("ping",new a.PingEvent(l.toString()))),h===this.OPCODES.pong&&(s=(i=this._pingCallbacks)[t=this._encode(l)],delete i[t],s&&s(),this.emit("pong",new a.PongEvent(l.toString())))},_emitMessage:function(e){var e=this._message;e.read(),delete this._message,this._extensions.processIncomingMessage(e,function(e,t){if(e)return this._fail("extension_error",e.message);var n=t.data;if(t.opcode===this.OPCODES.text&&(n=this._encode(n)),null===n)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new a.MessageEvent(n))},this)},_encode:function(e){try{var t=e.toString("binary",0,e.length);if(!this.UTF8_MATCH.test(t))return null}catch(e){}return e.toString("utf8",0,e.length)},_readUInt:function(e){return 2===e.length?e.readUInt16BE(0):4294967296*e.readUInt32BE(0)+e.readUInt32BE(4)}};for(var d in h)u.prototype[d]=h[d];e.exports=u},4643:e=>{"use strict";var t=function(){},n={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(var r in n)t.prototype[r]=n[r];e.exports=t},1357:(e,t,n)=>{"use strict";var r=n(5299).Buffer,i=function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},s={read:function(){return this.data=this.data||r.concat(this._chunks,this.length)},pushFrame:function(e){this.rsv1=this.rsv1||e.rsv1,this.rsv2=this.rsv2||e.rsv2,this.rsv3=this.rsv3||e.rsv3,null===this.opcode&&(this.opcode=e.opcode),this._chunks.push(e.payload),this.length+=e.length}};for(var o in s)i.prototype[o]=s[o];e.exports=i},4887:(e,t,n)=>{"use strict";var r=n(5299).Buffer,i=n(2781).Stream,s=n(7310),o=n(3837),a=n(533),l=n(3355),c=n(3515),u={"ws:":80,"wss:":443},h=function(e,t,n){this._client=e,this._http=new c("response"),this._origin="object"==typeof e.url?e.url:s.parse(e.url),this._url="object"==typeof t?t:s.parse(t),this._options=n||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new l,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var i=this._url.auth&&r.from(this._url.auth,"utf8").toString("base64");i&&this._headers.set("Proxy-Authorization","Basic "+i)};o.inherits(h,i);var d={setHeader:function(e,t){return 0===this._state&&(this._headers.set(e,t),!0)},start:function(){if(0!==this._state)return!1;this._state=1;var e=this._origin,t=e.port||u[e.protocol],n=["CONNECT "+e.hostname+":"+t+" HTTP/1.1",this._headers.toString(),""];return this.emit("data",r.from(n.join("\r\n"),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(e){if(!this.writable)return!1;if(this._http.parse(e),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,200===this.statusCode)this.emit("connect",new a.ConnectEvent);else{var t="Can't establish a connection to the server at "+this._origin.href;this.emit("error",Error(t))}return this.end(),!this._paused},end:function(e){this.writable&&(void 0!==e&&this.write(e),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(var f in d)h.prototype[f]=d[f];e.exports=h},9588:(e,t,n)=>{"use strict";var r=n(3837),i=n(3515),s=n(533),o=n(5131),a=n(5377),l=n(8388),c=function(e){s.call(this,null,null,e),this._http=new i("request")};r.inherits(c,s);var u={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(e){if(this._delegate)return this._delegate.parse(e);if(this._http.parse(e),this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var t=this;this._delegate=c.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(e){this._delegate.on(e,function(n){t.emit(e,n)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new s.ConnectEvent)}},_open:function(){this.__queue.forEach(function(e){this._delegate[e[0]].apply(this._delegate,e[1])},this),this.__queue=[]}};for(var h in["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(e){u[e]=function(){return this._delegate?this._delegate[e].apply(this._delegate,arguments):(this.__queue.push([e,arguments]),!0)}}),u)c.prototype[h]=u[h];c.isSecureRequest=function(e){if(e.connection&&void 0!==e.connection.authorized||e.socket&&e.socket.secure)return!0;var t=e.headers;return!!t&&("on"===t.https||"on"===t["x-forwarded-ssl"]||"https"===t["x-forwarded-scheme"]||"https"===t["x-forwarded-proto"])},c.determineUrl=function(e){return(this.isSecureRequest(e)?"wss:":"ws:")+"//"+e.headers.host+e.url},c.http=function(e,t){void 0===(t=t||{}).requireMasking&&(t.requireMasking=!0);var n=e.headers,r=n["sec-websocket-version"],i=n["sec-websocket-key"],s=n["sec-websocket-key1"],c=n["sec-websocket-key2"],u=this.determineUrl(e);return r||i?new l(e,u,t):s||c?new a(e,u,t):new o(e,u,t)},e.exports=c},1162:(e,t,n)=>{"use strict";var r=n(5299).Buffer,i=function(){this._queue=[],this._queueSize=0,this._offset=0};i.prototype.put=function(e){e&&0!==e.length&&(r.isBuffer(e)||(e=r.from(e)),this._queue.push(e),this._queueSize+=e.length)},i.prototype.read=function(e){if(e>this._queueSize)return null;if(0===e)return r.alloc(0);this._queueSize-=e;var t,n,i=this._queue,s=e,o=i[0];if(o.length>=e)return o.length===e?i.shift():(n=o.slice(0,e),i[0]=o.slice(e),n);for(var a=0,l=i.length;a<l&&!(s<i[a].length);a++)s-=i[a].length;return t=i.splice(0,a),s>0&&i.length>0&&(t.push(i[0].slice(0,s)),i[0]=i[0].slice(s)),r.concat(t,e)},i.prototype.eachByte=function(e,t){for(var n,r,i;this._queue.length>0;){for(r=(n=this._queue[0]).length;this._offset<r;)i=this._offset,this._offset+=1,e.call(t,n[i]);this._offset=0,this._queue.shift()}},e.exports=i},3515:(e,t,n)=>{"use strict";var r=n(2735).m,i=n(5299).Buffer,s={request:r.REQUEST||"request",response:r.RESPONSE||"response"},o=function(e){this._type=e,this._parser=new r(s[e]),this._complete=!1,this.headers={};var t=null,n=this;this._parser.onHeaderField=function(e,n,r){t=e.toString("utf8",n,n+r).toLowerCase()},this._parser.onHeaderValue=function(e,r,i){var s=e.toString("utf8",r,r+i);n.headers.hasOwnProperty(t)?n.headers[t]+=", "+s:n.headers[t]=s},this._parser.onHeadersComplete=this._parser[r.kOnHeadersComplete]=function(e,t,r,i,s,a){var l=arguments[0];if("object"==typeof l&&(i=l.method,s=l.url,a=l.statusCode,r=l.headers),n.method="number"==typeof i?o.METHODS[i]:i,n.statusCode=a,n.url=s,r){for(var c,u,h=0,d=r.length;h<d;h+=2)c=r[h].toLowerCase(),u=r[h+1],n.headers.hasOwnProperty(c)?n.headers[c]+=", "+u:n.headers[c]=u;n._complete=!0}}};o.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var a=process.version?process.version.match(/[0-9]+/g).map(function(e){return parseInt(e,10)}):[];0===a[0]&&12===a[1]&&(o.METHODS[16]="REPORT",o.METHODS[17]="MKACTIVITY",o.METHODS[18]="CHECKOUT",o.METHODS[19]="MERGE",o.METHODS[20]="M-SEARCH",o.METHODS[21]="NOTIFY",o.METHODS[22]="SUBSCRIBE",o.METHODS[23]="UNSUBSCRIBE",o.METHODS[24]="PATCH",o.METHODS[25]="PURGE"),o.prototype.isComplete=function(){return this._complete},o.prototype.parse=function(e){var t=this._parser.execute(e,0,e.length);if("number"!=typeof t){this.error=t,this._complete=!0;return}this._complete&&(this.body=t<e.length?e.slice(t):i.alloc(0))},e.exports=o},5340:(e,t,n)=>{"use strict";var r=n(2781).Stream,i=n(3837),s=function(e){this.readable=this.writable=!0,this._paused=!1,this._driver=e};i.inherits(s,r),s.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0},s.prototype.resume=function(){this._paused=!1,this.emit("drain");var e=this._driver.messages;e._paused=!1,e.emit("drain")},s.prototype.write=function(e){return!!this.writable&&(this._driver.parse(e),!this._paused)},s.prototype.end=function(e){if(this.writable){void 0!==e&&this.write(e),this.writable=!1;var t=this._driver.messages;t.readable&&(t.readable=t.writable=!1,t.emit("end"))}},s.prototype.destroy=function(){this.end()};var o=function(e){this.readable=this.writable=!0,this._paused=!1,this._driver=e};i.inherits(o,r),o.prototype.pause=function(){this._driver.io._paused=!0},o.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")},o.prototype.write=function(e){return!!this.writable&&("string"==typeof e?this._driver.text(e):this._driver.binary(e),!this._paused)},o.prototype.end=function(e){void 0!==e&&this.write(e)},o.prototype.destroy=function(){},t.IO=s,t.Messages=o},6172:e=>{"use strict";var t=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,n=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,r=RegExp(t.source+"(?:=(?:"+t.source+"|"+/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/.source+"))?"),i=RegExp(t.source+"(?: *; *"+r.source+")*","g"),s=RegExp("^"+i.source+"(?: *, *"+i.source+")*$"),o=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,a=Object.prototype.hasOwnProperty,l=function(){this._byName={},this._inOrder=[]};l.prototype.push=function(e,t){a.call(this._byName,e)||(this._byName[e]=[]),this._byName[e].push(t),this._inOrder.push({name:e,params:t})},l.prototype.eachOffer=function(e,t){for(var n=this._inOrder,r=0,i=n.length;r<i;r++)e.call(t,n[r].name,n[r].params)},l.prototype.byName=function(e){return this._byName[e]||[]},l.prototype.toArray=function(){return this._inOrder.slice()},e.exports={parseHeader:function(e){var t=new l;if(""===e||void 0===e)return t;if(!s.test(e))throw SyntaxError("Invalid Sec-WebSocket-Extensions header: "+e);return e.match(i).forEach(function(e){var n=e.match(RegExp(r.source,"g")),i=n.shift(),s={};n.forEach(function(e){var t,n=e.match(r),i=n[1];t=void 0!==n[2]?n[2]:void 0===n[3]||n[3].replace(/\\/g,""),o.test(t)&&(t=parseFloat(t)),a.call(s,i)?(s[i]=[].concat(s[i]),s[i].push(t)):s[i]=t},this),t.push(i,s)},this),t},serializeParams:function(e,t){var r=[],i=function(e,t){t instanceof Array?t.forEach(function(t){i(e,t)}):!0===t?r.push(e):"number"==typeof t?r.push(e+"="+t):n.test(t)?r.push(e+'="'+t.replace(/"/g,'\\"')+'"'):r.push(e+"="+t)};for(var s in t)i(s,t[s]);return[e].concat(r).join("; ")}}},7902:(e,t,n)=>{"use strict";var r=n(9432),i=n(9321),s=function(e){this._ext=e[0],this._session=e[1],this._functors={incoming:new r(this._session,"processIncomingMessage"),outgoing:new r(this._session,"processOutgoingMessage")}};s.prototype.pending=function(e){var t=this._functors[e];t._stopped||(t.pending+=1)},s.prototype.incoming=function(e,t,n,r){this._exec("incoming",e,t,n,r)},s.prototype.outgoing=function(e,t,n,r){this._exec("outgoing",e,t,n,r)},s.prototype.close=function(){return this._closed=this._closed||new i,this._doClose(),this._closed},s.prototype._exec=function(e,t,n,r,i){this._functors[e].call(t,n,function(e,t){e&&(e.message=this._ext.name+": "+e.message),r.call(i,e,t),this._doClose()},this)},s.prototype._doClose=function(){var e=this._functors.incoming,t=this._functors.outgoing;this._closed&&e.pending+t.pending===0&&(this._session&&this._session.close(),this._session=null,this._closed.done())},e.exports=s},9432:(e,t,n)=>{"use strict";var r=n(5673),i=function(e,t){this._session=e,this._method=t,this._queue=new r(i.QUEUE_SIZE),this._stopped=!1,this.pending=0};i.QUEUE_SIZE=8,i.prototype.call=function(e,t,n,r){if(!this._stopped){var i={error:e,message:t,callback:n,context:r,done:!1},s=!1,o=this;if(this._queue.push(i),i.error)return i.done=!0,this._stop(),this._flushQueue();var a=function(e,t){s^(s=!0)&&(e?(o._stop(),i.error=e,i.message=null):i.message=t,i.done=!0,o._flushQueue())};try{this._session[this._method](t,a)}catch(e){a(e)}}},i.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0},i.prototype._flushQueue=function(){for(var e,t=this._queue;t.length>0&&t.peek().done;)(e=t.shift()).error?(this.pending=0,t.clear()):this.pending-=1,e.callback.call(e.context,e.error,e.message)},e.exports=i},1425:(e,t,n)=>{"use strict";var r=n(7902),i=n(9321),s=function(e){this._cells=e.map(function(e){return new r(e)}),this._stopped={incoming:!1,outgoing:!1}};s.prototype.processIncomingMessage=function(e,t,n){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,e,t,n)},s.prototype.processOutgoingMessage=function(e,t,n){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,e,t,n)},s.prototype.close=function(e,t){this._stopped={incoming:!0,outgoing:!0};var n=this._cells.map(function(e){return e.close()});e&&i.all(n).then(function(){e.call(t)})},s.prototype._loop=function(e,t,n,r,i,s,o){for(var a=this._cells,l=a.length,c=this;l--;)a[l].pending(e);var u=function(t,i,l){if(t===n)return s.call(o,i,l);a[t][e](i,l,function(n,i){n&&(c._stopped[e]=!0),u(t+r,n,i)})};u(t,null,i)},e.exports=s},9321:(e,t,n)=>{"use strict";var r=n(5673),i=function(){this._complete=!1,this._callbacks=new r(i.QUEUE_SIZE)};i.QUEUE_SIZE=4,i.all=function(e){var t=new i,n=e.length,r=n;for(0===n&&t.done();r--;)e[r].then(function(){0==(n-=1)&&t.done()});return t},i.prototype.then=function(e){this._complete?e():this._callbacks.push(e)},i.prototype.done=function(){this._complete=!0;for(var e,t=this._callbacks;e=t.shift();)e()},e.exports=i},5673:e=>{"use strict";var t=function(e){this._bufferSize=e,this.clear()};t.prototype.clear=function(){this._buffer=Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0},t.prototype.push=function(e){var t=!1,n=!1;this._ringSize<this._bufferSize?t=0===this._tail:this._ringOffset===this._ringSize&&(t=!0,n=0===this._tail),t&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(Array(this._bufferSize)),this._bufferSize=this._buffer.length,n&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=e,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize},t.prototype.peek=function(){if(0!==this.length)return this._buffer[this._head]},t.prototype.shift=function(){if(0!==this.length){var e=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,0===this._ringOffset&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,e}},e.exports=t},7999:(e,t,n)=>{"use strict";var r=n(6172),i=n(1425),s=function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}};s.MESSAGE_OPCODES=[1,2];var o={add:function(e){if("string"!=typeof e.name)throw TypeError("extension.name must be a string");if("permessage"!==e.type)throw TypeError('extension.type must be "permessage"');if("boolean"!=typeof e.rsv1)throw TypeError("extension.rsv1 must be true or false");if("boolean"!=typeof e.rsv2)throw TypeError("extension.rsv2 must be true or false");if("boolean"!=typeof e.rsv3)throw TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(e.name))throw TypeError('An extension with name "'+e.name+'" is already registered');this._byName[e.name]=e,this._inOrder.push(e)},generateOffer:function(){var e=[],t=[],n={};return this._inOrder.forEach(function(i){var s=i.createClientSession();if(s){var o=[i,s];e.push(o),n[i.name]=o;var a=s.generateOffer();(a=a?[].concat(a):[]).forEach(function(e){t.push(r.serializeParams(i.name,e))},this)}},this),this._sessions=e,this._index=n,t.length>0?t.join(", "):null},activate:function(e){var t=r.parseHeader(e),n=[];t.eachOffer(function(e,t){var i=this._index[e];if(!i)throw Error('Server sent an extension response for unknown extension "'+e+'"');var s=i[0],o=i[1],a=this._reserved(s);if(a)throw Error("Server sent two extension responses that use the RSV"+a[0]+' bit: "'+a[1]+'" and "'+s.name+'"');if(!0!==o.activate(t))throw Error("Server sent unacceptable extension parameters: "+r.serializeParams(e,t));this._reserve(s),n.push(i)},this),this._sessions=n,this._pipeline=new i(n)},generateResponse:function(e){var t=[],n=[],s=r.parseHeader(e);return this._inOrder.forEach(function(e){var i=s.byName(e.name);if(!(0===i.length||this._reserved(e))){var o=e.createServerSession(i);o&&(this._reserve(e),t.push([e,o]),n.push(r.serializeParams(e.name,o.generateResponse())))}},this),this._sessions=t,this._pipeline=new i(t),n.length>0?n.join(", "):null},validFrameRsv:function(e){var t,n={rsv1:!1,rsv2:!1,rsv3:!1};if(s.MESSAGE_OPCODES.indexOf(e.opcode)>=0)for(var r=0,i=this._sessions.length;r<i;r++)t=this._sessions[r][0],n.rsv1=n.rsv1||t.rsv1,n.rsv2=n.rsv2||t.rsv2,n.rsv3=n.rsv3||t.rsv3;return(n.rsv1||!e.rsv1)&&(n.rsv2||!e.rsv2)&&(n.rsv3||!e.rsv3)},processIncomingMessage:function(e,t,n){this._pipeline.processIncomingMessage(e,t,n)},processOutgoingMessage:function(e,t,n){this._pipeline.processOutgoingMessage(e,t,n)},close:function(e,t){if(!this._pipeline)return e.call(t);this._pipeline.close(e,t)},_reserve:function(e){this._rsv1=this._rsv1||e.rsv1&&e.name,this._rsv2=this._rsv2||e.rsv2&&e.name,this._rsv3=this._rsv3||e.rsv3&&e.name},_reserved:function(e){return this._rsv1&&e.rsv1?[1,this._rsv1]:this._rsv2&&e.rsv2?[2,this._rsv2]:!!this._rsv3&&!!e.rsv3&&[3,this._rsv3]}};for(var a in o)s.prototype[a]=o[a];e.exports=s},3531:(e,t,n)=>{"use strict";let r,i,s,o,a,l,c,u,h,d,f,p,g,m;n.r(t),n.d(t,{default:()=>fk});var _,y,v,b,w,x,E,C,S=n(2295),k=n(3729),N=n.n(k);let I=[{id:"1",text:"Detection of Disinformation",category:"opportunities",timeframe:"10months",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"2",text:"AI Cyber Defence Service / AI Research Teams",category:"opportunities",timeframe:"10months",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"3",text:"Forecasting & Predictive Systems",category:"opportunities",timeframe:"10months",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"4",text:"Automating Big Data Tasks (resource/funding management)",category:"opportunities",timeframe:"10months",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"5",text:"Infrastructure / Resource Sharing",category:"opportunities",timeframe:"10months",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"6",text:"Historical Document Analysis",category:"opportunities",timeframe:"10months",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"7",text:"Personalised Education",category:"opportunities",timeframe:"10months",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"8",text:"Augmented Human Creativity",category:"opportunities",timeframe:"10months",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"9",text:"Medical: Research (drug discovery), Implementation (AI for doctors), Society (vaccine distribution)",category:"opportunities",timeframe:"10months",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"10",text:"Human-level Problem Simplification of Extremely Complex Patterns",category:"opportunities",timeframe:"3years",votes:3,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"11",text:"Longevity/Immortality  Solo Hedge Funds  Faster Clinical Trials",category:"opportunities",timeframe:"3years",votes:4,tags:["Q2","Q1","Q4"],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"12",text:"Government - Army AI (law enforcement, judiciary)",category:"opportunities",timeframe:"3years",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"13",text:"Automation of Labour-intensive Tasks",category:"opportunities",timeframe:"3years",votes:3,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"14",text:"Human-AI Collaboration for Skilled Work",category:"opportunities",timeframe:"3years",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"15",text:"AI-based Defence Against Malicious AI",category:"opportunities",timeframe:"3years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"16",text:"AI Creativity",category:"opportunities",timeframe:"10years",votes:4,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"17",text:"AI Identity",category:"opportunities",timeframe:"10years",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"18",text:"Robots/Humanoids, Exponential Automation, Autonomous Weapons, Space Exploration & Resource Extraction with Self-replicating Bots",category:"opportunities",timeframe:"10years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"19",text:"Speed-up Optimization of Quantum Hardware  Discovery of Chemicals & Drugs  Financial Probability Models (using quantum)",category:"opportunities",timeframe:"10years",votes:3,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"20",text:"Climate Change Monitoring Interfaces",category:"opportunities",timeframe:"10years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"21",text:"Radical Abundance / Plenitude",category:"opportunities",timeframe:"10years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"22",text:"Size Reduction via Abstraction",category:"opportunities",timeframe:"10years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"23",text:"Dynamic Bayesian Graphs",category:"enablers",timeframe:"10months",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"24",text:"Active Inference",category:"enablers",timeframe:"10months",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"25",text:"Incentive Systems for Both Humans and Agents",category:"enablers",timeframe:"10months",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"26",text:"Agent Protocols with Guarantee",category:"enablers",timeframe:"10months",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"27",text:"Neurosymbolic AI",category:"enablers",timeframe:"10months",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"28",text:"Biology/Neuroscience-informed AI (neural networks, recursive learning, backpropagation)",category:"enablers",timeframe:"10months",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"29",text:"Open-access / Data Ecosystems",category:"enablers",timeframe:"10months",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"30",text:"Modularization / Multi-agent AI",category:"enablers",timeframe:"10months",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"31",text:"Reinforcement Learning Environments for TEXT",category:"enablers",timeframe:"3years",votes:4,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"32",text:"Evolutionary Algorithms",category:"enablers",timeframe:"3years",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"33",text:"World Models (E4) / Vertical AI (E1)",category:"enablers",timeframe:"3years",votes:4,tags:["E4","E1"],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"34",text:"Cyber-physical & Interaction Infrastructure",category:"enablers",timeframe:"3years",votes:3,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"35",text:"New Tech in: Killing Zone + Elusive (Meritas), Metamorphic Abstracted, Biological Computing: DNA, Atom Based Computers, Rare Earth Minerals, Cheaper Energy",category:"enablers",timeframe:"3years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"36",text:"Diffraction Photonics to Accelerate AI-hardware, Analog-digital Hybrid Solutions",category:"enablers",timeframe:"3years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"37",text:"Multi-level Abstraction",category:"enablers",timeframe:"3years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"38",text:"Graph-neural Network & Network Models",category:"enablers",timeframe:"3years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"39",text:"Control & Cyber-Physical Models",category:"enablers",timeframe:"3years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"40",text:"Classical ML Models",category:"enablers",timeframe:"3years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"41",text:"Protein/DNA-based Computation & Data Storage",category:"enablers",timeframe:"10years",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"42",text:"Biological Computing",category:"enablers",timeframe:"10years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"43",text:"Quantum Machine Learning: Hybrid HPC-QC Architecture, Cloud based QC, QC Modularisation by Quantum Networks",category:"enablers",timeframe:"10years",votes:0,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"44",text:"AI Triad: Compute, Data, Algorithms",category:"enablers",timeframe:"foundational",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"45",text:"Sector-Specific Modular AI Systems",category:"enablers",timeframe:"foundational",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"46",text:"Web/Platform Participants (writing/posting/images)",category:"actors",timeframe:"10months",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"47",text:"Compute / Chip / Data Infrastructure Providers",category:"actors",timeframe:"10months",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"48",text:"Governments",category:"actors",timeframe:"10months",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"49",text:"Cyber Criminal / Malicious Actors",category:"actors",timeframe:"10months",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"50",text:"AI Pirates",category:"actors",timeframe:"3years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"51",text:"DIY Hackers / Open Source Community",category:"actors",timeframe:"3years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"52",text:"Research Institutions",category:"actors",timeframe:"3years",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"53",text:"Data Platform Providers",category:"actors",timeframe:"3years",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"54",text:"Industries (not AI)",category:"actors",timeframe:"3years",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"55",text:"Public / Crowd",category:"actors",timeframe:"3years",votes:3,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"56",text:"Start-ups & VC Funders",category:"actors",timeframe:"3years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"57",text:"Ethicists & Approval Bodies (eg for bio-based implementation)",category:"actors",timeframe:"3years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"58",text:"Regulators / Standard Bodies",category:"actors",timeframe:"3years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"59",text:"AI Itself",category:"actors",timeframe:"10years",votes:4,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"60",text:"Educators",category:"actors",timeframe:"10years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"61",text:"AI Societies",category:"actors",timeframe:"10years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"62",text:"Public Opinion: Popularity/controversy, Media (newspaper/social media), Publications",category:"actors",timeframe:"10years",votes:3,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"63",text:"Philanthropies & Foundations",category:"actors",timeframe:"10years",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"64",text:"Frontier AI Developers",category:"actors",timeframe:"10years",votes:2,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"65",text:"Google (Hardware)  Nu quantum (QC network)  Algorithmy (Software/Hardware integration)",category:"actors",timeframe:"10years",votes:3,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()},{id:"66",text:"Multinationals / Startups",category:"actors",timeframe:"10years",votes:1,tags:[],connections:[],createdAt:Date.now(),updatedAt:Date.now()}],T={opportunities:{label:"Opportunities",question:"What are the interfaces between AI and the real world?",colour:"pink"},enablers:{label:"Enablers",question:"What technologies will enable AI emergence?",colour:"blue"},actors:{label:"Actors",question:"Who is pushing the AI frontier?",colour:"yellow"}},D={"10months":{label:"Next 10 months",order:0},"3years":{label:"3 years",order:1},"10years":{label:"10 years",order:2},foundational:{label:"Foundational (Time-agnostic)",order:3}};var A=n(1453);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let R={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},P=function(e,t){if(!e)throw M(t)},M=function(e){return Error("Firebase Database ("+R.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},O=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},L=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")},B={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,c=i>>2,u=(3&i)<<4|o>>4,h=(15&o)<<2|l>>6,d=63&l;a||(d=64,s||(h=64)),r.push(n[c],n[u],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(O(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):L(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,o=++t<e.length?n[e.charAt(t)]:64,a=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==o||null==a)throw new F;let l=i<<2|s>>4;if(r.push(l),64!==o){let e=s<<4&240|o>>2;if(r.push(e),64!==a){let e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class F extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let H=function(e){let t=O(e);return B.encodeByteArray(t,!0)},j=function(e){return H(e).replace(/\./g,"")},z=function(e){try{return B.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},$=()=>/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof global)return global;throw Error("Unable to locate global object.")})().__FIREBASE_DEFAULTS__,q=()=>{if("undefined"==typeof process||void 0===process.env)return;let e=process.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},U=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&z(e[1]);return t&&JSON.parse(t)},V=()=>{try{return $()||q()||U()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},W=e=>{var t,n;return null===(n=null===(t=V())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},Y=e=>{let t=W(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},K=()=>{var e;return null===(e=V())||void 0===e?void 0:e.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function X(){return!0===R.NODE_CLIENT||!0===R.NODE_ADMIN}class Q extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Q.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Z.prototype.create)}}class Z{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){let n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?i.replace(J,(e,t)=>{let r=n[t];return null!=r?String(r):`<${t}?>`}):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new Q(r,o,n)}}let J=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ee(e){return JSON.parse(e)}function et(e){return JSON.stringify(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let en=function(e){let t={},n={},r={},i="";try{let s=e.split(".");t=ee(z(s[0])||""),n=ee(z(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}},er=function(e){let t=en(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},ei=function(e){let t=en(e).claims;return"object"==typeof t&&!0===t.admin};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function es(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function eo(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function ea(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function el(e,t,n){let r={};for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function ec(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(eu(n)&&eu(s)){if(!ec(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function eu(e){return null!==e&&"object"==typeof e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eh{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){let n,r;t||(t=0);let i=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)i[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)i[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=i[e-3]^i[e-8]^i[e-14]^i[e-16];i[e]=(t<<1|t>>>31)&4294967295}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=l^o&(a^l),r=1518500249):(n=o^a^l,r=1859775393):e<60?(n=o&a|l&(o|a),r=2400959708):(n=o^a^l,r=3395469782);let t=(s<<5|s>>>27)+n+c+r+i[e]&4294967295;c=l,l=a,a=(o<<30|o>>>2)&4294967295,o=s,s=t}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let n=t-this.blockSize,r=0,i=this.buf_,s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let r=24;r>=0;r-=8)e[n]=this.chain_[t]>>r&255,++n;return e}}function ed(e,t){return`${e} failed: ${t} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ef=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){let t=i-55296;P(++r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},ep=function(e){let t=0;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eg(e){return e&&e._delegate?e._delegate:e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */R.NODE_CLIENT=!0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let em=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(lf||(lf={}));let e_={debug:lf.DEBUG,verbose:lf.VERBOSE,info:lf.INFO,warn:lf.WARN,error:lf.ERROR,silent:lf.SILENT},ey=lf.INFO,ev={[lf.DEBUG]:"log",[lf.VERBOSE]:"log",[lf.INFO]:"info",[lf.WARN]:"warn",[lf.ERROR]:"error"},eb=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=ev[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class ew{constructor(e){this.name=e,this._logLevel=ey,this._logHandler=eb,this._userLogHandler=null,em.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in lf))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?e_[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,lf.DEBUG,...e),this._logHandler(this,lf.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,lf.VERBOSE,...e),this._logHandler(this,lf.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,lf.INFO,...e),this._logHandler(this,lf.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,lf.WARN,...e),this._logHandler(this,lf.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,lf.ERROR,...e),this._logHandler(this,lf.ERROR,...e)}}class ex{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eE="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eC{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new G;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:eE})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=eE){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=eE){return this.instances.has(e)}getOptions(e=eE){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;let r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);let s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:e===eE?void 0:e,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}return n||null}normalizeInstanceIdentifier(e=eE){return this.component?this.component.multipleInstances?e:eE:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eS{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new eC(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let ek=(e,t)=>t.some(t=>e instanceof t),eN=new WeakMap,eI=new WeakMap,eT=new WeakMap,eD=new WeakMap,eA=new WeakMap,eR={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return eI.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eT.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return eP(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eP(e){var t;if(e instanceof IDBRequest)return function(e){let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(eP(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&eN.set(t,e)}).catch(()=>{}),eA.set(t,e),t}(e);if(eD.has(e))return eD.get(e);let n="function"==typeof(t=e)?t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(eM(this),e),eP(eN.get(this))}:function(...e){return eP(t.apply(eM(this),e))}:function(e,...n){let r=t.call(eM(this),e,...n);return eT.set(r,e.sort?e.sort():[e]),eP(r)}:(t instanceof IDBTransaction&&function(e){if(eI.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});eI.set(e,t)}(t),ek(t,r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(t,eR):t;return n!==e&&(eD.set(e,n),eA.set(n,e)),n}let eM=e=>eA.get(e),eO=["get","getKey","getAll","getAllKeys","count"],eL=["put","add","delete","clear"],eB=new Map;function eF(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eB.get(t))return eB.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=eL.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||eO.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return eB.set(t,s),s}eR={...lh=eR,get:(e,t,n)=>eF(e,t)||lh.get(e,t,n),has:(e,t)=>!!eF(e,t)||lh.has(e,t)};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eH{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let ej="@firebase/app",ez="0.10.13",e$=new ew("@firebase/app"),eq="[DEFAULT]",eU={[ej]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai-preview":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},eV=new Map,eW=new Map,eY=new Map;function eK(e,t){try{e.container.addComponent(t)}catch(n){e$.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function eG(e){let t=e.name;if(eY.has(t))return e$.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(eY.set(t,e),eV.values()))eK(n,e);for(let t of eW.values())eK(t,e);return!0}let eX=new Z("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eQ{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new ex("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw eX.create("app-deleted",{appName:this._name})}}function eZ(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let r=Object.assign({name:eq,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw eX.create("bad-app-name",{appName:String(i)});if(n||(n=K()),!n)throw eX.create("no-options");let s=eV.get(i);if(s){if(ec(n,s.options)&&ec(r,s.config))return s;throw eX.create("duplicate-app",{appName:i})}let o=new eS(i);for(let e of eY.values())o.addComponent(e);let a=new eQ(n,r,o);return eV.set(i,a),a}function eJ(e,t,n){var r;let i=null!==(r=eU[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);let s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){let e=[`Unable to register library "${i}" with version "${t}":`];s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),e$.warn(e.join(" "));return}eG(new ex(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}let e0="firebase-heartbeat-store",e1=null;function e2(){return e1||(e1=(function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(e,1),a=eP(o);return r&&o.addEventListener("upgradeneeded",e=>{r(eP(o.result),e.oldVersion,e.newVersion,eP(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(e0)}catch(e){console.warn(e)}}}).catch(e=>{throw eX.create("idb-open",{originalErrorMessage:e.message})})),e1}async function e3(e){try{let t=(await e2()).transaction(e0),n=await t.objectStore(e0).get(e4(e));return await t.done,n}catch(e){if(e instanceof Q)e$.warn(e.message);else{let t=eX.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});e$.warn(t.message)}}}async function e5(e,t){try{let n=(await e2()).transaction(e0,"readwrite"),r=n.objectStore(e0);await r.put(t,e4(e)),await n.done}catch(e){if(e instanceof Q)e$.warn(e.message);else{let t=eX.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});e$.warn(t.message)}}}function e4(e){return`${e.name}!${e.options.appId}`}class e6{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new e7(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=e8();if((null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{let t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}catch(e){e$.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=e8(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),e9(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),e9(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=j(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return e$.warn(e),""}}}function e8(){return new Date().toISOString().substring(0,10)}class e7{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await e3(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return e5(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return e5(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function e9(e){return j(JSON.stringify({version:2,heartbeats:e})).length}eG(new ex("platform-logger",e=>new eH(e),"PRIVATE")),eG(new ex("heartbeat",e=>new e6(e),"PRIVATE")),eJ(ej,ez,""),eJ(ej,ez,"esm2017"),eJ("fire-js","");let te=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,tt="websocket",tn="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return es(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ti=function(e){return new tr},ts=ti("localStorage"),to=ti("sessionStorage"),ta=new ew("@firebase/database"),tl=function(){let e=1;return function(){return e++}}(),tc=function(e){let t=ef(e),n=new eh;n.update(t);let r=n.digest();return B.encodeByteArray(r)},tu=function(...e){let t="";for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=tu.apply(null,r):"object"==typeof r?t+=et(r):t+=r,t+=" "}return t},th=null,td=!0,tf=function(e,t){P(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(ta.logLevel=lf.VERBOSE,th=ta.log.bind(ta),t&&to.set("logging_enabled",!0)):"function"==typeof e?th=e:(th=null,to.remove("logging_enabled"))},tp=function(...e){if(!0===td&&(td=!1,null===th&&!0===to.get("logging_enabled")&&tf(!0)),th){let t=tu.apply(null,e);th(t)}},tg=function(e){return function(...t){tp(e,...t)}},tm=function(...e){let t="FIREBASE INTERNAL ERROR: "+tu(...e);ta.error(t)},t_=function(...e){let t=`FIREBASE FATAL ERROR: ${tu(...e)}`;throw ta.error(t),Error(t)},ty=function(...e){let t="FIREBASE WARNING: "+tu(...e);ta.warn(t)},tv=function(){},tb=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},tw=function(e){if(X()||"complete"===document.readyState)e();else{let t=!1,n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}t||(t=!0,e())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},tx="[MIN_NAME]",tE="[MAX_NAME]",tC=function(e,t){if(e===t)return 0;if(e===tx||t===tE)return -1;if(t===tx||e===tE)return 1;{let n=tR(e),r=tR(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1}},tS=function(e,t){return e===t?0:e<t?-1:1},tk=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+et(t))},tN=function(e){if("object"!=typeof e||null===e)return et(e);let t=[];for(let n in e)t.push(n);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=et(t[r])+":"+tN(e[t[r]]);return n+"}"},tI=function(e,t){let n=e.length;if(n<=t)return[e];let r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function tT(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}let tD=function(e){let t,n,r,i,s;P(!tb(e),"Invalid JSON number"),0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,r=Math.round(e*Math.pow(2,52-i)-4503599627370496)):(n=0,r=Math.round(e/5e-324)));let o=[];for(s=52;s;s-=1)o.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(t?1:0),o.reverse();let a=o.join(""),l="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},tA=RegExp("^-?(0*)\\d{1,10}$"),tR=function(e){if(tA.test(e)){let t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},tP=function(e){try{e()}catch(e){setTimeout(()=>{throw ty("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},tM=function(e,t){let n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tO{constructor(e,t,n,r,i=!1,s="",o=!1,a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ts.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ts.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function tL(e,t,n){let r;if(P("string"==typeof t,"typeof type must == string"),P("object"==typeof n,"typeof params must == object"),t===tt)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===tn)r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);let i=[];return tT(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tB{constructor(){this.counters_={}}incrementCounter(e,t=1){es(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(let r in n)n.hasOwnProperty(r)&&"__proto__"!==r&&(t[r]=e(t[r],n[r]));return t}(void 0,this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tF={},tH={};function tj(e){let t=e.toString();return tF[t]||(tF[t]=new tB),tF[t]}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tz="",t$=null;"undefined"!=typeof MozWebSocket?t$=MozWebSocket:"undefined"!=typeof WebSocket&&(t$=WebSocket);class tq{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=tg(this.connId),this.stats_=tj(t),this.connURL=tq.connectionURL_(t,s,o,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){let s={};return s.v="5",!X()&&"undefined"!=typeof location&&location.hostname&&te.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s.ac=r),i&&(s.p=i),tL(e,tt,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ts.set("previous_websocket_failure",!0);try{let e;if(X()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/5/${tz}/${process.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let n=process.env,r=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;r&&(e.proxy={origin:r})}this.mySock=new t$(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){tq.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){let t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&t.length>1&&4.4>parseFloat(t[1])&&(e=!0)}return!e&&null!==t$&&!tq.forceDisallow_}static previouslyFailed(){return ts.isInMemoryStorage||!0===ts.get("previous_websocket_failure")}markConnectionHealthy(){ts.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=ee(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(P(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=et(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=tI(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}tq.responsesRequiredToBeHealthy=2,tq.healthyTimeout=3e4;let tU="@firebase/database",tV="1.0.8";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tW{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){ty(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tY{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(tp("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ty(e)}}class tK{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}tK.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tG{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&tP(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tX="start";class tQ{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=tg(e),this.stats_=tj(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),tL(t,tn,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new tG(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),tw(()=>{if(this.isClosed_)return;this.scriptTagHolder=new tZ((...e)=>{let[t,n,r,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder){if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===tX)this.id=n,this.password=r;else if("close"===t)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)}},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[tX]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&te.test(location.hostname)&&(e.r="f");let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){tQ.forceAllow_=!0}static forceDisallow(){tQ.forceDisallow_=!0}static isAvailable(){return!X()&&(!!tQ.forceAllow_||!tQ.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=et(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=tI(H(t),1840);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(X())return;this.myDisconnFrame=document.createElement("iframe");let n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=et(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class tZ{constructor(e,t,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,X())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=tl(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=tZ.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";</script>');let r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(e){tp("frame writing exception"),e.stack&&tp(e.stack),tp(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||tp("No IE domain setting required")}catch(n){let t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){let e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,t){X()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{tp("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tJ{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[tQ,tq]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){let t=tq&&tq.isAvailable(),n=t&&!tq.previouslyFailed();if(e.webSocketOnly&&(t||ty("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[tq];else{let e=this.transports_=[];for(let t of tJ.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);tJ.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}tJ.globalTransportInitialized_=!1;class t0{constructor(e,t,n,r,i,s,o,a,l,c){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=tg("c:"+this.id+":"),this.transportManager_=new tJ(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=tM(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){let t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=tk("t",e),n=tk("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=tk("t",e),n=tk("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=tk("t",e);if("d"in e){let n=e.d;if("h"===t){let e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?tm("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):tm("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&ty("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),tM(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):tM(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ts.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t1{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t2{constructor(e){this.allowedEvents_=e,this.listeners_={},P(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context)){r.splice(e,1);return}}validateEventType_(e){P(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t3 extends t2{constructor(){super(["online"]),this.online_=!0}static getInstance(){return new t3}getInitialEvent(e){return P("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class t5{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function t4(){return new t5("")}function t6(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function t8(e){return e.pieces_.length-e.pieceNum_}function t7(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new t5(e.pieces_,t)}function t9(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function ne(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function nt(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new t5(t,0)}function nn(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof t5)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new t5(n,0)}function nr(e){return e.pieceNum_>=e.pieces_.length}function ni(e,t){let n=t6(e),r=t6(t);if(null===n)return t;if(n===r)return ni(t7(e),t7(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function ns(e,t){let n=ne(e,0),r=ne(t,0);for(let e=0;e<n.length&&e<r.length;e++){let t=tC(n[e],r[e]);if(0!==t)return t}return n.length===r.length?0:n.length<r.length?-1:1}function no(e,t){if(t8(e)!==t8(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function na(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(t8(e)>t8(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class nl{constructor(e,t){this.errorPrefix_=t,this.parts_=ne(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=ep(this.parts_[e]);nc(this)}}function nc(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+nu(e))}function nu(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh extends t2{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}static getInstance(){return new nh}getInitialEvent(e){return P("visible"===e,"Unknown event type: "+e),[this.visible_]}}class nd extends t1{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=nd.nextPersistentConnectionId_++,this.log_=tg("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!X())throw Error("Auth override specified in options, but not supported on non Node.js platforms");nh.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&t3.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){let r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(et(i)),P(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();let t=new G,n={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:n,onComplete:e=>{let n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++;let r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,r){this.initConnection_();let i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),P(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),P(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");let o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){let t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);let i={p:n};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,i=>{let s=i.d,o=i.s;nd.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(n,r),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&es(e,"w")){let n=eo(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();ty(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||ei(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=er(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),P(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);let i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){let i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();let s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+et(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):tm("Unrecognized action received from server: "+et(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){P(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){!e||this.visible_||this.reconnectDelay_!==this.maxReconnectDelay_||(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=new Date().getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+nd.nextConnectionId_++,i=this.lastSessionId,s=!1,o=null,a=function(){o?o.close():(s=!0,n())};this.realtime_={close:a,sendRequest:function(e){P(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)}};let l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[a,c]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?tp("getToken() completed but was canceled"):(tp("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=c&&c.token,o=new t0(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{ty(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},i))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&ty(e),a())}}}interrupt(e){tp("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){tp("Resuming connection for reason: "+e),delete this.interruptReasons_[e],ea(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>tN(e)).join("$"):"default";let r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){let n;let r=new t5(e).toString();if(this.listens.has(r)){let e=this.listens.get(r);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(r)}else n=void 0;return n}onAuthRevoked_(e,t){tp("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){tp("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";X()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+tz.replace(/\./g,"-")]=1,"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=t3.getInstance().currentlyOnline();return ea(this.interruptReasons_)&&e}}nd.nextPersistentConnectionId_=0,nd.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nf{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new nf(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class np{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new nf(tx,e),r=new nf(tx,t);return 0!==this.compare(n,r)}minPost(){return nf.MIN}}class ng extends np{static get __EMPTY_NODE(){return s}static set __EMPTY_NODE(e){s=e}compare(e,t){return tC(e.name,t.name)}isDefinedOn(e){throw M("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return nf.MIN}maxPost(){return new nf(tE,s)}makePost(e,t){return P("string"==typeof e,"KeyIndex indexValue must always be a string."),new nf(e,s)}toString(){return".key"}}let nm=new ng;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n_{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class ny{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:ny.RED,this.left=null!=r?r:nb.EMPTY_NODE,this.right=null!=i?i:nb.EMPTY_NODE}copy(e,t,n,r,i){return new ny(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return nb.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,r;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return nb.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,ny.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,ny.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+(this.isRed_()?0:1);throw Error("Black depths differ")}}ny.RED=!0,ny.BLACK=!1;class nv{copy(e,t,n,r,i){return this}insert(e,t,n){return new ny(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class nb{constructor(e,t=nb.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new nb(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,ny.BLACK,null,null))}remove(e){return new nb(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,ny.BLACK,null,null))}get(e){let t;let n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty()){if(r)return r.key;return null}for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new n_(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new n_(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new n_(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new n_(this.root_,null,this.comparator_,!0,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nw(e,t){return tC(e.name,t.name)}function nx(e,t){return tC(e,t)}nb.EMPTY_NODE=new nv;let nE=function(e){return"number"==typeof e?"number:"+tD(e):"string:"+e},nC=function(e){if(e.isLeafNode()){let t=e.val();P("string"==typeof t||"number"==typeof t||"object"==typeof t&&es(t,".sv"),"Priority must be a string or number.")}else P(e===o||e.isEmpty(),"priority of unexpected type.");P(e===o||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class nS{constructor(e,t=nS.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,P(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),nC(this.priorityNode_)}static set __childrenNodeConstructor(e){a=e}static get __childrenNodeConstructor(){return a}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new nS(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:nS.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return nr(e)?this:".priority"===t6(e)?this.priorityNode_:nS.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:nS.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let n=t6(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(P(".priority"!==n||1===t8(e),".priority must be the last token in a path"),this.updateImmediateChild(n,nS.__childrenNodeConstructor.EMPTY_NODE.updateChild(t7(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+nE(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=tD(this.value_):e+=this.value_,this.lazyHash_=tc(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===nS.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof nS.__childrenNodeConstructor?-1:(P(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,n=typeof this.value_,r=nS.VALUE_TYPE_ORDER.indexOf(t),i=nS.VALUE_TYPE_ORDER.indexOf(n);return(P(r>=0,"Unknown leaf type: "+t),P(i>=0,"Unknown leaf type: "+n),r!==i)?i-r:"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}nS.VALUE_TYPE_ORDER=["object","boolean","number","string"];class nk extends np{compare(e,t){let n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?tC(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return nf.MIN}maxPost(){return new nf(tE,new nS("[PRIORITY-POST]",c))}makePost(e,t){return new nf(t,new nS("[PRIORITY-POST]",l(e)))}toString(){return".priority"}}let nN=new nk,nI=Math.log(2);class nT{constructor(e){this.count=parseInt(Math.log(e+1)/nI,10),this.current_=this.count-1;let t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let nD=function(e,t,n,r){e.sort(t);let i=function(t,r){let s;let o=r-t;if(0===o)return null;if(1===o)return s=e[t],new ny(n?n(s):s,s.node,ny.BLACK,null,null);{let a=parseInt(o/2,10)+t,l=i(t,a),c=i(a+1,r);return s=e[a],new ny(n?n(s):s,s.node,ny.BLACK,l,c)}};return new nb(r||t,function(t){let r=null,s=null,o=e.length,a=function(t,r){let s=o-t,a=o;o-=t;let c=i(s+1,a),u=e[s];l(new ny(n?n(u):u,u.node,r,null,c))},l=function(e){r?r.left=e:s=e,r=e};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,ny.BLACK):(a(r,ny.BLACK),a(r,ny.RED))}return s}(new nT(e.length)))},nA={};class nR{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return P(nA&&nN,"ChildrenNode.ts has not been loaded"),u=u||new nR({".priority":nA},{".priority":nN})}get(e){let t=eo(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof nb?t:null}hasIndex(e){return es(this.indexSet_,e.toString())}addIndex(e,t){let n;P(e!==nm,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(nf.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();n=i?nD(r,e.getCompare()):nA;let a=e.toString(),l=Object.assign({},this.indexSet_);l[a]=e;let c=Object.assign({},this.indexes_);return c[a]=n,new nR(c,l)}addToIndexes(e,t){return new nR(el(this.indexes_,(n,r)=>{let i=eo(this.indexSet_,r);if(P(i,"Missing index implementation for "+r),n===nA){if(!i.isDefinedOn(e.node))return nA;{let n=[],r=t.getIterator(nf.Wrap),s=r.getNext();for(;s;)s.name!==e.name&&n.push(s),s=r.getNext();return n.push(e),nD(n,i.getCompare())}}{let r=t.get(e.name),i=n;return r&&(i=i.remove(new nf(e.name,r))),i.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new nR(el(this.indexes_,n=>{if(n===nA)return n;{let r=t.get(e.name);return r?n.remove(new nf(e.name,r)):n}}),this.indexSet_)}}class nP{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&nC(this.priorityNode_),this.children_.isEmpty()&&P(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return h||(h=new nP(new nb(nx),null,nR.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||h}updatePriority(e){return this.children_.isEmpty()?this:new nP(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?h:t}}getChild(e){let t=t6(e);return null===t?this:this.getImmediateChild(t).getChild(t7(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(P(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let n,r;let i=new nf(e,t);t.isEmpty()?(n=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(n=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(i,this.children_));let s=n.isEmpty()?h:this.priorityNode_;return new nP(n,s,r)}}updateChild(e,t){let n=t6(e);if(null===n)return t;{P(".priority"!==t6(e)||1===t8(e),".priority must be the last token in a path");let r=this.getImmediateChild(n).updateChild(t7(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},n=0,r=0,i=!0;if(this.forEachChild(nN,(s,o)=>{t[s]=o.val(e),n++,i&&nP.INTEGER_REGEXP_.test(s)?r=Math.max(r,Number(s)):i=!1}),e||!i||!(r<2*n))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let n in t)e[n]=t[n];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+nE(this.getPriority().val())+":"),this.forEachChild(nN,(t,n)=>{let r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":tc(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let r=this.resolveIndex_(n);if(!r)return this.children_.getPredecessorKey(e);{let n=r.getPredecessorKey(new nf(e,t));return n?n.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new nf(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new nf(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,nf.Wrap),r=n.peek();for(;null!=r&&0>t.compare(r,e);)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,nf.Wrap),r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===nO?-1:0}withIndex(e){if(e===nm||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new nP(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===nm||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority())||this.children_.count()!==e.children_.count())return!1;{let t=this.getIterator(nN),n=e.getIterator(nN),r=t.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=t.getNext(),i=n.getNext()}return null===r&&null===i}}resolveIndex_(e){return e===nm?null:this.indexMap_.get(e.toString())}}nP.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class nM extends nP{constructor(){super(new nb(nx),nP.EMPTY_NODE,nR.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return nP.EMPTY_NODE}isEmpty(){return!1}}let nO=new nM;function nL(e,t=null){if(null===e)return nP.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),P(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new nS(e,nL(t));if(e instanceof Array){let n=nP.EMPTY_NODE;return tT(e,(t,r)=>{if(es(e,t)&&"."!==t.substring(0,1)){let e=nL(r);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(nL(t))}{let n=[],r=!1;if(tT(e,(e,t)=>{if("."!==e.substring(0,1)){let i=nL(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new nf(e,i)))}}),0===n.length)return nP.EMPTY_NODE;let i=nD(n,nw,e=>e.name,nx);if(!r)return new nP(i,nL(t),nR.Default);{let e=nD(n,nN.getCompare());return new nP(i,nL(t),new nR({".priority":e},{".priority":nN}))}}}Object.defineProperties(nf,{MIN:{value:new nf(tx,nP.EMPTY_NODE)},MAX:{value:new nf(tE,nO)}}),ng.__EMPTY_NODE=nP.EMPTY_NODE,nS.__childrenNodeConstructor=nP,o=nO,c=nO,l=nL;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nB extends np{constructor(e){super(),this.indexPath_=e,P(!nr(e)&&".priority"!==t6(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?tC(e.name,t.name):i}makePost(e,t){let n=nL(e);return new nf(t,nP.EMPTY_NODE.updateChild(this.indexPath_,n))}maxPost(){return new nf(tE,nP.EMPTY_NODE.updateChild(this.indexPath_,nO))}toString(){return ne(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nF extends np{compare(e,t){let n=e.node.compareTo(t.node);return 0===n?tC(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return nf.MIN}maxPost(){return nf.MAX}makePost(e,t){return new nf(t,nL(e))}toString(){return".value"}}let nH=new nF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nj(e){return{type:"value",snapshotNode:e}}function nz(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function n$(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function nq(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nU{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){P(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let o=e.getImmediateChild(t);return o.getChild(r).equals(n.getChild(r))&&o.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(n$(t,o)):P(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(nz(t,n)):s.trackChildChange(nq(t,n,o))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return null==n||(e.isLeafNode()||e.forEachChild(nN,(e,r)=>{t.hasChild(e)||n.trackChildChange(n$(e,r))}),t.isLeafNode()||t.forEachChild(nN,(t,r)=>{if(e.hasChild(t)){let i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(nq(t,r,i))}else n.trackChildChange(nz(t,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?nP.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nV{constructor(e){this.indexedFilter_=new nU(e.getIndex()),this.index_=e.getIndex(),this.startPost_=nV.getStartPost_(e),this.endPost_=nV.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),e):0>this.index_.compare(this.getStartPost(),e),n=this.endIsInclusive_?0>=this.index_.compare(e,this.getEndPost()):0>this.index_.compare(e,this.getEndPost());return t&&n}updateChild(e,t,n,r,i,s){return this.matches(new nf(t,n))||(n=nP.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=nP.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(nP.EMPTY_NODE);let i=this;return t.forEachChild(nN,(e,t)=>{i.matches(new nf(e,t))||(r=r.updateImmediateChild(e,nP.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(!e.hasStart())return e.getIndex().minPost();{let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}}static getEndPost_(e){if(!e.hasEnd())return e.getIndex().maxPost();{let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nW{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{let t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new nV(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,i,s){return(this.rangedFilter_.matches(new nf(t,n))||(n=nP.EMPTY_NODE),e.getImmediateChild(t).equals(n))?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=nP.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;r=nP.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){let t=e.getNext();if(this.withinDirectionalStart(t)){if(this.withinDirectionalEnd(t))r=r.updateImmediateChild(t.name,t.node),n++;else break}}}else{let e;r=(r=t.withIndex(this.index_)).updatePriority(nP.EMPTY_NODE),e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let n=0;for(;e.hasNext();){let t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:r=r.updateImmediateChild(t.name,nP.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){let e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();P(e.numChildren()===this.limit_,"");let o=new nf(t,n),a=this.reverse_?e.getFirstChild(this.index_):e.getLastChild(this.index_),l=this.rangedFilter_.matches(o);if(e.hasChild(t)){let c=e.getImmediateChild(t),u=r.getChildAfterChild(this.index_,a,this.reverse_);for(;null!=u&&(u.name===t||e.hasChild(u.name));)u=r.getChildAfterChild(this.index_,u,this.reverse_);let h=null==u?1:s(u,o);if(l&&!n.isEmpty()&&h>=0)return null!=i&&i.trackChildChange(nq(t,n,c)),e.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(n$(t,c));let n=e.updateImmediateChild(t,nP.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(null!=i&&i.trackChildChange(nz(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}return n.isEmpty()?e:l&&s(a,o)>=0?(null!=i&&(i.trackChildChange(n$(a.name,a.node)),i.trackChildChange(nz(t,n))),e.updateImmediateChild(t,n).updateImmediateChild(a.name,nP.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nY{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=nN}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return P(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(P(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:tx}hasEnd(){return this.endSet_}getIndexEndValue(){return P(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(P(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:tE}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return P(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===nN}copy(){let e=new nY;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function nK(e){let t;let n={};if(e.isDefault())return n;if(e.index_===nN?t="$priority":e.index_===nH?t="$value":e.index_===nm?t="$key":(P(e.index_ instanceof nB,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=et(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";n[t]=et(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+et(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";n[t]=et(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+et(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function nG(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==nN&&(t.i=e.index_.toString()),t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nX extends t1{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=tg("p:rest:"),this.listens_={}}reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(P(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){let i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);let s=nX.getListenId_(e,n),o={};this.listens_[s]=o;let a=nK(e._queryParams);this.restRequest_(i+".json",a,(e,t)=>{let a=t;404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),eo(this.listens_,s)===o&&r(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}unlisten(e,t){let n=nX.getListenId_(e,t);delete this.listens_[n]}get(e){let t=nK(e._queryParams),n=e._path.toString(),r=new G;return this.restRequest_(n+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(Error(i))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function(e){let t=[];for(let[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}(t);this.log_("Sending REST request for "+s);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=ee(o.responseText)}catch(e){ty("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&ty("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nQ{constructor(){this.rootNode_=nP.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nZ(){return{value:null,children:new Map}}function nJ(e,t,n){if(nr(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{let r=t6(t);e.children.has(r)||e.children.set(r,nZ()),nJ(e.children.get(r),t=t7(t),n)}}function n0(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((e,n)=>{t(n,e)})}(e,(e,r)=>{n0(r,new t5(t.toString()+"/"+e),n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n1{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&tT(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class n2{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new n1(e),tM(this.reportStats_.bind(this),Math.floor(1e4+2e4*Math.random()))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;tT(e,(e,r)=>{r>0&&es(this.statsToReport_,e)&&(t[e]=r,n=!0)}),n&&this.server_.reportStats(t),tM(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function n3(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function n5(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function n4(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(lp||(lp={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n6{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=lp.ACK_USER_WRITE,this.source=n3()}operationForChild(e){if(!nr(this.path))return P(t6(this.path)===e,"operationForChild called for unrelated child."),new n6(t7(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return P(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new t5(e));return new n6(t4(),t,this.revert)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n8{constructor(e,t){this.source=e,this.path=t,this.type=lp.LISTEN_COMPLETE}operationForChild(e){return nr(this.path)?new n8(this.source,t4()):new n8(this.source,t7(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n7{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=lp.OVERWRITE}operationForChild(e){return nr(this.path)?new n7(this.source,t4(),this.snap.getImmediateChild(e)):new n7(this.source,t7(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n9{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=lp.MERGE}operationForChild(e){if(!nr(this.path))return P(t6(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n9(this.source,t7(this.path),this.children);{let t=this.children.subtree(new t5(e));return t.isEmpty()?null:t.value?new n7(this.source,t4(),t.value):new n9(this.source,t4(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class re{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(nr(e))return this.isFullyInitialized()&&!this.filtered_;let t=t6(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rt{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function rn(e,t,n,r,i,s){let o=r.filter(e=>e.type===n);o.sort((t,n)=>(function(e,t,n){if(null==t.childName||null==n.childName)throw M("Should only compare child_ events.");let r=new nf(t.childName,t.snapshotNode),i=new nf(n.childName,n.snapshotNode);return e.index_.compare(r,i)})(e,t,n)),o.forEach(n=>{let r=("value"===n.type||"child_removed"===n.type||(n.prevName=s.getPredecessorChildName(n.childName,n.snapshotNode,e.index_)),n);i.forEach(i=>{i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))})})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rr(e,t){return{eventCache:e,serverCache:t}}function ri(e,t,n,r){return rr(new re(t,n,r),e.serverCache)}function rs(e,t,n,r){return rr(e.eventCache,new re(t,n,r))}function ro(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function ra(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let rl=()=>(d||(d=new nb(tS)),d);class rc{constructor(e,t=rl()){this.value=e,this.children=t}static fromObject(e){let t=new rc(null);return tT(e,(e,n)=>{t=t.set(new t5(e),n)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:t4(),value:this.value};if(nr(e))return null;{let n=t6(e),r=this.children.get(n);if(null===r)return null;{let i=r.findRootMostMatchingPathAndValue(t7(e),t);return null!=i?{path:nn(new t5(n),i.path),value:i.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(nr(e))return this;{let t=t6(e),n=this.children.get(t);return null!==n?n.subtree(t7(e)):new rc(null)}}set(e,t){if(nr(e))return new rc(t,this.children);{let n=t6(e),r=(this.children.get(n)||new rc(null)).set(t7(e),t),i=this.children.insert(n,r);return new rc(this.value,i)}}remove(e){if(nr(e))return this.children.isEmpty()?new rc(null):new rc(null,this.children);{let t=t6(e),n=this.children.get(t);if(!n)return this;{let r;let i=n.remove(t7(e));return(r=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&r.isEmpty())?new rc(null):new rc(this.value,r)}}}get(e){if(nr(e))return this.value;{let t=t6(e),n=this.children.get(t);return n?n.get(t7(e)):null}}setTree(e,t){if(nr(e))return t;{let n;let r=t6(e),i=(this.children.get(r)||new rc(null)).setTree(t7(e),t);return n=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new rc(this.value,n)}}fold(e){return this.fold_(t4(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((r,i)=>{n[r]=i.fold_(nn(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,t4(),t)}findOnPath_(e,t,n){let r=!!this.value&&n(t,this.value);if(r)return r;if(nr(e))return null;{let r=t6(e),i=this.children.get(r);return i?i.findOnPath_(t7(e),nn(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,t4(),t)}foreachOnPath_(e,t,n){if(nr(e))return this;{this.value&&n(t,this.value);let r=t6(e),i=this.children.get(r);return i?i.foreachOnPath_(t7(e),nn(t,r),n):new rc(null)}}foreach(e){this.foreach_(t4(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(nn(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ru{constructor(e){this.writeTree_=e}static empty(){return new ru(new rc(null))}}function rh(e,t,n){if(nr(t))return new ru(new rc(n));{let r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){let i=r.path,s=r.value,o=ni(i,t);return s=s.updateChild(o,n),new ru(e.writeTree_.set(i,s))}{let r=new rc(n);return new ru(e.writeTree_.setTree(t,r))}}}function rd(e,t,n){let r=e;return tT(n,(e,n)=>{r=rh(r,nn(t,e),n)}),r}function rf(e,t){return nr(t)?ru.empty():new ru(e.writeTree_.setTree(t,new rc(null)))}function rp(e,t){return null!=rg(e,t)}function rg(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(ni(n.path,t)):null}function rm(e){let t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(nN,(e,n)=>{t.push(new nf(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new nf(e,n.value))}),t}function r_(e,t){if(nr(t))return e;{let n=rg(e,t);return new ru(null!=n?new rc(n):e.writeTree_.subtree(t))}}function ry(e){return e.writeTree_.isEmpty()}function rv(e,t){return function e(t,n,r){if(null!=n.value)return r.updateChild(t,n.value);{let i=null;return n.children.inorderTraversal((n,s)=>{".priority"===n?(P(null!==s.value,"Priority writes must always be leaf nodes"),i=s.value):r=e(nn(t,n),s,r)}),r.getChild(t).isEmpty()||null===i||(r=r.updateChild(nn(t,".priority"),i)),r}}(t4(),e.writeTree_,t)}function rb(e){return e.visible}function rw(e,t,n){let r=ru.empty();for(let i=0;i<e.length;++i){let s=e[i];if(t(s)){let e;let t=s.path;if(s.snap)na(n,t)?r=rh(r,e=ni(n,t),s.snap):na(t,n)&&(e=ni(t,n),r=rh(r,t4(),s.snap.getChild(e)));else if(s.children){if(na(n,t))r=rd(r,e=ni(n,t),s.children);else if(na(t,n)){if(nr(e=ni(t,n)))r=rd(r,t4(),s.children);else{let t=eo(s.children,t6(e));if(t){let n=t.getChild(t7(e));r=rh(r,t4(),n)}}}}else throw M("WriteRecord should have .snap or .children")}}return r}function rx(e,t,n,r,i){if(r||i){let s=r_(e.visibleWrites,t);return!i&&ry(s)?n:i||null!=n||rp(s,t4())?rv(rw(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(na(e.path,t)||na(t,e.path))},t),n||nP.EMPTY_NODE):null}{let r=rg(e.visibleWrites,t);if(null!=r)return r;{let r=r_(e.visibleWrites,t);return ry(r)?n:null!=n||rp(r,t4())?rv(r,n||nP.EMPTY_NODE):null}}}function rE(e,t,n,r){return rx(e.writeTree,e.treePath,t,n,r)}function rC(e,t){return function(e,t,n){let r=nP.EMPTY_NODE,i=rg(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(nN,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(!n)return rm(r_(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r;{let i=r_(e.visibleWrites,t);return n.forEachChild(nN,(e,t)=>{let n=rv(r_(i,new t5(e)),t);r=r.updateImmediateChild(e,n)}),rm(i).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}}(e.writeTree,e.treePath,t)}function rS(e,t,n,r){return function(e,t,n,r,i){P(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=nn(t,n);if(rp(e.visibleWrites,s))return null;{let t=r_(e.visibleWrites,s);return ry(t)?i.getChild(n):rv(t,i.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function rk(e,t){var n,r;return n=e.writeTree,r=nn(e.treePath,t),rg(n.visibleWrites,r)}function rN(e,t,n){return function(e,t,n,r){let i=nn(t,n),s=rg(e.visibleWrites,i);return null!=s?s:r.isCompleteForChild(n)?rv(r_(e.visibleWrites,i),r.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function rI(e,t){return rT(nn(e.treePath,t),e.writeTree)}function rT(e,t){return{treePath:e,writeTree:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rD{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;P("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),P(".priority"!==n,"Only non-priority child changes can be tracked.");let r=this.changeMap.get(n);if(r){let i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,nq(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,n$(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,nz(n,e.snapshotNode));else if("child_changed"===t&&"child_changed"===i)this.changeMap.set(n,nq(n,e.snapshotNode,r.oldSnap));else throw M("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rA{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}}let rR=new rA;class rP{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new re(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return rN(this.writes_,e,t)}}getChildAfterChild(e,t,n){var r;let i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:ra(this.viewCache_),s=function(e,t,n,r,i,s,o){let a;let l=r_(e.visibleWrites,t),c=rg(l,t4());if(null!=c)a=c;else{if(null==n)return[];a=rv(l,n)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];{let e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),i=n.getNext();for(;i&&e.length<1;)0!==t(i,r)&&e.push(i),i=n.getNext();return e}}((r=this.writes_).writeTree,r.treePath,i,t,0,n,e);return 0===s.length?null:s[0]}}function rM(e,t,n,r,i,s){let o=t.eventCache;if(null!=rk(r,n))return t;{let a,l;if(nr(n)){if(P(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let n=ra(t),i=rC(r,n instanceof nP?n:nP.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{let n=rE(r,ra(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}}else{let c=t6(n);if(".priority"===c){P(1===t8(n),"Can't have a priority with additional path components");let i=o.getNode(),s=rS(r,n,i,l=t.serverCache.getNode());a=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{let u;let h=t7(n);if(o.isCompleteForChild(c)){l=t.serverCache.getNode();let e=rS(r,n,o.getNode(),l);u=null!=e?o.getNode().getImmediateChild(c).updateChild(h,e):o.getNode().getImmediateChild(c)}else u=rN(r,c,t.serverCache);a=null!=u?e.filter.updateChild(o.getNode(),c,u,h,i,s):o.getNode()}}return ri(t,a,o.isFullyInitialized()||nr(n),e.filter.filtersNodes())}}function rO(e,t,n,r,i,s,o,a){let l;let c=t.serverCache,u=o?e.filter:e.filter.getIndexedFilter();if(nr(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){let e=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),e,null)}else{let e=t6(n);if(!c.isCompleteForPath(n)&&t8(n)>1)return t;let i=t7(n),s=c.getNode().getImmediateChild(e).updateChild(i,r);l=".priority"===e?u.updatePriority(c.getNode(),s):u.updateChild(c.getNode(),e,s,i,rR,null)}let h=rs(t,l,c.isFullyInitialized()||nr(n),u.filtersNodes()),d=new rP(i,h,s);return rM(e,h,n,i,d,a)}function rL(e,t,n,r,i,s,o){let a,l;let c=t.eventCache,u=new rP(i,t,s);if(nr(n))l=e.filter.updateFullNode(t.eventCache.getNode(),r,o),a=ri(t,l,!0,e.filter.filtersNodes());else{let i=t6(n);if(".priority"===i)l=e.filter.updatePriority(t.eventCache.getNode(),r),a=ri(t,l,c.isFullyInitialized(),c.isFiltered());else{let s;let l=t7(n),h=c.getNode().getImmediateChild(i);if(nr(l))s=r;else{let e=u.getCompleteChild(i);s=null!=e?".priority"===t9(l)&&e.getChild(nt(l)).isEmpty()?e:e.updateChild(l,r):nP.EMPTY_NODE}a=h.equals(s)?t:ri(t,e.filter.updateChild(c.getNode(),i,s,l,u,o),c.isFullyInitialized(),e.filter.filtersNodes())}}return a}function rB(e,t){return e.eventCache.isCompleteForChild(t)}function rF(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function rH(e,t,n,r,i,s,o,a){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c=t;l=nr(n)?r:new rc(null).setTree(n,r);let u=t.serverCache.getNode();return l.children.inorderTraversal((n,r)=>{if(u.hasChild(n)){let l=rF(e,t.serverCache.getNode().getImmediateChild(n),r);c=rO(e,c,new t5(n),l,i,s,o,a)}}),l.children.inorderTraversal((n,r)=>{let l=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!u.hasChild(n)&&!l){let l=rF(e,t.serverCache.getNode().getImmediateChild(n),r);c=rO(e,c,new t5(n),l,i,s,o,a)}}),c}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rj{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let n=this.query_._queryParams,r=new nU(n.getIndex()),i=function(e){return e.loadsAllData()?new nU(e.getIndex()):e.hasLimit()?new nW(e):new nV(e)}(n);this.processor_={filter:i};let s=t.serverCache,o=t.eventCache,a=r.updateFullNode(nP.EMPTY_NODE,s.getNode(),null),l=i.updateFullNode(nP.EMPTY_NODE,o.getNode(),null),c=new re(a,s.isFullyInitialized(),r.filtersNodes()),u=new re(l,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=rr(u,c),this.eventGenerator_=new rt(this.query_)}get query(){return this.query_}}function rz(e){return 0===e.eventRegistrations_.length}function r$(e,t,n){let r=[];if(n){P(null==t,"A cancel should cancel all event registrations.");let i=e.query._path;e.eventRegistrations_.forEach(e=>{let t=e.createCancelEvent(n,i);t&&r.push(t)})}if(t){let n=[];for(let r=0;r<e.eventRegistrations_.length;++r){let i=e.eventRegistrations_[r];if(i.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(r+1));break}}else n.push(i)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return r}function rq(e,t,n,r){var i,s;t.type===lp.MERGE&&null!==t.source.queryId&&(P(ra(e.viewCache_),"We should always have a full cache before handling merges"),P(ro(e.viewCache_),"Missing event cache, even though we have a server cache"));let o=e.viewCache_,a=function(e,t,n,r,i){let s,o;let a=new rD;if(n.type===lp.OVERWRITE)n.source.fromUser?s=rL(e,t,n.path,n.snap,r,i,a):(P(n.source.fromServer,"Unknown source."),o=n.source.tagged||t.serverCache.isFiltered()&&!nr(n.path),s=rO(e,t,n.path,n.snap,r,i,o,a));else if(n.type===lp.MERGE){var l,c;let u;n.source.fromUser?(l=n.path,c=n.children,u=t,c.foreach((n,s)=>{let o=nn(l,n);rB(t,t6(o))&&(u=rL(e,u,o,s,r,i,a))}),c.foreach((n,s)=>{let o=nn(l,n);rB(t,t6(o))||(u=rL(e,u,o,s,r,i,a))}),s=u):(P(n.source.fromServer,"Unknown source."),o=n.source.tagged||t.serverCache.isFiltered(),s=rH(e,t,n.path,n.children,r,i,o,a))}else if(n.type===lp.ACK_USER_WRITE)s=n.revert?function(e,t,n,r,i,s){let o;if(null!=rk(r,n))return t;{let a;let l=new rP(r,t,i),c=t.eventCache.getNode();if(nr(n)||".priority"===t6(n)){let n;if(t.serverCache.isFullyInitialized())n=rE(r,ra(t));else{let e=t.serverCache.getNode();P(e instanceof nP,"serverChildren would be complete if leaf node"),n=rC(r,e)}a=e.filter.updateFullNode(c,n,s)}else{let i=t6(n),u=rN(r,i,t.serverCache);null==u&&t.serverCache.isCompleteForChild(i)&&(u=c.getImmediateChild(i)),(a=null!=u?e.filter.updateChild(c,i,u,t7(n),l,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(c,i,nP.EMPTY_NODE,t7(n),l,s):c).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=rE(r,ra(t))).isLeafNode()&&(a=e.filter.updateFullNode(a,o,s))}return o=t.serverCache.isFullyInitialized()||null!=rk(r,t4()),ri(t,a,o,e.filter.filtersNodes())}}(e,t,n.path,r,i,a):function(e,t,n,r,i,s,o){if(null!=rk(i,n))return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=r.value){if(nr(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return rO(e,t,n,l.getNode().getChild(n),i,s,a,o);if(!nr(n))return t;{let r=new rc(null);return l.getNode().forEachChild(nm,(e,t)=>{r=r.set(new t5(e),t)}),rH(e,t,n,r,i,s,a,o)}}{let c=new rc(null);return r.foreach((e,t)=>{let r=nn(n,e);l.isCompleteForPath(r)&&(c=c.set(e,l.getNode().getChild(r)))}),rH(e,t,n,c,i,s,a,o)}}(e,t,n.path,n.affectedTree,r,i,a);else if(n.type===lp.LISTEN_COMPLETE)s=function(e,t,n,r,i){let s=t.serverCache;return rM(e,rs(t,s.getNode(),s.isFullyInitialized()||nr(n),s.isFiltered()),n,r,rR,i)}(e,t,n.path,r,a);else throw M("Unknown operation type: "+n.type);let u=a.getChanges();return function(e,t,n){let r=t.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=ro(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!i||r.getNode().equals(s))&&r.getNode().getPriority().equals(s.getPriority())||n.push(nj(ro(t)))}}(t,s,u),{viewCache:s,changes:u}}(e.processor_,o,t,n,r);return i=e.processor_,P((s=a.viewCache).eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),P(s.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed"),P(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,rU(e,a.changes,a.viewCache.eventCache.getNode(),null)}function rU(e,t,n,r){let i=r?[r]:e.eventRegistrations_;return function(e,t,n,r){let i=[],s=[];return t.forEach(t=>{if("child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)){var n;s.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))}}),rn(e,i,"child_removed",t,r,n),rn(e,i,"child_added",t,r,n),rn(e,i,"child_moved",s,r,n),rn(e,i,"child_changed",t,r,n),rn(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,i)}class rV{constructor(){this.views=new Map}}function rW(e,t,n,r){let i=t.source.queryId;if(null!==i){let s=e.views.get(i);return P(null!=s,"SyncTree gave us an op for an invalid query."),rq(s,t,n,r)}{let i=[];for(let s of e.views.values())i=i.concat(rq(s,t,n,r));return i}}function rY(e,t,n,r,i){let s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=rE(n,i?r:null),s=!1;return e?s=!0:(e=r instanceof nP?rC(n,r):nP.EMPTY_NODE,s=!1),new rj(t,rr(new re(e,s,!1),new re(r,i,!1)))}return o}function rK(e){let t=[];for(let n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function rG(e,t){let n=null;for(let r of e.views.values())n=n||function(e,t){let n=ra(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!nr(t)&&!n.getImmediateChild(t6(t)).isEmpty())?n.getChild(t):null}(r,t);return n}function rX(e,t){if(t._queryParams.loadsAllData())return rZ(e);{let n=t._queryIdentifier;return e.views.get(n)}}function rQ(e){return null!=rZ(e)}function rZ(e){for(let t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let rJ=1;class r0{constructor(e){this.listenProvider_=e,this.syncPointTree_=new rc(null),this.pendingWriteTree_={visibleWrites:ru.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function r1(e,t,n,r,i){var s,o;return(s=e.pendingWriteTree_,o=i,P(r>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),s.allWrites.push({path:t,snap:n,writeId:r,visible:o}),o&&(s.visibleWrites=rh(s.visibleWrites,t,n)),s.lastWriteId=r,i)?r7(e,new n7(n3(),t,n)):[]}function r2(e,t,n=!1){let r=function(e,t){for(let n=0;n<e.allWrites.length;n++){let r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(!function(e,t){let n=e.allWrites.findIndex(e=>e.writeId===t);P(n>=0,"removeWrite called with nonexistent writeId.");let r=e.allWrites[n];e.allWrites.splice(n,1);let i=r.visible,s=!1,o=e.allWrites.length-1;for(;i&&o>=0;){let t=e.allWrites[o];t.visible&&(o>=n&&function(e,t){if(e.snap)return na(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&na(nn(e.path,n),t))return!0;return!1}(t,r.path)?i=!1:na(r.path,t.path)&&(s=!0)),o--}return!!i&&(s?(e.visibleWrites=rw(e.allWrites,rb,t4()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):r.snap?e.visibleWrites=rf(e.visibleWrites,r.path):tT(r.children,t=>{e.visibleWrites=rf(e.visibleWrites,nn(r.path,t))}),!0)}(e.pendingWriteTree_,t))return[];{let t=new rc(null);return null!=r.snap?t=t.set(t4(),!0):tT(r.children,e=>{t=t.set(new t5(e),!0)}),r7(e,new n6(r.path,t,n))}}function r3(e,t,n){return r7(e,new n7(n5(),t,n))}function r5(e,t,n,r,i=!1){let s=t._path,o=e.syncPointTree_.get(s),a=[];if(o&&("default"===t._queryIdentifier||null!=rX(o,t))){let l=function(e,t,n,r){let i=t._queryIdentifier,s=[],o=[],a=rQ(e);if("default"===i)for(let[t,i]of e.views.entries())o=o.concat(r$(i,n,r)),rz(i)&&(e.views.delete(t),i.query._queryParams.loadsAllData()||s.push(i.query));else{let t=e.views.get(i);t&&(o=o.concat(r$(t,n,r)),rz(t)&&(e.views.delete(i),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!rQ(e)&&s.push(new(P(f,"Reference.ts has not been loaded"),f)(t._repo,t._path)),{removed:s,events:o}}(o,t,n,r);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));let c=l.removed;if(a=l.events,!i){let n=-1!==c.findIndex(e=>e._queryParams.loadsAllData()),i=e.syncPointTree_.findOnPath(s,(e,t)=>rQ(t));if(n&&!i){let t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){let n=t.fold((e,t,n)=>{if(t&&rQ(t))return[rZ(t)];{let e=[];return t&&(e=rK(t)),tT(n,(t,n)=>{e=e.concat(n)}),e}});for(let t=0;t<n.length;++t){let r=n[t],i=r.query,s=r9(e,r);e.listenProvider_.startListening(io(i),ie(e,i),s.hashFn,s.onComplete)}}}i||!(c.length>0)||r||(n?e.listenProvider_.stopListening(io(t),null):c.forEach(t=>{let n=e.queryToTagMap.get(it(t));e.listenProvider_.stopListening(io(t),n)}))}(function(e,t){for(let n=0;n<t.length;++n){let r=t[n];if(!r._queryParams.loadsAllData()){let t=it(r),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}})(e,c)}return a}function r4(e,t,n,r){let i=ir(e,r);if(null==i)return[];{let r=ii(i),s=r.path,o=r.queryId,a=ni(s,t);return is(e,s,new n7(n4(o),a,n))}}function r6(e,t,n,r=!1){let i;let s=t._path,o=null,a=!1;e.syncPointTree_.foreachOnPath(s,(e,t)=>{let n=ni(e,s);o=o||rG(t,n),a=a||rQ(t)});let l=e.syncPointTree_.get(s);l?(a=a||rQ(l),o=o||rG(l,t4())):(l=new rV,e.syncPointTree_=e.syncPointTree_.set(s,l)),null!=o?i=!0:(i=!1,o=nP.EMPTY_NODE,e.syncPointTree_.subtree(s).foreachChild((e,t)=>{let n=rG(t,t4());n&&(o=o.updateImmediateChild(e,n))}));let c=null!=rX(l,t);if(!c&&!t._queryParams.loadsAllData()){let n=it(t);P(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");let r=rJ++;e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}let u=function(e,t,n,r,i,s){let o=rY(e,t,r,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){let n=e.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(nN,(e,t)=>{r.push(nz(e,t))}),n.isFullyInitialized()&&r.push(nj(n.getNode())),rU(e,r,n.getNode(),t)}(o,n)}(l,t,n,rT(s,e.pendingWriteTree_),o,i);if(!c&&!a&&!r){let n=rX(l,t);u=u.concat(function(e,t,n){let r=t._path,i=ie(e,t),s=r9(e,n),o=e.listenProvider_.startListening(io(t),i,s.hashFn,s.onComplete),a=e.syncPointTree_.subtree(r);if(i)P(!rQ(a.value),"If we're adding a query, it shouldn't be shadowed");else{let t=a.fold((e,t,n)=>{if(!nr(e)&&t&&rQ(t))return[rZ(t).query];{let e=[];return t&&(e=e.concat(rK(t).map(e=>e.query))),tT(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){let r=t[n];e.listenProvider_.stopListening(io(r),ie(e,r))}}return o}(e,t,n))}return u}function r8(e,t,n){let r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,n)=>{let r=rG(n,ni(e,t));if(r)return r});return rx(r,t,i,n,!0)}function r7(e,t){var n;return function e(t,n,r,i){if(nr(t.path))return function e(t,n,r,i){let s=n.get(t4());null==r&&null!=s&&(r=rG(s,t4()));let o=[];return n.children.inorderTraversal((n,s)=>{let a=r?r.getImmediateChild(n):null,l=rI(i,n),c=t.operationForChild(n);c&&(o=o.concat(e(c,s,a,l)))}),s&&(o=o.concat(rW(s,t,i,r))),o}(t,n,r,i);{let s=n.get(t4());null==r&&null!=s&&(r=rG(s,t4()));let o=[],a=t6(t.path),l=t.operationForChild(a),c=n.children.get(a);if(c&&l){let t=r?r.getImmediateChild(a):null,n=rI(i,a);o=o.concat(e(l,c,t,n))}return s&&(o=o.concat(rW(s,t,i,r))),o}}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,rT(t4(),n)))}function r9(e,t){let n=t.query,r=ie(e,n);return{hashFn:()=>(t.viewCache_.serverCache.getNode()||nP.EMPTY_NODE).hash(),onComplete:t=>{if("ok"===t){var i;return r?function(e,t,n){let r=ir(e,n);if(!r)return[];{let n=ii(r),i=n.path,s=n.queryId,o=ni(i,t);return is(e,i,new n8(n4(s),o))}}(e,n._path,r):(i=n._path,r7(e,new n8(n5(),i)))}{let r=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");let r=Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(t,n);return r5(e,n,null,r)}}}}function ie(e,t){let n=it(t);return e.queryToTagMap.get(n)}function it(e){return e._path.toString()+"$"+e._queryIdentifier}function ir(e,t){return e.tagToQueryMap.get(t)}function ii(e){let t=e.indexOf("$");return P(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new t5(e.substr(0,t))}}function is(e,t,n){let r=e.syncPointTree_.get(t);return P(r,"Missing sync point for query tag that we're tracking"),rW(r,n,rT(t,e.pendingWriteTree_),null)}function io(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(P(p,"Reference.ts has not been loaded"),p)(e._repo,e._path):e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia{constructor(e){this.node_=e}getImmediateChild(e){return new ia(this.node_.getImmediateChild(e))}node(){return this.node_}}class il{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=nn(this.path_,e);return new il(this.syncTree_,t)}node(){return r8(this.syncTree_,this.path_)}}let ic=function(e,t,n){return e&&"object"==typeof e?(P(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?iu(e[".sv"],t,n):"object"==typeof e[".sv"]?ih(e[".sv"],t):void P(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},iu=function(e,t,n){if("timestamp"===e)return n.timestamp;P(!1,"Unexpected server value: "+e)},ih=function(e,t,n){e.hasOwnProperty("increment")||P(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let r=e.increment;"number"!=typeof r&&P(!1,"Unexpected increment value: "+r);let i=t.node();if(P(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let s=i.getValue();return"number"!=typeof s?r:s+r},id=function(e,t,n,r){return ig(t,new il(n,e),r)},ip=function(e,t,n){return ig(e,new ia(t),n)};function ig(e,t,n){let r;let i=ic(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return r=e,i!==e.getPriority().val()&&(r=r.updatePriority(new nS(i))),e.forEachChild(nN,(e,i)=>{let s=ig(i,t.getImmediateChild(e),n);s!==i&&(r=r.updateImmediateChild(e,s))}),r;{let r=ic(e.getValue(),t,n);return r!==e.getValue()||i!==e.getPriority().val()?new nS(r,nL(i)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class im{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function i_(e,t){let n=t instanceof t5?t:new t5(t),r=e,i=t6(n);for(;null!==i;){let e=eo(r.node.children,i)||{children:{},childCount:0};r=new im(i,r,e),i=t6(n=t7(n))}return r}function iy(e){return e.node.value}function iv(e,t){e.node.value=t,function e(t){null!==t.parent&&function(t,n,r){let i=void 0===iy(r)&&!ib(r),s=es(t.node.children,n);i&&s?(delete t.node.children[n],t.node.childCount--,e(t)):i||s||(t.node.children[n]=r.node,t.node.childCount++,e(t))}(t.parent,t.name,t)}(e)}function ib(e){return e.node.childCount>0}function iw(e,t){tT(e.node.children,(n,r)=>{t(new im(n,e,r))})}function ix(e){return new t5(null===e.parent?e.name:ix(e.parent)+"/"+e.name)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iE=/[\[\].#$\/\u0000-\u001F\u007F]/,iC=/[\[\].#$\u0000-\u001F\u007F]/,iS=function(e){return"string"==typeof e&&0!==e.length&&!iE.test(e)},ik=function(e){return"string"==typeof e&&0!==e.length&&!iC.test(e)},iN=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!tb(e)||e&&"object"==typeof e&&es(e,".sv")},iI=function(e,t,n,r){r&&void 0===t||iT(ed(e,"value"),t,n)},iT=function(e,t,n){let r=n instanceof t5?new nl(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+nu(r));if("function"==typeof t)throw Error(e+"contains a function "+nu(r)+" with contents = "+t.toString());if(tb(t))throw Error(e+"contains "+t.toString()+" "+nu(r));if("string"==typeof t&&t.length>3495253.3333333335&&ep(t)>10485760)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+nu(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,i=!1;if(tT(t,(t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!iS(t)))throw Error(e+" contains an invalid key ("+t+") "+nu(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.parts_.length>0&&(r.byteLength_+=1),r.parts_.push(t),r.byteLength_+=ep(t),nc(r),iT(e,s,r),function(e){let t=e.parts_.pop();e.byteLength_-=ep(t),e.parts_.length>0&&(e.byteLength_-=1)}(r)}),n&&i)throw Error(e+' contains ".value" child '+nu(r)+" in addition to actual children.")}},iD=function(e,t){let n,r;for(n=0;n<t.length;n++){let i=ne(r=t[n]);for(let t=0;t<i.length;t++)if(".priority"===i[t]&&t===i.length-1);else if(!iS(i[t]))throw Error(e+"contains an invalid key ("+i[t]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(ns);let i=null;for(n=0;n<t.length;n++){if(r=t[n],null!==i&&na(i,r))throw Error(e+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},iA=function(e,t,n,r){if(r&&void 0===t)return;let i=ed(e,"values");if(!(t&&"object"==typeof t)||Array.isArray(t))throw Error(i+" must be an object containing the children to replace.");let s=[];tT(t,(e,t)=>{let r=new t5(e);if(iT(i,t,nn(n,r)),".priority"===t9(r)&&!iN(t))throw Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(r)}),iD(i,s)},iR=function(e,t,n,r){if((!r||void 0!==n)&&!ik(n))throw Error(ed(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},iP=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),iR(e,t,n,r)},iM=function(e,t){if(".info"===t6(t))throw Error(e+" failed = Can't modify data under /.info/")},iO=function(e,t){var n;let r=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!iS(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==r.length&&((n=r)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),!ik(n)))throw Error(ed(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iL{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function iB(e,t){let n=null;for(let r=0;r<t.length;r++){let i=t[r],s=i.getPath();null===n||no(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(i)}n&&e.eventLists_.push(n)}function iF(e,t,n){iB(e,n),ij(e,e=>no(e,t))}function iH(e,t,n){iB(e,n),ij(e,e=>na(e,t)||na(t,e))}function ij(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){let i=e.eventLists_[r];i&&(t(i.path)?(function(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(null!==n){e.events[t]=null;let r=n.getEventRunner();th&&tp("event: "+n.toString()),tP(r)}}}(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}class iz{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new iL,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=nZ(),this.transactionQueueTree_=new im,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function i$(e){var t;return(t=t={timestamp:function(e){let t=e.infoData_.getNode(new t5(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}(e)}).timestamp=t.timestamp||new Date().getTime(),t}function iq(e,t,n,r,i){e.dataUpdateCount++;let s=new t5(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i){if(r){let t=el(n,e=>nL(e));o=function(e,t,n,r){let i=ir(e,r);if(!i)return[];{let r=ii(i),s=r.path,o=r.queryId,a=ni(s,t),l=rc.fromObject(n);return is(e,s,new n9(n4(o),a,l))}}(e.serverSyncTree_,s,t,i)}else{let t=nL(n);o=r4(e.serverSyncTree_,s,t,i)}}else if(r){let t=el(n,e=>nL(e));o=function(e,t,n){let r=rc.fromObject(n);return r7(e,new n9(n5(),t,r))}(e.serverSyncTree_,s,t)}else{let t=nL(n);o=r3(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=iQ(e,s)),iH(e.eventQueue_,a,o)}function iU(e,t){iV(e,"connected",t),!1===t&&function(e){iK(e,"onDisconnectEvents");let t=i$(e),n=nZ();n0(e.onDisconnect_,t4(),(r,i)=>{let s=id(r,i,e.serverSyncTree_,t);nJ(n,r,s)});let r=[];n0(n,t4(),(t,n)=>{r=r.concat(r3(e.serverSyncTree_,t,n));let i=i1(e,t);iQ(e,i)}),e.onDisconnect_=nZ(),iH(e.eventQueue_,t4(),r)}(e)}function iV(e,t,n){let r=new t5("/.info/"+t),i=nL(n);e.infoData_.updateSnapshot(r,i);let s=r3(e.infoSyncTree_,r,i);iH(e.eventQueue_,r,s)}function iW(e){return e.nextWriteId_++}function iY(e,t,n){let r;r=".info"===t6(t._path)?r5(e.infoSyncTree_,t,n):r5(e.serverSyncTree_,t,n),iF(e.eventQueue_,t._path,r)}function iK(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),tp(n,...t)}function iG(e,t,n,r){t&&tP(()=>{if("ok"===n)t(null);else{let e=(n||"error").toUpperCase(),i=e;r&&(i+=": "+r);let s=Error(i);s.code=e,t(s)}})}function iX(e,t,n){return r8(e.serverSyncTree_,t,n)||nP.EMPTY_NODE}function iQ(e,t){let n=iZ(e,t),r=ix(n),i=iJ(e,n);return function(e,t,n){if(0===t.length)return;let r=[],i=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let a=t[o],l=ni(n,a.path),c=!1,u;if(P(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)c=!0,u=a.abortReason,i=i.concat(r2(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status){if(a.retryCount>=25)c=!0,u="maxretry",i=i.concat(r2(e.serverSyncTree_,a.currentWriteId,!0));else{let n=iX(e,a.path,s);a.currentInputSnapshot=n;let r=t[o].update(n.val());if(void 0!==r){iT("transaction failed: Data returned ",r,a.path);let t=nL(r);"object"==typeof r&&null!=r&&es(r,".priority")||(t=t.updatePriority(n.getPriority()));let o=a.currentWriteId,l=ip(t,n,i$(e));a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=l,a.currentWriteId=iW(e),s.splice(s.indexOf(o),1),i=(i=i.concat(r1(e.serverSyncTree_,a.path,l,a.currentWriteId,a.applyLocally))).concat(r2(e.serverSyncTree_,o,!0))}else c=!0,u="nodata",i=i.concat(r2(e.serverSyncTree_,a.currentWriteId,!0))}}iH(e.eventQueue_,n,i),i=[],c&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&("nodata"===u?r.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):r.push(()=>t[o].onComplete(Error(u),!1,null))))}i0(e,e.transactionQueueTree_);for(let e=0;e<r.length;e++)tP(r[e]);(function e(t,n=t.transactionQueueTree_){if(n||i0(t,n),iy(n)){let r=iJ(t,n);P(r.length>0,"Sending zero length transaction queue"),r.every(e=>0===e.status)&&function(t,n,r){let i=iX(t,n,r.map(e=>e.currentWriteId)),s=i,o=i.hash();for(let e=0;e<r.length;e++){let t=r[e];P(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;let i=ni(n,t.path);s=s.updateChild(i,t.currentOutputSnapshotRaw)}let a=s.val(!0);t.server_.put(n.toString(),a,i=>{iK(t,"transaction put response",{path:n.toString(),status:i});let s=[];if("ok"===i){let i=[];for(let e=0;e<r.length;e++)r[e].status=2,s=s.concat(r2(t.serverSyncTree_,r[e].currentWriteId)),r[e].onComplete&&i.push(()=>r[e].onComplete(null,!0,r[e].currentOutputSnapshotResolved)),r[e].unwatcher();i0(t,i_(t.transactionQueueTree_,n)),e(t,t.transactionQueueTree_),iH(t.eventQueue_,n,s);for(let e=0;e<i.length;e++)tP(i[e])}else{if("datastale"===i)for(let e=0;e<r.length;e++)3===r[e].status?r[e].status=4:r[e].status=0;else{ty("transaction at "+n.toString()+" failed: "+i);for(let e=0;e<r.length;e++)r[e].status=4,r[e].abortReason=i}iQ(t,n)}},o)}(t,ix(n),r)}else ib(n)&&iw(n,n=>{e(t,n)})})(e,e.transactionQueueTree_)}(e,i,r),r}function iZ(e,t){let n;let r=e.transactionQueueTree_;for(n=t6(t);null!==n&&void 0===iy(r);)r=i_(r,n),n=t6(t=t7(t));return r}function iJ(e,t){let n=[];return function e(t,n,r){let i=iy(n);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);iw(n,n=>{e(t,n,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function i0(e,t){let n=iy(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,iv(t,n.length>0?n:void 0)}iw(t,t=>{i0(e,t)})}function i1(e,t){let n=ix(iZ(e,t)),r=i_(e.transactionQueueTree_,t);return function(e,t,n){let r=e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(r,t=>{i2(e,t)}),i2(e,r),function e(t,n,r,i){r&&!i&&n(t),iw(t,t=>{e(t,n,!0,i)}),r&&i&&n(t)}(r,t=>{i2(e,t)}),n}function i2(e,t){let n=iy(t);if(n){let r=[],i=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(P(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(P(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(r2(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?iv(t,void 0):n.length=s+1,iH(e.eventQueue_,ix(t),i);for(let e=0;e<r.length;e++)tP(r[e])}}let i3=function(e,t){let n=i5(e),r=n.namespace;"firebase.com"===n.domain&&t_(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||t_("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||tv();let i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new tO(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new t5(n.pathString)}},i5=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",l=443;if("string"==typeof e){let c=e.indexOf("//");c>=0&&(a=e.substring(0,c-1),e=e.substring(c+2));let u=e.indexOf("/");-1===u&&(u=e.length);let h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(u,h)),u<h&&(i=/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function(e){let t="",n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let r=n[e];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch(e){}t+="/"+r}return t}(e.substring(u,h)));let d=function(e){let t={};for(let n of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===n.length)continue;let r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):ty(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,h)));(c=t.indexOf(":"))>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(c+1),10)):c=t.length;let f=t.slice(0,c);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{let e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i4{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){let e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+et(this.snapshot.exportVal())}}class i6{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i8{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return P(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i7{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return nr(this._path)?null:t9(this._path)}get ref(){return new st(this._repo,this._path)}get _queryIdentifier(){let e=tN(nG(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return nG(this._queryParams)}isEqual(e){if(!((e=eg(e))instanceof i7))return!1;let t=this._repo===e._repo,n=no(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}function i9(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===nm){let r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==tx)throw Error(r);if("string"!=typeof t)throw Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==tE)throw Error(r);if("string"!=typeof n)throw Error(i)}}else if(e.getIndex()===nN){if(null!=t&&!iN(t)||null!=n&&!iN(n))throw Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(assert(e.getIndex() instanceof nB||e.getIndex()===nH,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function se(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class st extends i7{constructor(e,t){super(e,t,new nY,!1)}get parent(){let e=nt(this._path);return null===e?null:new st(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class sn{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new t5(e),n=si(this.ref,e);return new sn(this._node.getChild(t),n,nN)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(t,n)=>e(new sn(n,si(this.ref,t),nN)))}hasChild(e){let t=new t5(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function sr(e,t){return(e=eg(e))._checkNotDeleted("ref"),void 0!==t?si(e._root,t):e._root}function si(e,t){return null===t6((e=eg(e))._path)?iP("child","path",t,!1):iR("child","path",t,!1),new st(e._repo,nn(e._path,t))}function ss(e){return iM("remove",e._path),so(e,null)}function so(e,t){iM("set",(e=eg(e))._path),iI("set",t,e._path,!1);let n=new G;return function(e,t,n,r,i){iK(e,"set",{path:t.toString(),value:n,priority:r});let s=i$(e),o=nL(n,r),a=ip(o,r8(e.serverSyncTree_,t),s),l=iW(e),c=r1(e.serverSyncTree_,t,a,l,!0);iB(e.eventQueue_,c),e.server_.put(t.toString(),o.val(!0),(n,r)=>{let s="ok"===n;s||ty("set at "+t+" failed: "+n);let o=r2(e.serverSyncTree_,l,!s);iH(e.eventQueue_,t,o),iG(e,i,n,r)});let u=i1(e,t);iQ(e,u),iH(e.eventQueue_,u,[])}(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function sa(e,t){iA("update",t,e._path,!1);let n=new G;return function(e,t,n,r){iK(e,"update",{path:t.toString(),value:n});let i=!0,s=i$(e),o={};if(tT(n,(n,r)=>{i=!1,o[n]=id(nn(t,n),nL(r),e.serverSyncTree_,s)}),i)tp("update() called with empty data.  Don't do anything."),iG(e,r,"ok",void 0);else{let i=iW(e),s=function(e,t,n,r){var i;P(r>(i=e.pendingWriteTree_).lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:t,children:n,writeId:r,visible:!0}),i.visibleWrites=rd(i.visibleWrites,t,n),i.lastWriteId=r;let s=rc.fromObject(n);return r7(e,new n9(n3(),t,s))}(e.serverSyncTree_,t,o,i);iB(e.eventQueue_,s),e.server_.merge(t.toString(),n,(n,s)=>{let o="ok"===n;o||ty("update at "+t+" failed: "+n);let a=r2(e.serverSyncTree_,i,!o),l=a.length>0?iQ(e,t):t;iH(e.eventQueue_,l,a),iG(e,r,n,s)}),tT(n,n=>{let r=i1(e,nn(t,n));iQ(e,r)}),iH(e.eventQueue_,t,[])}}(e._repo,e._path,t,n.wrapCallback(()=>{})),n.promise}function sl(e){e=eg(e);let t=new sc(new i8(()=>{}));return(function(e,t,n){let r=function(e,t){var n;let r=t._path,i=null;e.syncPointTree_.foreachOnPath(r,(e,t)=>{let n=ni(e,r);i=i||rG(t,n)});let s=e.syncPointTree_.get(r);s?i=i||rG(s,t4()):(s=new rV,e.syncPointTree_=e.syncPointTree_.set(r,s));let o=null!=i,a=o?new re(i,!0,!1):null,l=(n=e.pendingWriteTree_,rT(t._path,n));return ro(rY(s,t,l,o?a.getNode():nP.EMPTY_NODE,o).viewCache_)}(e.serverSyncTree_,t);return null!=r?Promise.resolve(r):e.server_.get(t).then(r=>{let i;let s=nL(r).withIndex(t._queryParams.getIndex());if(r6(e.serverSyncTree_,t,n,!0),t._queryParams.loadsAllData())i=r3(e.serverSyncTree_,t._path,s);else{let n=ie(e.serverSyncTree_,t);i=r4(e.serverSyncTree_,t._path,s,n)}return iH(e.eventQueue_,t._path,i),r5(e.serverSyncTree_,t,n,null,!0),s},n=>(iK(e,"get for query "+et(t)+" failed: "+n),Promise.reject(Error(n))))})(e._repo,e,t).then(t=>new sn(t,new st(e._repo,e._path),e._queryParams.getIndex()))}class sc{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){let n=t._queryParams.getIndex();return new i4("value",this,new sn(e.snapshotNode,new st(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new i6(this,e,t):null}matches(e){return e instanceof sc&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class su{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new i6(this,e,t):null}createEvent(e,t){P(null!=e.childName,"Child events should have a childName.");let n=si(new st(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new i4(e.type,this,new sn(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof su&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function sh(e,t,n,r){return function(e,t,n,r,i){var s;let o,a;if("object"==typeof r&&(o=void 0,i=r),"function"==typeof r&&(o=r),i&&i.onlyOnce){let t=n,r=(n,r)=>{iY(e._repo,e,c),t(n,r)};r.userCallback=n.userCallback,r.context=n.context,n=r}let l=new i8(n,o||void 0),c="value"===t?new sc(l):new su(t,l);return s=e._repo,a=".info"===t6(e._path)?r6(s.infoSyncTree_,e,c):r6(s.serverSyncTree_,e,c),iF(s.eventQueue_,e._path,a),()=>iY(e._repo,e,c)}(e,"value",t,n,r)}function sd(e,t,n){let r=null,i=n?new i8(n):null;"value"===t?r=new sc(i):t&&(r=new su(t,i)),iY(e._repo,e,r)}P(!f,"__referenceConstructor has already been defined"),f=st,P(!p,"__referenceConstructor has already been defined"),p=st;let sf={};class sp{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function(e,t,n){if(e.stats_=tj(e.repoInfo_),e.forceRestClient_||"".search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new nX(e.repoInfo_,(t,n,r,i)=>{iq(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>iU(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{et(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new nd(e.repoInfo_,t,(t,n,r,i)=>{iq(e,t,n,r,i)},t=>{iU(e,t)},t=>{tT(t,(t,n)=>{iV(e,t,n)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){let n=e.toString();return tH[n]||(tH[n]=t()),tH[n]}(e.repoInfo_,()=>new n2(e.stats_,e.server_)),e.infoData_=new nQ,e.infoSyncTree_=new r0({startListening:(t,n,r,i)=>{let s=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=r3(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),iV(e,"connected",!1),e.serverSyncTree_=new r0({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,(n,r)=>{let s=i(n,r);iH(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new st(this._repo,t4())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){let n=sf[t];n&&n[e.key]===e||t_(`Database ${t}(${e.repoInfo_}) has already been deleted.`),e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt"),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&t_("Cannot call "+e+" on a deleted database.")}}nd.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},nd.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},t$=A.Client,tz="10.14.1",eG(new ex("database",(e,{instanceIdentifier:t})=>(function(e,t,n,r,i){var s,o;let a,l,c,u,h=r||e.options.databaseURL;void 0===h&&(e.options.projectId||t_("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),tp("Using default host for project ",e.options.projectId),h=`${e.options.projectId}-default-rtdb.firebaseio.com`);let d=i3(h,i),f=d.repoInfo;"undefined"!=typeof process&&process.env&&(c=process.env.FIREBASE_DATABASE_EMULATOR_HOST),c?(u=!0,f=(d=i3(h=`http://${c}?ns=${f.namespace}`,i)).repoInfo):u=!d.repoInfo.secure;let p=i&&u?new tK(tK.OWNER):new tY(e.name,e.options,t);return iO("Invalid Firebase Database URL",d),nr(d.path)||t_("Database URL must point to the root of a Firebase Database (not including a child path)."),new sp((s=f,o=new tW(e.name,n),(a=sf[e.name])||(a={},sf[e.name]=a),(l=a[s.toURLString()])&&t_("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),l=new iz(s,!1,p,o),a[s.toURLString()]=l,l),e)})(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),eJ(tU,tV,"node"),eJ(tU,tV,"esm2017"),/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */eJ("firebase","10.14.1","app");let sg={apiKey:"AIzaSyC764Bt3srAVK7eWuaTRvIPpDPxSUtS9cM",authDomain:"postitproject-bebd1.firebaseapp.com",projectId:"postitproject-bebd1",storageBucket:"postitproject-bebd1.firebasestorage.app",messagingSenderId:"776869122000",appId:"1:776869122000:web:244674c9a862b65debb3d5",databaseURL:"https://postitproject-bebd1-default-rtdb.europe-west1.firebasedatabase.app"};function sm(){return Array.from(eV.values()).length||(m=function(e=function(e=eq){let t=eV.get(e);if(!t&&e===eq&&K())return eZ();if(!t)throw eX.create("no-app",{appName:e});return t}(),t){let n=(function(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)})(e,"database").getImmediate({identifier:void 0});if(!n._instanceStarted){let e=Y("database");e&&function(e,t,n,r={}){var i;let s;(e=eg(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&t_("Cannot call useEmulator() after instance has already been initialized.");let o=e._repoInternal;o.repoInfo_.nodeAdmin?(r.mockUserToken&&t_('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new tK(tK.OWNER)):r.mockUserToken&&(s=new tK("string"==typeof r.mockUserToken?r.mockUserToken:/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[j(JSON.stringify({alg:"none",type:"JWT"})),j(JSON.stringify(s)),""].join(".")}(r.mockUserToken,e.app.options.projectId))),i=s,o.repoInfo_=new tO(`${t}:${n}`,!1,o.repoInfo_.namespace,o.repoInfo_.webSocketOnly,o.repoInfo_.nodeAdmin,o.repoInfo_.persistenceKey,o.repoInfo_.includeNamespaceInQueryParams,!0),i&&(o.authTokenProvider_=i)}(n,...e)}return n}(g=eZ(sg))),{app:g,database:m}}var s_=n(6113),sy=n.n(s_);let sv={randomUUID:sy().randomUUID},sb=new Uint8Array(256),sw=sb.length,sx=[];for(let e=0;e<256;++e)sx.push((e+256).toString(16).slice(1));let sE=function(e,t,n){if(sv.randomUUID&&!t&&!e)return sv.randomUUID();let r=(e=e||{}).random||(e.rng||function(){return sw>sb.length-16&&(sy().randomFillSync(sb),sw=0),sb.slice(sw,sw+=16)})();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return sx[e[t+0]]+sx[e[t+1]]+sx[e[t+2]]+sx[e[t+3]]+"-"+sx[e[t+4]]+sx[e[t+5]]+"-"+sx[e[t+6]]+sx[e[t+7]]+"-"+sx[e[t+8]]+sx[e[t+9]]+"-"+sx[e[t+10]]+sx[e[t+11]]+sx[e[t+12]]+sx[e[t+13]]+sx[e[t+14]]+sx[e[t+15]]}(r)},sC="notes",sS="connections";function sk(e){return sr((m||sm(),m),e)}async function sN(e){let t=sE(),n=Date.now(),r={...e,id:t,createdAt:n,updatedAt:n};return await so(sk(`${sC}/${t}`),r),r}async function sI(e,t){let n={...t,updatedAt:Date.now()};await sa(sk(`${sC}/${e}`),n)}async function sT(e){await ss(sk(`${sC}/${e}`))}async function sD(e){let t=await sl(sk(`${sC}/${e}`));return t.exists()?t.val():null}async function sA(){let e=await sl(sk(sC));return e.exists()?Object.values(e.val()):[]}async function sR(e,t=1){let n=await sD(e);n&&await sI(e,{votes:Math.max(0,(n.votes||0)+t)})}async function sP(e,t,n){let r=sE(),i={id:r,sourceId:e,targetId:t,label:n||null,createdAt:Date.now()};return await so(sk(`${sS}/${r}`),i),i}async function sM(e){await ss(sk(`${sS}/${e}`))}async function sO(e){if((await sA()).length>0){console.log("Database already has notes, skipping seed");return}let t=(m||sm(),m),n={};e.forEach(e=>{n[`${sC}/${e.id}`]=e}),await sa(sr(t),n),console.log(`Seeded ${e.length} notes`)}var sL=n(1413),sB=n.n(sL);let sF={opportunities:"pink",enablers:"blue",actors:"yellow"};function sH({note:e,onClick:t,isSelected:n=!1,isConnecting:r=!1,rotation:i=0}){let s=sF[e.category]||"pink",o=e.votes||0,a=e.tags||[];return(0,S.jsxs)("div",{"data-note-id":e.id,className:`${sB().card} ${sB()[s]} ${n?sB().selected:""} ${r?sB().connecting:""}`,style:{transform:`rotate(${i}deg)`},onClick:t,children:[S.jsx("p",{className:sB().cardText,children:e.text}),(0,S.jsxs)("div",{className:sB().cardFooter,children:[S.jsx("div",{className:sB().dots,children:Array.from({length:Math.min(o,10)}).map((e,t)=>S.jsx("span",{className:sB().dot},t))}),a.length>0&&S.jsx("div",{className:sB().tags,children:a.map(e=>S.jsx("span",{className:sB().tag,children:e},e))})]})]})}function sj({note:e,isOpen:t,onClose:n,onSave:r,onDelete:i,onVote:s}){let[o,a]=(0,k.useState)(""),[l,c]=(0,k.useState)("opportunities"),[u,h]=(0,k.useState)("10months"),[d,f]=(0,k.useState)(""),[p,g]=(0,k.useState)(0);if((0,k.useEffect)(()=>{e?(a(e.text),c(e.category),h(e.timeframe),f((e.tags||[]).join(", ")),g(e.votes||0)):(a(""),c("opportunities"),h("10months"),f(""),g(0))},[e,t]),!t)return null;let m=t=>{e&&s&&(g(Math.max(0,p+t)),s(e.id,t))};return S.jsx("div",{className:sB().modalOverlay,onClick:n,children:(0,S.jsxs)("div",{className:sB().modal,onClick:e=>e.stopPropagation(),children:[S.jsx("h2",{className:sB().modalTitle,children:e?"Edit Note":"Add New Note"}),(0,S.jsxs)("form",{onSubmit:t=>{t.preventDefault(),r({text:o,category:l,timeframe:u,tags:d.split(",").map(e=>e.trim()).filter(e=>e.length>0),votes:e?p:1,connections:e?.connections||[]}),n()},children:[(0,S.jsxs)("div",{className:sB().formGroup,children:[S.jsx("label",{className:sB().formLabel,children:"Content"}),S.jsx("textarea",{className:sB().formTextarea,value:o,onChange:e=>a(e.target.value),placeholder:"Enter the idea or concept...",required:!0})]}),(0,S.jsxs)("div",{className:sB().formGroup,children:[S.jsx("label",{className:sB().formLabel,children:"Category"}),S.jsx("select",{className:sB().formSelect,value:l,onChange:e=>c(e.target.value),children:Object.entries(T).map(([e,t])=>S.jsx("option",{value:e,children:t.label},e))})]}),(0,S.jsxs)("div",{className:sB().formGroup,children:[S.jsx("label",{className:sB().formLabel,children:"Timeframe"}),S.jsx("select",{className:sB().formSelect,value:u,onChange:e=>h(e.target.value),children:Object.entries(D).map(([e,t])=>S.jsx("option",{value:e,children:t.label},e))})]}),(0,S.jsxs)("div",{className:sB().formGroup,children:[S.jsx("label",{className:sB().formLabel,children:"Tags (comma-separated)"}),S.jsx("input",{type:"text",className:sB().formInput,value:d,onChange:e=>f(e.target.value),placeholder:"e.g. Q1, Priority, Research"})]}),e&&(0,S.jsxs)("div",{className:sB().formGroup,children:[(0,S.jsxs)("label",{className:sB().formLabel,children:["Votes: ",p]}),(0,S.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[S.jsx("button",{type:"button",className:sB().btnSecondary,onClick:()=>m(-1),disabled:0===p,children:"-1 Vote"}),S.jsx("button",{type:"button",className:sB().btnSecondary,onClick:()=>m(1),children:"+1 Vote"})]})]}),(0,S.jsxs)("div",{className:sB().modalActions,children:[e&&i&&S.jsx("button",{type:"button",className:sB().btnDanger,onClick:()=>{e&&i&&confirm("Are you sure you want to delete this note?")&&(i(e.id),n())},children:"Delete"}),S.jsx("button",{type:"button",className:sB().btnSecondary,onClick:n,children:"Cancel"}),S.jsx("button",{type:"submit",className:sB().btnPrimary,children:e?"Save Changes":"Add Note"})]})]})]})})}async function sz(e,t="ai-landscape-export"){let{jsPDF:r}=await n.e(898).then(n.bind(n,7898)),{default:i}=await n.e(71).then(n.bind(n,4071)),s=new r;s.setFontSize(20),s.text("AI Landscape - Workshop Export",14,22),s.setFontSize(10),s.text(`Exported: ${new Date().toLocaleDateString()}`,14,30),s.text(`Total Ideas: ${e.length}`,14,36),i(s,{startY:45,head:[["Idea","Category","Timeframe","Votes"]],body:e.map(e=>[e.text.substring(0,60)+(e.text.length>60?"...":""),e.category,e.timeframe,e.votes||0]),styles:{fontSize:8,cellPadding:2},headStyles:{fillColor:[102,126,234]}}),s.save(`${t}.pdf`)}function s$(e,t){let n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}var sq=n(1202);function sU(e){let t=Object.prototype.toString.call(e);return"[object Window]"===t||"[object global]"===t}function sV(e){return"nodeType"in e}function sW(e){var t,n;return e?sU(e)?e:sV(e)&&null!=(t=null==(n=e.ownerDocument)?void 0:n.defaultView)?t:window:window}function sY(e){let{Document:t}=sW(e);return e instanceof t}function sK(e){return!sU(e)&&e instanceof sW(e).HTMLElement}function sG(e){return e instanceof sW(e).SVGElement}function sX(e){return e?sU(e)?e.document:sV(e)?sY(e)?e:sK(e)||sG(e)?e.ownerDocument:document:document:document}let sQ=k.useEffect;function sZ(e){let t=(0,k.useRef)(e);return sQ(()=>{t.current=e}),(0,k.useCallback)(function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return null==t.current?void 0:t.current(...n)},[])}function sJ(e,t){void 0===t&&(t=[e]);let n=(0,k.useRef)(e);return sQ(()=>{n.current!==e&&(n.current=e)},t),n}function s0(e,t){let n=(0,k.useRef)();return(0,k.useMemo)(()=>{let t=e(n.current);return n.current=t,t},[...t])}function s1(e){let t=sZ(e),n=(0,k.useRef)(null),r=(0,k.useCallback)(e=>{e!==n.current&&(null==t||t(e,n.current)),n.current=e},[]);return[n,r]}function s2(e){let t=(0,k.useRef)();return(0,k.useEffect)(()=>{t.current=e},[e]),t.current}let s3={};function s5(e,t){return(0,k.useMemo)(()=>{if(t)return t;let n=null==s3[e]?0:s3[e]+1;return s3[e]=n,e+"-"+n},[e,t])}function s4(e){return function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.reduce((t,n)=>{for(let[r,i]of Object.entries(n)){let n=t[r];null!=n&&(t[r]=n+e*i)}return t},{...t})}}let s6=s4(1),s8=s4(-1);function s7(e){if(!e)return!1;let{KeyboardEvent:t}=sW(e.target);return t&&e instanceof t}function s9(e){if(function(e){if(!e)return!1;let{TouchEvent:t}=sW(e.target);return t&&e instanceof t}(e)){if(e.touches&&e.touches.length){let{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}if(e.changedTouches&&e.changedTouches.length){let{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return"clientX"in e&&"clientY"in e?{x:e.clientX,y:e.clientY}:null}let oe=Object.freeze({Translate:{toString(e){if(!e)return;let{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;let{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[oe.Translate.toString(e),oe.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),ot="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]",on={display:"none"};function or(e){let{id:t,value:n}=e;return N().createElement("div",{id:t,style:on},n)}function oi(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;return N().createElement("div",{id:t,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":r,"aria-atomic":!0},n)}let os=(0,k.createContext)(null),oo={draggable:"\n    To pick up a draggable item, press the space bar.\n    While dragging, use the arrow keys to move the item.\n    Press space again to drop the item in its new position, or press escape to cancel.\n  "},oa={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function ol(e){let{announcements:t=oa,container:n,hiddenTextDescribedById:r,screenReaderInstructions:i=oo}=e,{announce:s,announcement:o}=function(){let[e,t]=(0,k.useState)("");return{announce:(0,k.useCallback)(e=>{null!=e&&t(e)},[]),announcement:e}}(),a=s5("DndLiveRegion"),[l,c]=(0,k.useState)(!1);if((0,k.useEffect)(()=>{c(!0)},[]),function(e){let t=(0,k.useContext)(os);(0,k.useEffect)(()=>{if(!t)throw Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}((0,k.useMemo)(()=>({onDragStart(e){let{active:n}=e;s(t.onDragStart({active:n}))},onDragMove(e){let{active:n,over:r}=e;t.onDragMove&&s(t.onDragMove({active:n,over:r}))},onDragOver(e){let{active:n,over:r}=e;s(t.onDragOver({active:n,over:r}))},onDragEnd(e){let{active:n,over:r}=e;s(t.onDragEnd({active:n,over:r}))},onDragCancel(e){let{active:n,over:r}=e;s(t.onDragCancel({active:n,over:r}))}}),[s,t])),!l)return null;let u=N().createElement(N().Fragment,null,N().createElement(or,{id:r,value:i.draggable}),N().createElement(oi,{id:a,announcement:o}));return n?(0,sq.createPortal)(u,n):u}function oc(){}!function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"}(lg||(lg={}));let ou=Object.freeze({x:0,y:0});function oh(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}let od=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e,i=[];for(let e of r){let{id:r}=e,s=n.get(r);if(s){let n=function(e,t){let n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),i=Math.min(t.left+t.width,e.left+e.width),s=Math.min(t.top+t.height,e.top+e.height);if(r<i&&n<s){let o=t.width*t.height,a=e.width*e.height,l=(i-r)*(s-n);return Number((l/(o+a-l)).toFixed(4))}return 0}(s,t);n>0&&i.push({id:r,data:{droppableContainer:e,value:n}})}}return i.sort(oh)};function of(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:ou}let op=function(e){return function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.reduce((t,n)=>({...t,top:t.top+e*n.y,bottom:t.bottom+e*n.y,left:t.left+e*n.x,right:t.right+e*n.x}),{...t})}}(1),og={ignoreTransform:!1};function om(e,t){void 0===t&&(t=og);let n=e.getBoundingClientRect();if(t.ignoreTransform){let{transform:t,transformOrigin:r}=sW(e).getComputedStyle(e);t&&(n=function(e,t,n){let r=function(e){if(e.startsWith("matrix3d(")){let t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}if(e.startsWith("matrix(")){let t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}(t);if(!r)return e;let{scaleX:i,scaleY:s,x:o,y:a}=r,l=e.left-o-(1-i)*parseFloat(n),c=e.top-a-(1-s)*parseFloat(n.slice(n.indexOf(" ")+1)),u=i?e.width/i:e.width,h=s?e.height/s:e.height;return{width:u,height:h,top:c,right:l+u,bottom:c+h,left:l}}(n,t,r))}let{top:r,left:i,width:s,height:o,bottom:a,right:l}=n;return{top:r,left:i,width:s,height:o,bottom:a,right:l}}function o_(e){return om(e,{ignoreTransform:!0})}function oy(e,t){let n=[];return e?function r(i){var s;if(null!=t&&n.length>=t||!i)return n;if(sY(i)&&null!=i.scrollingElement&&!n.includes(i.scrollingElement))return n.push(i.scrollingElement),n;if(!sK(i)||sG(i)||n.includes(i))return n;let o=sW(e).getComputedStyle(i);return(i!==e&&function(e,t){void 0===t&&(t=sW(e).getComputedStyle(e));let n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(e=>{let r=t[e];return"string"==typeof r&&n.test(r)})}(i,o)&&n.push(i),void 0===(s=o)&&(s=sW(i).getComputedStyle(i)),"fixed"===s.position)?n:r(i.parentNode)}(e):n}function ov(e){let[t]=oy(e,1);return null!=t?t:null}function ob(e){return sU(e)?e.scrollX:e.scrollLeft}function ow(e){return sU(e)?e.scrollY:e.scrollTop}function ox(e){return{x:ob(e),y:ow(e)}}function oE(e){let t={x:0,y:0},n={height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},i=e.scrollTop<=t.y;return{isTop:i,isLeft:e.scrollLeft<=t.x,isBottom:e.scrollTop>=r.y,isRight:e.scrollLeft>=r.x,maxScroll:r,minScroll:t}}!function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"}(lm||(lm={}));let oC={x:.2,y:.2};function oS(e){return e.reduce((e,t)=>s6(e,ox(t)),ou)}let ok=[["x",["left","right"],function(e){return e.reduce((e,t)=>e+ob(t),0)}],["y",["top","bottom"],function(e){return e.reduce((e,t)=>e+ow(t),0)}]];class oN{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;let n=oy(t),r=oS(n);for(let[t,i,s]of(this.rect={...e},this.width=e.width,this.height=e.height,ok))for(let e of i)Object.defineProperty(this,e,{get:()=>{let i=s(n),o=r[t]-i;return this.rect[e]+o},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class oI{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(e=>{var t;return null==(t=this.target)?void 0:t.removeEventListener(...e)})},this.target=e}add(e,t,n){var r;null==(r=this.target)||r.addEventListener(e,t,n),this.listeners.push([e,t,n])}}function oT(e,t){let n=Math.abs(e.x),r=Math.abs(e.y);return"number"==typeof t?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t&&r>t.y}function oD(e){e.preventDefault()}function oA(e){e.stopPropagation()}(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(l_||(l_={})),function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"}(ly||(ly={}));let oR={start:[ly.Space,ly.Enter],cancel:[ly.Esc],end:[ly.Space,ly.Enter,ly.Tab]},oP=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case ly.Right:return{...n,x:n.x+25};case ly.Left:return{...n,x:n.x-25};case ly.Down:return{...n,y:n.y+25};case ly.Up:return{...n,y:n.y-25}}};class oM{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;let{event:{target:t}}=e;this.props=e,this.listeners=new oI(sX(t)),this.windowListeners=new oI(sW(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(l_.Resize,this.handleCancel),this.windowListeners.add(l_.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(l_.Keydown,this.handleKeyDown))}handleStart(){let{activeNode:e,onStart:t}=this.props,n=e.node.current;n&&function(e,t){if(void 0===t&&(t=om),!e)return;let{top:n,left:r,bottom:i,right:s}=t(e);ov(e)&&(i<=0||s<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}(n),t(ou)}handleKeyDown(e){if(s7(e)){let{active:t,context:n,options:r}=this.props,{keyboardCodes:i=oR,coordinateGetter:s=oP,scrollBehavior:o="smooth"}=r,{code:a}=e;if(i.end.includes(a)){this.handleEnd(e);return}if(i.cancel.includes(a)){this.handleCancel(e);return}let{collisionRect:l}=n.current,c=l?{x:l.left,y:l.top}:ou;this.referenceCoordinates||(this.referenceCoordinates=c);let u=s(e,{active:t,context:n.current,currentCoordinates:c});if(u){let t=s8(u,c),r={x:0,y:0},{scrollableAncestors:i}=n.current;for(let n of i){let i=e.code,{isTop:s,isRight:a,isLeft:l,isBottom:c,maxScroll:h,minScroll:d}=oE(n),f=function(e){if(e===document.scrollingElement){let{innerWidth:e,innerHeight:t}=window;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}let{top:t,left:n,right:r,bottom:i}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:i,width:e.clientWidth,height:e.clientHeight}}(n),p={x:Math.min(i===ly.Right?f.right-f.width/2:f.right,Math.max(i===ly.Right?f.left:f.left+f.width/2,u.x)),y:Math.min(i===ly.Down?f.bottom-f.height/2:f.bottom,Math.max(i===ly.Down?f.top:f.top+f.height/2,u.y))},g=i===ly.Right&&!a||i===ly.Left&&!l,m=i===ly.Down&&!c||i===ly.Up&&!s;if(g&&p.x!==u.x){let e=n.scrollLeft+t.x,s=i===ly.Right&&e<=h.x||i===ly.Left&&e>=d.x;if(s&&!t.y){n.scrollTo({left:e,behavior:o});return}s?r.x=n.scrollLeft-e:r.x=i===ly.Right?n.scrollLeft-h.x:n.scrollLeft-d.x,r.x&&n.scrollBy({left:-r.x,behavior:o});break}if(m&&p.y!==u.y){let e=n.scrollTop+t.y,s=i===ly.Down&&e<=h.y||i===ly.Up&&e>=d.y;if(s&&!t.x){n.scrollTo({top:e,behavior:o});return}s?r.y=n.scrollTop-e:r.y=i===ly.Down?n.scrollTop-h.y:n.scrollTop-d.y,r.y&&n.scrollBy({top:-r.y,behavior:o});break}}this.handleMove(e,s6(s8(u,this.referenceCoordinates),r))}}}handleMove(e,t){let{onMove:n}=this.props;e.preventDefault(),n(t)}handleEnd(e){let{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){let{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function oO(e){return!!(e&&"distance"in e)}function oL(e){return!!(e&&"delay"in e)}oM.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=oR,onActivation:i}=t,{active:s}=n,{code:o}=e.nativeEvent;if(r.start.includes(o)){let t=s.activatorNode.current;return(!t||e.target===t)&&(e.preventDefault(),null==i||i({event:e.nativeEvent}),!0)}return!1}}];class oB{constructor(e,t,n){var r;void 0===n&&(n=function(e){let{EventTarget:t}=sW(e);return e instanceof t?e:sX(e)}(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;let{event:i}=e,{target:s}=i;this.props=e,this.events=t,this.document=sX(s),this.documentListeners=new oI(this.document),this.listeners=new oI(n),this.windowListeners=new oI(sW(s)),this.initialCoordinates=null!=(r=s9(i))?r:ou,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){let{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:n}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(l_.Resize,this.handleCancel),this.windowListeners.add(l_.DragStart,oD),this.windowListeners.add(l_.VisibilityChange,this.handleCancel),this.windowListeners.add(l_.ContextMenu,oD),this.documentListeners.add(l_.Keydown,this.handleKeydown),t){if(null!=n&&n({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(oL(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if(oO(t)){this.handlePending(t);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){let{active:n,onPending:r}=this.props;r(n,e,this.initialCoordinates,t)}handleStart(){let{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(l_.Click,oA,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(l_.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;let{activated:n,initialCoordinates:r,props:i}=this,{onMove:s,options:{activationConstraint:o}}=i;if(!r)return;let a=null!=(t=s9(e))?t:ou,l=s8(r,a);if(!n&&o){if(oO(o)){if(null!=o.tolerance&&oT(l,o.tolerance))return this.handleCancel();if(oT(l,o.distance))return this.handleStart()}return oL(o)&&oT(l,o.tolerance)?this.handleCancel():void this.handlePending(o,l)}e.cancelable&&e.preventDefault(),s(a)}handleEnd(){let{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){let{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===ly.Esc&&this.handleCancel()}removeTextSelection(){var e;null==(e=this.document.getSelection())||e.removeAllRanges()}}let oF={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class oH extends oB{constructor(e){let{event:t}=e;super(e,oF,sX(t.target))}}oH.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!!n.isPrimary&&0===n.button&&(null==r||r({event:n}),!0)}}];let oj={move:{name:"mousemove"},end:{name:"mouseup"}};!function(e){e[e.RightClick=2]="RightClick"}(lv||(lv={}));class oz extends oB{constructor(e){super(e,oj,sX(e.event.target))}}oz.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button!==lv.RightClick&&(null==r||r({event:n}),!0)}}];let o$={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class oq extends oB{constructor(e){super(e,o$)}static setup(){return window.addEventListener(o$.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(o$.move.name,e)};function e(){}}}oq.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t,{touches:i}=n;return!(i.length>1)&&(null==r||r({event:n}),!0)}}],function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"}(lb||(lb={})),function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"}(lw||(lw={}));let oU={x:{[lm.Backward]:!1,[lm.Forward]:!1},y:{[lm.Backward]:!1,[lm.Forward]:!1}};(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(lx||(lx={})),(lE||(lE={})).Optimized="optimized";let oV=new Map;function oW(e,t){return s0(n=>e?n||("function"==typeof t?t(e):e):null,[t,e])}function oY(e){let{callback:t,disabled:n}=e;sZ(t);let r=(0,k.useMemo)(()=>{},[n]);return(0,k.useEffect)(()=>()=>null==r?void 0:r.disconnect(),[r]),r}function oK(e){return new oN(om(e),e)}function oG(e,t,n){void 0===t&&(t=oK);let[r,i]=(0,k.useState)(null);function s(){i(r=>{if(!e)return null;if(!1===e.isConnected){var i;return null!=(i=null!=r?r:n)?i:null}let s=t(e);return JSON.stringify(r)===JSON.stringify(s)?r:s})}let o=function(e){let{callback:t,disabled:n}=e,r=sZ(t),i=(0,k.useMemo)(()=>{},[r,n]);return(0,k.useEffect)(()=>()=>null==i?void 0:i.disconnect(),[i]),i}({callback(t){if(e)for(let n of t){let{type:t,target:r}=n;if("childList"===t&&r instanceof HTMLElement&&r.contains(e)){s();break}}}}),a=oY({callback:s});return sQ(()=>{s(),e?(null==a||a.observe(e),null==o||o.observe(document.body,{childList:!0,subtree:!0})):(null==a||a.disconnect(),null==o||o.disconnect())},[e]),r}let oX=[];function oQ(e,t){void 0===t&&(t=[]);let n=(0,k.useRef)(null);return(0,k.useEffect)(()=>{n.current=null},t),(0,k.useEffect)(()=>{let t=e!==ou;t&&!n.current&&(n.current=e),!t&&n.current&&(n.current=null)},[e]),n.current?s8(e,n.current):ou}function oZ(e){return(0,k.useMemo)(()=>e?function(e){let t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}(e):null,[e])}let oJ=[],o0=[{sensor:oH,options:{}},{sensor:oM,options:{}}],o1={current:{}},o2={draggable:{measure:o_},droppable:{measure:o_,strategy:lx.WhileDragging,frequency:lE.Optimized},dragOverlay:{measure:om}};class o3 extends Map{get(e){var t;return null!=e&&null!=(t=super.get(e))?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,n;return null!=(t=null==(n=this.get(e))?void 0:n.node.current)?t:void 0}}let o5={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new o3,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:oc},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:o2,measureDroppableContainers:oc,windowRect:null,measuringScheduled:!1},o4={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:oc,draggableNodes:new Map,over:null,measureDroppableContainers:oc},o6=(0,k.createContext)(o4),o8=(0,k.createContext)(o5);function o7(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new o3}}}function o9(e,t){switch(t.type){case lg.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case lg.DragMove:if(null==e.draggable.active)return e;return{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case lg.DragEnd:case lg.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case lg.RegisterDroppable:{let{element:n}=t,{id:r}=n,i=new o3(e.droppable.containers);return i.set(r,n),{...e,droppable:{...e.droppable,containers:i}}}case lg.SetDroppableDisabled:{let{id:n,key:r,disabled:i}=t,s=e.droppable.containers.get(n);if(!s||r!==s.key)return e;let o=new o3(e.droppable.containers);return o.set(n,{...s,disabled:i}),{...e,droppable:{...e.droppable,containers:o}}}case lg.UnregisterDroppable:{let{id:n,key:r}=t,i=e.droppable.containers.get(n);if(!i||r!==i.key)return e;let s=new o3(e.droppable.containers);return s.delete(n),{...e,droppable:{...e.droppable,containers:s}}}default:return e}}function ae(e){let{disabled:t}=e,{active:n,activatorEvent:r,draggableNodes:i}=(0,k.useContext)(o6),s=s2(r),o=s2(null==n?void 0:n.id);return(0,k.useEffect)(()=>{if(!t&&!r&&s&&null!=o){if(!s7(s)||document.activeElement===s.target)return;let e=i.get(o);if(!e)return;let{activatorNode:t,node:n}=e;(t.current||n.current)&&requestAnimationFrame(()=>{for(let e of[t.current,n.current]){if(!e)continue;let t=e.matches(ot)?e:e.querySelector(ot);if(t){t.focus();break}}})}},[r,t,i,o,s]),null}let at=(0,k.createContext)({...ou,scaleX:1,scaleY:1});!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"}(lC||(lC={}));let an=(0,k.memo)(function(e){var t,n,r,i,s,o;let{id:a,accessibility:l,autoScroll:c=!0,children:u,sensors:h=o0,collisionDetection:d=od,measuring:f,modifiers:p,...g}=e,[m,_]=(0,k.useReducer)(o9,void 0,o7),[y,v]=function(){let[e]=(0,k.useState)(()=>new Set),t=(0,k.useCallback)(t=>(e.add(t),()=>e.delete(t)),[e]);return[(0,k.useCallback)(t=>{let{type:n,event:r}=t;e.forEach(e=>{var t;return null==(t=e[n])?void 0:t.call(e,r)})},[e]),t]}(),[b,w]=(0,k.useState)(lC.Uninitialized),x=b===lC.Initialized,{draggable:{active:E,nodes:C,translate:S},droppable:{containers:I}}=m,T=null!=E?C.get(E):null,D=(0,k.useRef)({initial:null,translated:null}),A=(0,k.useMemo)(()=>{var e;return null!=E?{id:E,data:null!=(e=null==T?void 0:T.data)?e:o1,rect:D}:null},[E,T]),R=(0,k.useRef)(null),[P,M]=(0,k.useState)(null),[O,L]=(0,k.useState)(null),B=sJ(g,Object.values(g)),F=s5("DndDescribedBy",a),H=(0,k.useMemo)(()=>I.getEnabled(),[I]),j=(0,k.useMemo)(()=>({draggable:{...o2.draggable,...null==f?void 0:f.draggable},droppable:{...o2.droppable,...null==f?void 0:f.droppable},dragOverlay:{...o2.dragOverlay,...null==f?void 0:f.dragOverlay}}),[null==f?void 0:f.draggable,null==f?void 0:f.droppable,null==f?void 0:f.dragOverlay]),{droppableRects:z,measureDroppableContainers:$,measuringScheduled:q}=function(e,t){let{dragging:n,dependencies:r,config:i}=t,[s,o]=(0,k.useState)(null),{frequency:a,measure:l,strategy:c}=i,u=(0,k.useRef)(e),h=function(){switch(c){case lx.Always:return!1;case lx.BeforeDragging:return n;default:return!n}}(),d=sJ(h),f=(0,k.useCallback)(function(e){void 0===e&&(e=[]),d.current||o(t=>null===t?e:t.concat(e.filter(e=>!t.includes(e))))},[d]),p=(0,k.useRef)(null),g=s0(t=>{if(h&&!n)return oV;if(!t||t===oV||u.current!==e||null!=s){let t=new Map;for(let n of e){if(!n)continue;if(s&&s.length>0&&!s.includes(n.id)&&n.rect.current){t.set(n.id,n.rect.current);continue}let e=n.node.current,r=e?new oN(l(e),e):null;n.rect.current=r,r&&t.set(n.id,r)}return t}return t},[e,s,n,h,l]);return(0,k.useEffect)(()=>{u.current=e},[e]),(0,k.useEffect)(()=>{h||f()},[n,h]),(0,k.useEffect)(()=>{s&&s.length>0&&o(null)},[JSON.stringify(s)]),(0,k.useEffect)(()=>{h||"number"!=typeof a||null!==p.current||(p.current=setTimeout(()=>{f(),p.current=null},a))},[a,h,f,...r]),{droppableRects:g,measureDroppableContainers:f,measuringScheduled:null!=s}}(H,{dragging:x,dependencies:[S.x,S.y],config:j.droppable}),U=function(e,t){let n=null!=t?e.get(t):void 0,r=n?n.node.current:null;return s0(e=>{var n;return null==t?null:null!=(n=null!=r?r:e)?n:null},[r,t])}(C,E),V=(0,k.useMemo)(()=>O?s9(O):null,[O]),W=function(){let e=(null==P?void 0:P.autoScrollEnabled)===!1,t="object"==typeof c?!1===c.enabled:!1===c,n=x&&!e&&!t;return"object"==typeof c?{...c,enabled:n}:{enabled:n}}(),Y=oW(U,j.draggable.measure);!function(e){let{activeNode:t,measure:n,initialRect:r,config:i=!0}=e,s=(0,k.useRef)(!1),{x:o,y:a}="boolean"==typeof i?{x:i,y:i}:i;sQ(()=>{if(!o&&!a||!t){s.current=!1;return}if(s.current||!r)return;let e=null==t?void 0:t.node.current;if(!e||!1===e.isConnected)return;let i=of(n(e),r);if(o||(i.x=0),a||(i.y=0),s.current=!0,Math.abs(i.x)>0||Math.abs(i.y)>0){let t=ov(e);t&&t.scrollBy({top:i.y,left:i.x})}},[t,o,a,r,n])}({activeNode:null!=E?C.get(E):null,config:W.layoutShiftCompensation,initialRect:Y,measure:j.draggable.measure});let K=oG(U,j.draggable.measure,Y),G=oG(U?U.parentElement:null),X=(0,k.useRef)({activatorEvent:null,active:null,activeNode:U,collisionRect:null,collisions:null,droppableRects:z,draggableNodes:C,draggingNode:null,draggingNodeRect:null,droppableContainers:I,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Q=I.getNodeFor(null==(t=X.current.over)?void 0:t.id),Z=function(e){let{measure:t}=e,[n,r]=(0,k.useState)(null),i=oY({callback:(0,k.useCallback)(e=>{for(let{target:n}of e)if(sK(n)){r(e=>{let r=t(n);return e?{...e,width:r.width,height:r.height}:r});break}},[t])}),[s,o]=s1((0,k.useCallback)(e=>{let n=function(e){if(!e)return null;if(e.children.length>1)return e;let t=e.children[0];return sK(t)?t:e}(e);null==i||i.disconnect(),n&&(null==i||i.observe(n)),r(n?t(n):null)},[t,i]));return(0,k.useMemo)(()=>({nodeRef:s,rect:n,setRef:o}),[n,s,o])}({measure:j.dragOverlay.measure}),J=null!=(n=Z.nodeRef.current)?n:U,ee=x?null!=(r=Z.rect)?r:K:null,et=!!(Z.nodeRef.current&&Z.rect),en=function(e){let t=oW(e);return of(e,t)}(et?null:K),er=oZ(J?sW(J):null),ei=function(e){let t=(0,k.useRef)(e),n=s0(n=>e?n&&n!==oX&&e&&t.current&&e.parentNode===t.current.parentNode?n:oy(e):oX,[e]);return(0,k.useEffect)(()=>{t.current=e},[e]),n}(x?null!=Q?Q:U:null),es=function(e,t){void 0===t&&(t=om);let[n]=e,[r,i]=(oZ(n?sW(n):null),(0,k.useState)(oJ));function s(){i(()=>e.length?e.map(e=>new oN(t(e),e)):oJ)}let o=oY({callback:s});return sQ(()=>{null==o||o.disconnect(),s(),e.forEach(e=>null==o?void 0:o.observe(e))},[e]),r}(ei),eo=function(e,t){let{transform:n,...r}=t;return null!=e&&e.length?e.reduce((e,t)=>t({transform:e,...r}),n):n}(p,{transform:{x:S.x-en.x,y:S.y-en.y,scaleX:1,scaleY:1},activatorEvent:O,active:A,activeNodeRect:K,containerNodeRect:G,draggingNodeRect:ee,over:X.current.over,overlayNodeRect:Z.rect,scrollableAncestors:ei,scrollableAncestorRects:es,windowRect:er}),ea=V?s6(V,S):null,el=function(e){let[t,n]=(0,k.useState)(null),r=(0,k.useRef)(e),i=(0,k.useCallback)(e=>{var t;let r=(e.target,null);r&&n(e=>e?(e.set(r,ox(r)),new Map(e)):null)},[]);return(0,k.useEffect)(()=>{let t=r.current;if(e!==t){i(t);let s=e.map(e=>null).filter(e=>null!=e);n(s.length?new Map(s):null),r.current=e}return()=>{i(e),i(t)};function i(e){e.forEach(e=>{})}},[i,e]),(0,k.useMemo)(()=>e.length?t?Array.from(t.values()).reduce((e,t)=>s6(e,t),ou):oS(e):ou,[e,t])}(ei),ec=oQ(el),eu=oQ(el,[K]),eh=s6(eo,ec),ed=ee?op(ee,eo):null,ef=A&&ed?d({active:A,collisionRect:ed,droppableRects:z,droppableContainers:H,pointerCoordinates:ea}):null,ep=function(e,t){if(!e||0===e.length)return null;let[n]=e;return t?n[t]:n}(ef,"id"),[eg,em]=(0,k.useState)(null),e_=(s=et?eo:s6(eo,eu),o=null!=(i=null==eg?void 0:eg.rect)?i:null,{...s,scaleX:o&&K?o.width/K.width:1,scaleY:o&&K?o.height/K.height:1}),ey=(0,k.useRef)(null),ev=(0,k.useCallback)((e,t)=>{let{sensor:n,options:r}=t;if(null==R.current)return;let i=C.get(R.current);if(!i)return;let s=e.nativeEvent,o=new n({active:R.current,activeNode:i,event:s,options:r,context:X,onAbort(e){if(!C.get(e))return;let{onDragAbort:t}=B.current,n={id:e};null==t||t(n),y({type:"onDragAbort",event:n})},onPending(e,t,n,r){if(!C.get(e))return;let{onDragPending:i}=B.current,s={id:e,constraint:t,initialCoordinates:n,offset:r};null==i||i(s),y({type:"onDragPending",event:s})},onStart(e){let t=R.current;if(null==t)return;let n=C.get(t);if(!n)return;let{onDragStart:r}=B.current,i={activatorEvent:s,active:{id:t,data:n.data,rect:D}};(0,sq.unstable_batchedUpdates)(()=>{null==r||r(i),w(lC.Initializing),_({type:lg.DragStart,initialCoordinates:e,active:t}),y({type:"onDragStart",event:i}),M(ey.current),L(s)})},onMove(e){_({type:lg.DragMove,coordinates:e})},onEnd:a(lg.DragEnd),onCancel:a(lg.DragCancel)});function a(e){return async function(){let{active:t,collisions:n,over:r,scrollAdjustedTranslate:i}=X.current,o=null;if(t&&i){let{cancelDrop:a}=B.current;o={activatorEvent:s,active:t,collisions:n,delta:i,over:r},e===lg.DragEnd&&"function"==typeof a&&await Promise.resolve(a(o))&&(e=lg.DragCancel)}R.current=null,(0,sq.unstable_batchedUpdates)(()=>{_({type:e}),w(lC.Uninitialized),em(null),M(null),L(null),ey.current=null;let t=e===lg.DragEnd?"onDragEnd":"onDragCancel";if(o){let e=B.current[t];null==e||e(o),y({type:t,event:o})}})}}ey.current=o},[C]),eb=(0,k.useCallback)((e,t)=>(n,r)=>{let i=n.nativeEvent,s=C.get(r);null!==R.current||!s||i.dndKit||i.defaultPrevented||!0!==e(n,t.options,{active:s})||(i.dndKit={capturedBy:t.sensor},R.current=r,ev(n,t))},[C,ev]),ew=(0,k.useMemo)(()=>h.reduce((e,t)=>{let{sensor:n}=t;return[...e,...n.activators.map(e=>({eventName:e.eventName,handler:eb(e.handler,t)}))]},[]),[h,eb]);(0,k.useEffect)(()=>{},h.map(e=>{let{sensor:t}=e;return t})),sQ(()=>{K&&b===lC.Initializing&&w(lC.Initialized)},[K,b]),(0,k.useEffect)(()=>{let{onDragMove:e}=B.current,{active:t,activatorEvent:n,collisions:r,over:i}=X.current;if(!t||!n)return;let s={active:t,activatorEvent:n,collisions:r,delta:{x:eh.x,y:eh.y},over:i};(0,sq.unstable_batchedUpdates)(()=>{null==e||e(s),y({type:"onDragMove",event:s})})},[eh.x,eh.y]),(0,k.useEffect)(()=>{let{active:e,activatorEvent:t,collisions:n,droppableContainers:r,scrollAdjustedTranslate:i}=X.current;if(!e||null==R.current||!t||!i)return;let{onDragOver:s}=B.current,o=r.get(ep),a=o&&o.rect.current?{id:o.id,rect:o.rect.current,data:o.data,disabled:o.disabled}:null,l={active:e,activatorEvent:t,collisions:n,delta:{x:i.x,y:i.y},over:a};(0,sq.unstable_batchedUpdates)(()=>{em(a),null==s||s(l),y({type:"onDragOver",event:l})})},[ep]),sQ(()=>{X.current={activatorEvent:O,active:A,activeNode:U,collisionRect:ed,collisions:ef,droppableRects:z,draggableNodes:C,draggingNode:J,draggingNodeRect:ee,droppableContainers:I,over:eg,scrollableAncestors:ei,scrollAdjustedTranslate:eh},D.current={initial:ee,translated:ed}},[A,U,ef,ed,C,J,ee,z,I,eg,ei,eh]),function(e){let{acceleration:t,activator:n=lb.Pointer,canScroll:r,draggingRect:i,enabled:s,interval:o=5,order:a=lw.TreeOrder,pointerCoordinates:l,scrollableAncestors:c,scrollableAncestorRects:u,delta:h,threshold:d}=e,f=function(e){let{delta:t,disabled:n}=e,r=s2(t);return s0(e=>{if(n||!r||!e)return oU;let i={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[lm.Backward]:e.x[lm.Backward]||-1===i.x,[lm.Forward]:e.x[lm.Forward]||1===i.x},y:{[lm.Backward]:e.y[lm.Backward]||-1===i.y,[lm.Forward]:e.y[lm.Forward]||1===i.y}}},[n,t,r])}({delta:h,disabled:!s}),[p,g]=function(){let e=(0,k.useRef)(null);return[(0,k.useCallback)((t,n)=>{e.current=setInterval(t,n)},[]),(0,k.useCallback)(()=>{null!==e.current&&(clearInterval(e.current),e.current=null)},[])]}(),m=(0,k.useRef)({x:0,y:0}),_=(0,k.useRef)({x:0,y:0}),y=(0,k.useMemo)(()=>{switch(n){case lb.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case lb.DraggableRect:return i}},[n,i,l]),v=(0,k.useRef)(null),b=(0,k.useCallback)(()=>{let e=v.current;if(!e)return;let t=m.current.x*_.current.x,n=m.current.y*_.current.y;e.scrollBy(t,n)},[]),w=(0,k.useMemo)(()=>a===lw.TreeOrder?[...c].reverse():c,[a,c]);(0,k.useEffect)(()=>{if(!s||!c.length||!y){g();return}for(let e of w){if((null==r?void 0:r(e))===!1)continue;let n=u[c.indexOf(e)];if(!n)continue;let{direction:i,speed:s}=function(e,t,n,r,i){let{top:s,left:o,right:a,bottom:l}=n;void 0===r&&(r=10),void 0===i&&(i=oC);let{isTop:c,isBottom:u,isLeft:h,isRight:d}=oE(e),f={x:0,y:0},p={x:0,y:0},g={height:t.height*i.y,width:t.width*i.x};return!c&&s<=t.top+g.height?(f.y=lm.Backward,p.y=r*Math.abs((t.top+g.height-s)/g.height)):!u&&l>=t.bottom-g.height&&(f.y=lm.Forward,p.y=r*Math.abs((t.bottom-g.height-l)/g.height)),!d&&a>=t.right-g.width?(f.x=lm.Forward,p.x=r*Math.abs((t.right-g.width-a)/g.width)):!h&&o<=t.left+g.width&&(f.x=lm.Backward,p.x=r*Math.abs((t.left+g.width-o)/g.width)),{direction:f,speed:p}}(e,n,y,t,d);for(let e of["x","y"])f[e][i[e]]||(s[e]=0,i[e]=0);if(s.x>0||s.y>0){g(),v.current=e,p(b,o),m.current=s,_.current=i;return}}m.current={x:0,y:0},_.current={x:0,y:0},g()},[t,b,r,g,s,o,JSON.stringify(y),JSON.stringify(f),p,c,w,u,JSON.stringify(d)])}({...W,delta:S,draggingRect:ed,pointerCoordinates:ea,scrollableAncestors:ei,scrollableAncestorRects:es});let ex=(0,k.useMemo)(()=>({active:A,activeNode:U,activeNodeRect:K,activatorEvent:O,collisions:ef,containerNodeRect:G,dragOverlay:Z,draggableNodes:C,droppableContainers:I,droppableRects:z,over:eg,measureDroppableContainers:$,scrollableAncestors:ei,scrollableAncestorRects:es,measuringConfiguration:j,measuringScheduled:q,windowRect:er}),[A,U,K,O,ef,G,Z,C,I,z,eg,$,ei,es,j,q,er]),eE=(0,k.useMemo)(()=>({activatorEvent:O,activators:ew,active:A,activeNodeRect:K,ariaDescribedById:{draggable:F},dispatch:_,draggableNodes:C,over:eg,measureDroppableContainers:$}),[O,ew,A,K,_,F,C,eg,$]);return N().createElement(os.Provider,{value:v},N().createElement(o6.Provider,{value:eE},N().createElement(o8.Provider,{value:ex},N().createElement(at.Provider,{value:e_},u)),N().createElement(ae,{disabled:(null==l?void 0:l.restoreFocus)===!1})),N().createElement(ol,{...l,hiddenTextDescribedById:F}))}),ar=(0,k.createContext)(null),ai="button",as={timeout:25};ld={styles:{active:{opacity:"0"}}},e=>{let{active:t,dragOverlay:n}=e,r={},{styles:i,className:s}=ld;if(null!=i&&i.active)for(let[e,n]of Object.entries(i.active))void 0!==n&&(r[e]=t.node.style.getPropertyValue(e),t.node.style.setProperty(e,n));if(null!=i&&i.dragOverlay)for(let[e,t]of Object.entries(i.dragOverlay))void 0!==t&&n.node.style.setProperty(e,t);return null!=s&&s.active&&t.node.classList.add(s.active),null!=s&&s.dragOverlay&&n.node.classList.add(s.dragOverlay),function(){for(let[e,n]of Object.entries(r))t.node.style.setProperty(e,n);null!=s&&s.active&&t.node.classList.remove(s.active)}};let ao={opportunities:"pink",enablers:"blue",actors:"yellow"};function aa({note:e,onClick:t,isSelected:n=!1,isConnecting:r=!1,rotation:i=0}){let{attributes:s,listeners:o,setNodeRef:a,transform:l,isDragging:c}=function(e){let{id:t,data:n,disabled:r=!1,attributes:i}=e,s=s5("Draggable"),{activators:o,activatorEvent:a,active:l,activeNodeRect:c,ariaDescribedById:u,draggableNodes:h,over:d}=(0,k.useContext)(o6),{role:f=ai,roleDescription:p="draggable",tabIndex:g=0}=null!=i?i:{},m=(null==l?void 0:l.id)===t,_=(0,k.useContext)(m?at:ar),[y,v]=s1(),[b,w]=s1(),x=(0,k.useMemo)(()=>o.reduce((e,n)=>{let{eventName:r,handler:i}=n;return e[r]=e=>{i(e,t)},e},{}),[o,t]),E=sJ(n);return sQ(()=>(h.set(t,{id:t,key:s,node:y,activatorNode:b,data:E}),()=>{let e=h.get(t);e&&e.key===s&&h.delete(t)}),[h,t]),{active:l,activatorEvent:a,activeNodeRect:c,attributes:(0,k.useMemo)(()=>({role:f,tabIndex:g,"aria-disabled":r,"aria-pressed":!!m&&f===ai||void 0,"aria-roledescription":p,"aria-describedby":u.draggable}),[r,f,g,m,p,u.draggable]),isDragging:m,listeners:r?void 0:x,node:y,over:d,setNodeRef:v,setActivatorNodeRef:w,transform:_}}({id:e.id,data:{note:e}}),u=ao[e.category]||"pink",h=e.votes||0,d=e.tags||[],f={transform:oe.Translate.toString(l),opacity:c?.5:1,cursor:"grab"};return(0,S.jsxs)("div",{ref:a,...o,...s,"data-note-id":e.id,className:`${sB().card} ${sB()[u]} ${n?sB().selected:""} ${r?sB().connecting:""}`,style:f,onClick:t,children:[S.jsx("p",{className:sB().cardText,children:e.text}),(0,S.jsxs)("div",{className:sB().cardFooter,children:[S.jsx("div",{className:sB().dots,children:Array.from({length:Math.min(h,10)}).map((e,t)=>S.jsx("span",{className:sB().dot},t))}),d.length>0&&S.jsx("div",{className:sB().tags,children:d.map(e=>S.jsx("span",{className:sB().tag,children:e},e))})]})]})}function al({category:e,timeframe:t,children:n}){let{isOver:r,setNodeRef:i}=function(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:i}=e,s=s5("Droppable"),{active:o,dispatch:a,over:l,measureDroppableContainers:c}=(0,k.useContext)(o6),u=(0,k.useRef)({disabled:n}),h=(0,k.useRef)(!1),d=(0,k.useRef)(null),f=(0,k.useRef)(null),{disabled:p,updateMeasurementsFor:g,timeout:m}={...as,...i},_=sJ(null!=g?g:r),y=oY({callback:(0,k.useCallback)(()=>{if(!h.current){h.current=!0;return}null!=f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{c(Array.isArray(_.current)?_.current:[_.current]),f.current=null},m)},[m]),disabled:p||!o}),[v,b]=s1((0,k.useCallback)((e,t)=>{y&&(t&&(y.unobserve(t),h.current=!1),e&&y.observe(e))},[y])),w=sJ(t);return(0,k.useEffect)(()=>{y&&v.current&&(y.disconnect(),h.current=!1,y.observe(v.current))},[v,y]),(0,k.useEffect)(()=>(a({type:lg.RegisterDroppable,element:{id:r,key:s,disabled:n,node:v,rect:d,data:w}}),()=>a({type:lg.UnregisterDroppable,key:s,id:r})),[r]),(0,k.useEffect)(()=>{n!==u.current.disabled&&(a({type:lg.SetDroppableDisabled,id:r,key:s,disabled:n}),u.current.disabled=n)},[r,s,n,a]),{active:o,rect:d,isOver:(null==l?void 0:l.id)===r,node:v,over:l,setNodeRef:b}}({id:`${e}-${t}`,data:{category:e,timeframe:t}});return S.jsx("div",{ref:i,className:sB().boardCell,style:{backgroundColor:r?"rgba(102, 126, 234, 0.1)":void 0,transition:"background-color 0.2s"},children:n})}function ac(e){if("string"==typeof e||"number"==typeof e)return""+e;let t="";if(Array.isArray(e))for(let n=0,r;n<e.length;n++)""!==(r=ac(e[n]))&&(t+=(t&&" ")+r);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}var au=n(4657);let ah=e=>{let t;let n=new Set,r=(e,r)=>{let i="function"==typeof e?e(t):e;if(!Object.is(i,t)){let e=t;t=(null!=r?r:"object"!=typeof i||null===i)?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,s={setState:r,getState:i,getInitialState:()=>o,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},o=t=e(r,i,s);return s},ad=e=>e?ah(e):ah,{useDebugValue:af}=k,{useSyncExternalStoreWithSelector:ap}=au,ag=e=>e;function am(e,t=ag,n){let r=ap(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return af(r),r}let a_=(e,t)=>{let n=ad(e),r=(e,r=t)=>am(n,e,r);return Object.assign(r,n),r},ay=(e,t)=>e?a_(e,t):a_;function av(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(let[n,r]of e)if(!Object.is(r,t.get(n)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(let n of e)if(!t.has(n))return!1;return!0}let n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(let r of n)if(!Object.prototype.hasOwnProperty.call(t,r)||!Object.is(e[r],t[r]))return!1;return!0}var ab={value:()=>{}};function aw(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw Error("illegal type: "+e);r[e]=[]}return new ax(r)}function ax(e){this._=e}function aE(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=ab,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}function aC(){}function aS(e){return null==e?aC:function(){return this.querySelector(e)}}function ak(){return[]}function aN(e){return null==e?ak:function(){return this.querySelectorAll(e)}}function aI(e){return function(){return this.matches(e)}}function aT(e){return function(t){return t.matches(e)}}ax.prototype=aw.prototype={constructor:ax,on:function(e,t){var n,r=this._,i=(e+"").trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");if(n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),e&&!r.hasOwnProperty(e))throw Error("unknown type: "+e);return{type:e,name:t}}),s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((n=(e=i[s]).type)&&(n=function(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}(r[n],e.name)))return n;return}if(null!=t&&"function"!=typeof t)throw Error("invalid callback: "+t);for(;++s<o;)if(n=(e=i[s]).type)r[n]=aE(r[n],e.name,t);else if(null==t)for(n in r)r[n]=aE(r[n],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new ax(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=Array(n),s=0;s<n;++s)i[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw Error("unknown type: "+e);for(r=this._[e],s=0,n=r.length;s<n;++s)r[s].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw Error("unknown type: "+e);for(var r=this._[e],i=0,s=r.length;i<s;++i)r[i].value.apply(t,n)}};var aD=Array.prototype.find;function aA(){return this.firstElementChild}var aR=Array.prototype.filter;function aP(){return Array.from(this.children)}function aM(e){return Array(e.length)}function aO(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function aL(e,t,n,r,i,s){for(var o,a=0,l=t.length,c=s.length;a<c;++a)(o=t[a])?(o.__data__=s[a],r[a]=o):n[a]=new aO(e,s[a]);for(;a<l;++a)(o=t[a])&&(i[a]=o)}function aB(e,t,n,r,i,s,o){var a,l,c,u=new Map,h=t.length,d=s.length,f=Array(h);for(a=0;a<h;++a)(l=t[a])&&(f[a]=c=o.call(l,l.__data__,a,t)+"",u.has(c)?i[a]=l:u.set(c,l));for(a=0;a<d;++a)c=o.call(e,s[a],a,s)+"",(l=u.get(c))?(r[a]=l,l.__data__=s[a],u.delete(c)):n[a]=new aO(e,s[a]);for(a=0;a<h;++a)(l=t[a])&&u.get(f[a])===l&&(i[a]=l)}function aF(e){return e.__data__}function aH(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}aO.prototype={constructor:aO,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var aj="http://www.w3.org/1999/xhtml";let az={svg:"http://www.w3.org/2000/svg",xhtml:aj,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function a$(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),az.hasOwnProperty(t)?{space:az[t],local:e}:e}function aq(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function aU(e,t){return e.style.getPropertyValue(t)||aq(e).getComputedStyle(e,null).getPropertyValue(t)}function aV(e){return e.trim().split(/^|\s+/)}function aW(e){return e.classList||new aY(e)}function aY(e){this._node=e,this._names=aV(e.getAttribute("class")||"")}function aK(e,t){for(var n=aW(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function aG(e,t){for(var n=aW(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function aX(){this.textContent=""}function aQ(){this.innerHTML=""}function aZ(){this.nextSibling&&this.parentNode.appendChild(this)}function aJ(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function a0(e){var t=a$(e);return(t.local?function(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}:function(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===aj&&t.documentElement.namespaceURI===aj?t.createElement(e):t.createElementNS(n,e)}})(t)}function a1(){return null}function a2(){var e=this.parentNode;e&&e.removeChild(this)}function a3(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function a5(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function a4(e){return function(){var t=this.__on;if(t){for(var n,r=0,i=-1,s=t.length;r<s;++r)(n=t[r],e.type&&n.type!==e.type||n.name!==e.name)?t[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?t.length=i:delete this.__on}}}function a6(e,t,n){return function(){var r,i=this.__on,s=function(e){t.call(this,e,this.__data__)};if(i){for(var o=0,a=i.length;o<a;++o)if((r=i[o]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=t;return}}this.addEventListener(e.type,s,n),r={type:e.type,name:e.name,value:t,listener:s,options:n},i?i.push(r):this.__on=[r]}}function a8(e,t,n){var r=aq(e),i=r.CustomEvent;"function"==typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}aY.prototype={add:function(e){0>this._names.indexOf(e)&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var a7=[null];function a9(e,t){this._groups=e,this._parents=t}function le(){return new a9([[document.documentElement]],a7)}function lt(e){return"string"==typeof e?new a9([[document.querySelector(e)]],[document.documentElement]):new a9([[e]],a7)}a9.prototype=le.prototype={constructor:a9,select:function(e){"function"!=typeof e&&(e=aS(e));for(var t=this._groups,n=t.length,r=Array(n),i=0;i<n;++i)for(var s,o,a=t[i],l=a.length,c=r[i]=Array(l),u=0;u<l;++u)(s=a[u])&&(o=e.call(s,s.__data__,u,a))&&("__data__"in s&&(o.__data__=s.__data__),c[u]=o);return new a9(r,this._parents)},selectAll:function(e){if("function"==typeof e){var t;t=e,e=function(){var e;return e=t.apply(this,arguments),null==e?[]:Array.isArray(e)?e:Array.from(e)}}else e=aN(e);for(var n=this._groups,r=n.length,i=[],s=[],o=0;o<r;++o)for(var a,l=n[o],c=l.length,u=0;u<c;++u)(a=l[u])&&(i.push(e.call(a,a.__data__,u,l)),s.push(a));return new a9(i,s)},selectChild:function(e){var t;return this.select(null==e?aA:(t="function"==typeof e?e:aT(e),function(){return aD.call(this.children,t)}))},selectChildren:function(e){var t;return this.selectAll(null==e?aP:(t="function"==typeof e?e:aT(e),function(){return aR.call(this.children,t)}))},filter:function(e){"function"!=typeof e&&(e=aI(e));for(var t=this._groups,n=t.length,r=Array(n),i=0;i<n;++i)for(var s,o=t[i],a=o.length,l=r[i]=[],c=0;c<a;++c)(s=o[c])&&e.call(s,s.__data__,c,o)&&l.push(s);return new a9(r,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,aF);var n=t?aB:aL,r=this._parents,i=this._groups;"function"!=typeof e&&(y=e,e=function(){return y});for(var s=i.length,o=Array(s),a=Array(s),l=Array(s),c=0;c<s;++c){var u=r[c],h=i[c],d=h.length,f="object"==typeof(_=e.call(u,u&&u.__data__,c,r))&&"length"in _?_:Array.from(_),p=f.length,g=a[c]=Array(p),m=o[c]=Array(p);n(u,h,g,m,l[c]=Array(d),f,t);for(var _,y,v,b,w=0,x=0;w<p;++w)if(v=g[w]){for(w>=x&&(x=w+1);!(b=m[x])&&++x<p;);v._next=b||null}}return(o=new a9(o,r))._enter=a,o._exit=l,o},enter:function(){return new a9(this._enter||this._groups.map(aM),this._parents)},exit:function(){return new a9(this._exit||this._groups.map(aM),this._parents)},join:function(e,t,n){var r=this.enter(),i=this,s=this.exit();return"function"==typeof e?(r=e(r))&&(r=r.selection()):r=r.append(e+""),null!=t&&(i=t(i))&&(i=i.selection()),null==n?s.remove():n(s),r&&i?r.merge(i).order():i},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,s=r.length,o=Math.min(i,s),a=Array(i),l=0;l<o;++l)for(var c,u=n[l],h=r[l],d=u.length,f=a[l]=Array(d),p=0;p<d;++p)(c=u[p]||h[p])&&(f[p]=c);for(;l<i;++l)a[l]=n[l];return new a9(a,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,i=e[t],s=i.length-1,o=i[s];--s>=0;)(r=i[s])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=aH);for(var n=this._groups,r=n.length,i=Array(r),s=0;s<r;++s){for(var o,a=n[s],l=a.length,c=i[s]=Array(l),u=0;u<l;++u)(o=a[u])&&(c[u]=o);c.sort(t)}return new a9(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null},size:function(){let e=0;for(let t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i,s=t[n],o=0,a=s.length;o<a;++o)(i=s[o])&&e.call(i,i.__data__,o,s);return this},attr:function(e,t){var n=a$(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?function(e){return function(){this.removeAttributeNS(e.space,e.local)}}:function(e){return function(){this.removeAttribute(e)}}:"function"==typeof t?n.local?function(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}:function(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}:n.local?function(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}:function(e,t){return function(){this.setAttribute(e,t)}})(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?function(e){return function(){this.style.removeProperty(e)}}:"function"==typeof t?function(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}:function(e,t,n){return function(){this.style.setProperty(e,t,n)}})(e,t,null==n?"":n)):aU(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?function(e){return function(){delete this[e]}}:"function"==typeof t?function(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}:function(e,t){return function(){this[e]=t}})(e,t)):this.node()[e]},classed:function(e,t){var n=aV(e+"");if(arguments.length<2){for(var r=aW(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof t?function(e,t){return function(){(t.apply(this,arguments)?aK:aG)(this,e)}}:t?function(e){return function(){aK(this,e)}}:function(e){return function(){aG(this,e)}})(n,t))},text:function(e){return arguments.length?this.each(null==e?aX:("function"==typeof e?function(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}:function(e){return function(){this.textContent=e}})(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?aQ:("function"==typeof e?function(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}:function(e){return function(){this.innerHTML=e}})(e)):this.node().innerHTML},raise:function(){return this.each(aZ)},lower:function(){return this.each(aJ)},append:function(e){var t="function"==typeof e?e:a0(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"==typeof e?e:a0(e),r=null==t?a1:"function"==typeof t?t:aS(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(a2)},clone:function(e){return this.select(e?a5:a3)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,i,s=(e+"").trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}),o=s.length;if(arguments.length<2){var a=this.node().__on;if(a){for(var l,c=0,u=a.length;c<u;++c)for(r=0,l=a[c];r<o;++r)if((i=s[r]).type===l.type&&i.name===l.name)return l.value}return}for(r=0,a=t?a6:a4;r<o;++r)this.each(a(s[r],t,n));return this},dispatch:function(e,t){return this.each(("function"==typeof t?function(e,t){return function(){return a8(this,e,t.apply(this,arguments))}}:function(e,t){return function(){return a8(this,e,t)}})(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r,i=e[t],s=0,o=i.length;s<o;++s)(r=i[s])&&(yield r)}};let ln={passive:!1},lr={capture:!0,passive:!1};function li(e){e.stopImmediatePropagation()}function ls(e){e.preventDefault(),e.stopImmediatePropagation()}function lo(e){var t=e.document.documentElement,n=lt(e).on("dragstart.drag",ls,lr);"onselectstart"in t?n.on("selectstart.drag",ls,lr):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function la(e,t){var n=e.document.documentElement,r=lt(e).on("dragstart.drag",null);t&&(r.on("click.drag",ls,lr),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function ll(e){return((e=Math.exp(e))+1/e)/2}let lc=function e(t,n,r){function i(e,i){var s,o,a=e[0],l=e[1],c=e[2],u=i[0],h=i[1],d=i[2],f=u-a,p=h-l,g=f*f+p*p;if(g<1e-12)o=Math.log(d/c)/t,s=function(e){return[a+e*f,l+e*p,c*Math.exp(t*e*o)]};else{var m=Math.sqrt(g),_=(d*d-c*c+r*g)/(2*c*n*m),y=(d*d-c*c-r*g)/(2*d*n*m),v=Math.log(Math.sqrt(_*_+1)-_);o=(Math.log(Math.sqrt(y*y+1)-y)-v)/t,s=function(e){var r,i,s=e*o,u=ll(v),h=c/(n*m)*(((r=Math.exp(2*(r=t*s+v)))-1)/(r+1)*u-((i=Math.exp(i=v))-1/i)/2);return[a+h*f,l+h*p,c*u/ll(t*s+v)]}}return s.duration=1e3*o*t/Math.SQRT2,s}return i.rho=function(t){var n=Math.max(.001,+t),r=n*n;return e(n,r,r*r)},i}(Math.SQRT2,2,4);function lu(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}var lh,ld,lf,lp,lg,lm,l_,ly,lv,lb,lw,lx,lE,lC,lS,lk,lN=0,lI=0,lT=0,lD=0,lA=0,lR=0,lP="object"==typeof performance&&performance.now?performance:Date,lM=function(e){setTimeout(e,17)};function lO(){return lA||(lM(lL),lA=lP.now()+lR)}function lL(){lA=0}function lB(){this._call=this._time=this._next=null}function lF(e,t,n){var r=new lB;return r.restart(e,t,n),r}function lH(){lA=(lD=lP.now())+lR,lN=lI=0;try{!function(){lO(),++lN;for(var e,t=lS;t;)(e=lA-t._time)>=0&&t._call.call(void 0,e),t=t._next;--lN}()}finally{lN=0,function(){for(var e,t,n=lS,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:lS=t);lk=e,lz(r)}(),lA=0}}function lj(){var e=lP.now(),t=e-lD;t>1e3&&(lR-=t,lD=e)}function lz(e){!lN&&(lI&&(lI=clearTimeout(lI)),e-lA>24?(e<1/0&&(lI=setTimeout(lH,e-lP.now()-lR)),lT&&(lT=clearInterval(lT))):(lT||(lD=lP.now(),lT=setInterval(lj,1e3)),lN=1,lM(lH)))}function l$(e,t,n){var r=new lB;return t=null==t?0:+t,r.restart(n=>{r.stop(),e(n+t)},t,n),r}lB.prototype=lF.prototype={constructor:lB,restart:function(e,t,n){if("function"!=typeof e)throw TypeError("callback is not a function");n=(null==n?lO():+n)+(null==t?0:+t),this._next||lk===this||(lk?lk._next=this:lS=this,lk=this),this._call=e,this._time=n,lz()},stop:function(){this._call&&(this._call=null,this._time=1/0,lz())}};var lq=aw("start","end","cancel","interrupt"),lU=[];function lV(e,t,n,r,i,s){var o=e.__transition;if(o){if(n in o)return}else e.__transition={};(function(e,t,n){var r,i=e.__transition;function s(l){var c,u,h,d;if(1!==n.state)return a();for(c in i)if((d=i[c]).name===n.name){if(3===d.state)return l$(s);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete i[c]):+c<t&&(d.state=6,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete i[c])}if(l$(function(){3===n.state&&(n.state=4,n.timer.restart(o,n.delay,n.time),o(l))}),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(c=0,n.state=3,r=Array(h=n.tween.length),u=-1;c<h;++c)(d=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(r[++u]=d);r.length=u+1}}function o(t){for(var i=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(a),n.state=5,1),s=-1,o=r.length;++s<o;)r[s].call(e,i);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),a())}function a(){for(var r in n.state=6,n.timer.stop(),delete i[t],i)return;delete e.__transition}i[t]=n,n.timer=lF(function(e){n.state=1,n.timer.restart(s,n.delay,n.time),n.delay<=e&&s(e-n.delay)},0,n.time)})(e,n,{name:t,index:r,group:i,on:lq,tween:lU,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:0})}function lW(e,t){var n=lK(e,t);if(n.state>0)throw Error("too late; already scheduled");return n}function lY(e,t){var n=lK(e,t);if(n.state>3)throw Error("too late; already running");return n}function lK(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw Error("transition not found");return n}function lG(e,t){var n,r,i,s=e.__transition,o=!0;if(s){for(i in t=null==t?null:t+"",s){if((n=s[i]).name!==t){o=!1;continue}r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete s[i]}o&&delete e.__transition}}function lX(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var lQ=180/Math.PI,lZ={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function lJ(e,t,n,r,i,s){var o,a,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),e*r<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*lQ,skewX:Math.atan(l)*lQ,scaleX:o,scaleY:a}}function l0(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(s,o){var a,l,c,u,h=[],d=[];return s=e(s),o=e(o),function(e,r,i,s,o,a){if(e!==i||r!==s){var l=o.push("translate(",null,t,null,n);a.push({i:l-4,x:lX(e,i)},{i:l-2,x:lX(r,s)})}else(i||s)&&o.push("translate("+i+t+s+n)}(s.translateX,s.translateY,o.translateX,o.translateY,h,d),(a=s.rotate)!==(l=o.rotate)?(a-l>180?l+=360:l-a>180&&(a+=360),d.push({i:h.push(i(h)+"rotate(",null,r)-2,x:lX(a,l)})):l&&h.push(i(h)+"rotate("+l+r),(c=s.skewX)!==(u=o.skewX)?d.push({i:h.push(i(h)+"skewX(",null,r)-2,x:lX(c,u)}):u&&h.push(i(h)+"skewX("+u+r),function(e,t,n,r,s,o){if(e!==n||t!==r){var a=s.push(i(s)+"scale(",null,",",null,")");o.push({i:a-4,x:lX(e,n)},{i:a-2,x:lX(t,r)})}else(1!==n||1!==r)&&s.push(i(s)+"scale("+n+","+r+")")}(s.scaleX,s.scaleY,o.scaleX,o.scaleY,h,d),s=o=null,function(e){for(var t,n=-1,r=d.length;++n<r;)h[(t=d[n]).i]=t.x(e);return h.join("")}}}var l1=l0(function(e){let t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?lZ:lJ(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),l2=l0(function(e){return null==e?lZ:(_||(_=document.createElementNS("http://www.w3.org/2000/svg","g")),_.setAttribute("transform",e),e=_.transform.baseVal.consolidate())?lJ((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):lZ},", ",")",")");function l3(e,t,n){var r=e._id;return e.each(function(){var e=lY(this,r);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return lK(e,r).value[t]}}function l5(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function l4(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function l6(){}var l8="\\s*([+-]?\\d+)\\s*",l7="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",l9="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ce=/^#([0-9a-f]{3,8})$/,ct=RegExp(`^rgb\\(${l8},${l8},${l8}\\)$`),cn=RegExp(`^rgb\\(${l9},${l9},${l9}\\)$`),cr=RegExp(`^rgba\\(${l8},${l8},${l8},${l7}\\)$`),ci=RegExp(`^rgba\\(${l9},${l9},${l9},${l7}\\)$`),cs=RegExp(`^hsl\\(${l7},${l9},${l9}\\)$`),co=RegExp(`^hsla\\(${l7},${l9},${l9},${l7}\\)$`),ca={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function cl(){return this.rgb().formatHex()}function cc(){return this.rgb().formatRgb()}function cu(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=ce.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?ch(t):3===n?new cp(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?cd(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?cd(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=ct.exec(e))?new cp(t[1],t[2],t[3],1):(t=cn.exec(e))?new cp(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=cr.exec(e))?cd(t[1],t[2],t[3],t[4]):(t=ci.exec(e))?cd(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=cs.exec(e))?cb(t[1],t[2]/100,t[3]/100,1):(t=co.exec(e))?cb(t[1],t[2]/100,t[3]/100,t[4]):ca.hasOwnProperty(e)?ch(ca[e]):"transparent"===e?new cp(NaN,NaN,NaN,0):null}function ch(e){return new cp(e>>16&255,e>>8&255,255&e,1)}function cd(e,t,n,r){return r<=0&&(e=t=n=NaN),new cp(e,t,n,r)}function cf(e,t,n,r){var i;return 1==arguments.length?((i=e)instanceof l6||(i=cu(i)),i)?new cp((i=i.rgb()).r,i.g,i.b,i.opacity):new cp:new cp(e,t,n,null==r?1:r)}function cp(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function cg(){return`#${cv(this.r)}${cv(this.g)}${cv(this.b)}`}function cm(){let e=c_(this.opacity);return`${1===e?"rgb(":"rgba("}${cy(this.r)}, ${cy(this.g)}, ${cy(this.b)}${1===e?")":`, ${e})`}`}function c_(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function cy(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function cv(e){return((e=cy(e))<16?"0":"")+e.toString(16)}function cb(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new cx(e,t,n,r)}function cw(e){if(e instanceof cx)return new cx(e.h,e.s,e.l,e.opacity);if(e instanceof l6||(e=cu(e)),!e)return new cx;if(e instanceof cx)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),s=Math.max(t,n,r),o=NaN,a=s-i,l=(s+i)/2;return a?(o=t===s?(n-r)/a+(n<r)*6:n===s?(r-t)/a+2:(t-n)/a+4,a/=l<.5?s+i:2-s-i,o*=60):a=l>0&&l<1?0:o,new cx(o,a,l,e.opacity)}function cx(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function cE(e){return(e=(e||0)%360)<0?e+360:e}function cC(e){return Math.max(0,Math.min(1,e||0))}function cS(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}function ck(e,t,n,r,i){var s=e*e,o=s*e;return((1-3*e+3*s-o)*t+(4-6*s+3*o)*n+(1+3*e+3*s-3*o)*r+o*i)/6}l5(l6,cu,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:cl,formatHex:cl,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return cw(this).formatHsl()},formatRgb:cc,toString:cc}),l5(cp,cf,l4(l6,{brighter(e){return e=null==e?1.4285714285714286:Math.pow(1.4285714285714286,e),new cp(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new cp(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new cp(cy(this.r),cy(this.g),cy(this.b),c_(this.opacity))},displayable(){return -.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:cg,formatHex:cg,formatHex8:function(){return`#${cv(this.r)}${cv(this.g)}${cv(this.b)}${cv((isNaN(this.opacity)?1:this.opacity)*255)}`},formatRgb:cm,toString:cm})),l5(cx,function(e,t,n,r){return 1==arguments.length?cw(e):new cx(e,t,n,null==r?1:r)},l4(l6,{brighter(e){return e=null==e?1.4285714285714286:Math.pow(1.4285714285714286,e),new cx(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new cx(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new cp(cS(e>=240?e-240:e+120,i,r),cS(e,i,r),cS(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new cx(cE(this.h),cC(this.s),cC(this.l),c_(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=c_(this.opacity);return`${1===e?"hsl(":"hsla("}${cE(this.h)}, ${100*cC(this.s)}%, ${100*cC(this.l)}%${1===e?")":`, ${e})`}`}}));let cN=e=>()=>e;function cI(e,t){var n=t-e;return n?function(t){return e+t*n}:cN(isNaN(e)?t:e)}let cT=function e(t){var n,r=1==(n=+(n=t))?cI:function(e,t){var r,i,s;return t-e?(r=e,i=t,r=Math.pow(r,s=n),i=Math.pow(i,s)-r,s=1/s,function(e){return Math.pow(r+e*i,s)}):cN(isNaN(e)?t:e)};function i(e,t){var n=r((e=cf(e)).r,(t=cf(t)).r),i=r(e.g,t.g),s=r(e.b,t.b),o=cI(e.opacity,t.opacity);return function(t){return e.r=n(t),e.g=i(t),e.b=s(t),e.opacity=o(t),e+""}}return i.gamma=e,i}(1);function cD(e){return function(t){var n,r,i=t.length,s=Array(i),o=Array(i),a=Array(i);for(n=0;n<i;++n)r=cf(t[n]),s[n]=r.r||0,o[n]=r.g||0,a[n]=r.b||0;return s=e(s),o=e(o),a=e(a),r.opacity=1,function(e){return r.r=s(e),r.g=o(e),r.b=a(e),r+""}}}cD(function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],s=e[r+1],o=r>0?e[r-1]:2*i-s,a=r<t-1?e[r+2]:2*s-i;return ck((n-r/t)*t,o,i,s,a)}}),cD(function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],s=e[r%t],o=e[(r+1)%t],a=e[(r+2)%t];return ck((n-r/t)*t,i,s,o,a)}});var cA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,cR=RegExp(cA.source,"g");function cP(e,t){var n;return("number"==typeof t?lX:t instanceof cu?cT:(n=cu(t))?(t=n,cT):function(e,t){var n,r,i,s,o,a=cA.lastIndex=cR.lastIndex=0,l=-1,c=[],u=[];for(e+="",t+="";(i=cA.exec(e))&&(s=cR.exec(t));)(o=s.index)>a&&(o=t.slice(a,o),c[l]?c[l]+=o:c[++l]=o),(i=i[0])===(s=s[0])?c[l]?c[l]+=s:c[++l]=s:(c[++l]=null,u.push({i:l,x:lX(i,s)})),a=cR.lastIndex;return a<t.length&&(o=t.slice(a),c[l]?c[l]+=o:c[++l]=o),c.length<2?u[0]?(n=u[0].x,function(e){return n(e)+""}):(r=t,function(){return r}):(t=u.length,function(e){for(var n,r=0;r<t;++r)c[(n=u[r]).i]=n.x(e);return c.join("")})})(e,t)}var cM=le.prototype.constructor;function cO(e){return function(){this.style.removeProperty(e)}}var cL=0;function cB(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}var cF=le.prototype;cB.prototype=(function(e){return le().transition(e)}).prototype={constructor:cB,select:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=aS(e));for(var r=this._groups,i=r.length,s=Array(i),o=0;o<i;++o)for(var a,l,c=r[o],u=c.length,h=s[o]=Array(u),d=0;d<u;++d)(a=c[d])&&(l=e.call(a,a.__data__,d,c))&&("__data__"in a&&(l.__data__=a.__data__),h[d]=l,lV(h[d],t,n,d,h,lK(a,n)));return new cB(s,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=aN(e));for(var r=this._groups,i=r.length,s=[],o=[],a=0;a<i;++a)for(var l,c=r[a],u=c.length,h=0;h<u;++h)if(l=c[h]){for(var d,f=e.call(l,l.__data__,h,c),p=lK(l,n),g=0,m=f.length;g<m;++g)(d=f[g])&&lV(d,t,n,g,f,p);s.push(f),o.push(l)}return new cB(s,o,t,n)},selectChild:cF.selectChild,selectChildren:cF.selectChildren,filter:function(e){"function"!=typeof e&&(e=aI(e));for(var t=this._groups,n=t.length,r=Array(n),i=0;i<n;++i)for(var s,o=t[i],a=o.length,l=r[i]=[],c=0;c<a;++c)(s=o[c])&&e.call(s,s.__data__,c,o)&&l.push(s);return new cB(r,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw Error();for(var t=this._groups,n=e._groups,r=t.length,i=n.length,s=Math.min(r,i),o=Array(r),a=0;a<s;++a)for(var l,c=t[a],u=n[a],h=c.length,d=o[a]=Array(h),f=0;f<h;++f)(l=c[f]||u[f])&&(d[f]=l);for(;a<r;++a)o[a]=t[a];return new cB(o,this._parents,this._name,this._id)},selection:function(){return new cM(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=++cL,r=this._groups,i=r.length,s=0;s<i;++s)for(var o,a=r[s],l=a.length,c=0;c<l;++c)if(o=a[c]){var u=lK(o,t);lV(o,e,n,c,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new cB(r,this._parents,e,n)},call:cF.call,nodes:cF.nodes,node:cF.node,size:cF.size,empty:cF.empty,each:cF.each,on:function(e,t){var n,r,i,s=this._id;return arguments.length<2?lK(this.node(),s).on.on(e):this.each((i=(e+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})?lW:lY,function(){var o=i(this,s),a=o.on;a!==n&&(r=(n=a).copy()).on(e,t),o.on=r}))},attr:function(e,t){var n=a$(e),r="transform"===n?l2:cP;return this.attrTween(e,"function"==typeof t?(n.local?function(e,t,n){var r,i,s;return function(){var o,a,l=n(this);return null==l?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local))===(a=l+"")?null:o===r&&a===i?s:(i=a,s=t(r=o,l))}}:function(e,t,n){var r,i,s;return function(){var o,a,l=n(this);return null==l?void this.removeAttribute(e):(o=this.getAttribute(e))===(a=l+"")?null:o===r&&a===i?s:(i=a,s=t(r=o,l))}})(n,r,l3(this,"attr."+e,t)):null==t?(n.local?function(e){return function(){this.removeAttributeNS(e.space,e.local)}}:function(e){return function(){this.removeAttribute(e)}})(n):(n.local?function(e,t,n){var r,i,s=n+"";return function(){var o=this.getAttributeNS(e.space,e.local);return o===s?null:o===r?i:i=t(r=o,n)}}:function(e,t,n){var r,i,s=n+"";return function(){var o=this.getAttribute(e);return o===s?null:o===r?i:i=t(r=o,n)}})(n,r,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw Error();var r=a$(e);return this.tween(n,(r.local?function(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&function(t){this.setAttributeNS(e.space,e.local,i.call(this,t))}),n}return i._value=t,i}:function(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&function(t){this.setAttribute(e,i.call(this,t))}),n}return i._value=t,i})(r,t))},style:function(e,t,n){var r,i,s,o,a,l,c,u,h,d,f,p,g,m,_,y,v,b,w,x,E,C="transform"==(e+="")?l1:cP;return null==t?this.styleTween(e,(r=e,function(){var e=aU(this,r),t=(this.style.removeProperty(r),aU(this,r));return e===t?null:e===i&&t===s?o:o=C(i=e,s=t)})).on("end.style."+e,cO(e)):"function"==typeof t?this.styleTween(e,(a=e,l=l3(this,"style."+e,t),function(){var e=aU(this,a),t=l(this),n=t+"";return null==t&&(this.style.removeProperty(a),n=t=aU(this,a)),e===n?null:e===c&&n===u?h:(u=n,h=C(c=e,t))})).each((d=this._id,v="end."+(y="style."+(f=e)),function(){var e=lY(this,d),t=e.on,n=null==e.value[y]?_||(_=cO(f)):void 0;(t!==p||m!==n)&&(g=(p=t).copy()).on(v,m=n),e.on=g})):this.styleTween(e,(b=e,E=t+"",function(){var e=aU(this,b);return e===E?null:e===w?x:x=C(w=e,t)}),n).on("end.style."+e,null)},styleTween:function(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw Error();return this.tween(r,function(e,t,n){var r,i;function s(){var s=t.apply(this,arguments);return s!==i&&(r=(i=s)&&function(t){this.style.setProperty(e,s.call(this,t),n)}),r}return s._value=t,s}(e,t,null==n?"":n))},text:function(e){var t,n;return this.tween("text","function"==typeof e?(t=l3(this,"text",e),function(){var e=t(this);this.textContent=null==e?"":e}):(n=null==e?"":e+"",function(){this.textContent=n}))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw Error();return this.tween(t,function(e){var t,n;function r(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&function(e){this.textContent=r.call(this,e)}),t}return r._value=e,r}(e))},remove:function(){var e;return this.on("end.remove",(e=this._id,function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}))},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r,i=lK(this.node(),n).tween,s=0,o=i.length;s<o;++s)if((r=i[s]).name===e)return r.value;return null}return this.each((null==t?function(e,t){var n,r;return function(){var i=lY(this,e),s=i.tween;if(s!==n){r=n=s;for(var o=0,a=r.length;o<a;++o)if(r[o].name===t){(r=r.slice()).splice(o,1);break}}i.tween=r}}:function(e,t,n){var r,i;if("function"!=typeof n)throw Error();return function(){var s=lY(this,e),o=s.tween;if(o!==r){i=(r=o).slice();for(var a={name:t,value:n},l=0,c=i.length;l<c;++l)if(i[l].name===t){i[l]=a;break}l===c&&i.push(a)}s.tween=i}})(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?function(e,t){return function(){lW(this,e).delay=+t.apply(this,arguments)}}:function(e,t){return t=+t,function(){lW(this,e).delay=t}})(t,e)):lK(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?function(e,t){return function(){lY(this,e).duration=+t.apply(this,arguments)}}:function(e,t){return t=+t,function(){lY(this,e).duration=t}})(t,e)):lK(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!=typeof t)throw Error();return function(){lY(this,e).ease=t}}(t,e)):lK(this.node(),t).ease},easeVarying:function(e){var t;if("function"!=typeof e)throw Error();return this.each((t=this._id,function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw Error();lY(this,t).ease=n}))},end:function(){var e,t,n=this,r=n._id,i=n.size();return new Promise(function(s,o){var a={value:o},l={value:function(){0==--i&&s()}};n.each(function(){var n=lY(this,r),i=n.on;i!==e&&((t=(e=i).copy())._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),n.on=t}),0===i&&s()})},[Symbol.iterator]:cF[Symbol.iterator]};var cH={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};le.prototype.interrupt=function(e){return this.each(function(){lG(this,e)})},le.prototype.transition=function(e){var t,n;e instanceof cB?(t=e._id,e=e._name):(t=++cL,(n=cH).time=lO(),e=null==e?null:e+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o,a=r[s],l=a.length,c=0;c<l;++c)(o=a[c])&&lV(o,e,t,c,a,n||function(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw Error(`transition ${t} not found`);return n}(o,t));return new cB(r,this._parents,e,t)};let cj=e=>()=>e;function cz(e,{sourceEvent:t,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function c$(e,t,n){this.k=e,this.x=t,this.y=n}c$.prototype={constructor:c$,scale:function(e){return 1===e?this:new c$(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new c$(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var cq=new c$(1,0,0);function cU(e){e.stopImmediatePropagation()}function cV(e){e.preventDefault(),e.stopImmediatePropagation()}function cW(e){return(!e.ctrlKey||"wheel"===e.type)&&!e.button}function cY(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function cK(){return this.__zoom||cq}function cG(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function cX(){return navigator.maxTouchPoints||"ontouchstart"in this}function cQ(e,t,n){var r=e.invertX(t[0][0])-n[0][0],i=e.invertX(t[1][0])-n[1][0],s=e.invertY(t[0][1])-n[0][1],o=e.invertY(t[1][1])-n[1][1];return e.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}c$.prototype;let cZ=e=>()=>e;function cJ(e,{sourceEvent:t,subject:n,target:r,identifier:i,active:s,x:o,y:a,dx:l,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}function c0(e){return!e.ctrlKey&&!e.button}function c1(){return this.parentNode}function c2(e,t){return null==t?{x:e.x,y:e.y}:t}function c3(){return navigator.maxTouchPoints||"ontouchstart"in this}cJ.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};let c5=(0,k.createContext)(null),c4=c5.Provider,c6={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,t)=>`Couldn't create edge for ${e?"target":"source"} handle id: "${e?t.targetHandle:t.sourceHandle}", edge id: ${t.id}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`},c8=c6.error001();function c7(e,t){let n=(0,k.useContext)(c5);if(null===n)throw Error(c8);return am(n,e,t)}let c9=()=>{let e=(0,k.useContext)(c5);if(null===e)throw Error(c8);return(0,k.useMemo)(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe,destroy:e.destroy}),[e])},ue=e=>e.userSelectionActive?"none":"all";function ut({position:e,children:t,className:n,style:r,...i}){let s=c7(ue),o=`${e}`.split("-");return k.createElement("div",{className:ac(["react-flow__panel",n,...o]),style:{...r,pointerEvents:s},...i},t)}function un({proOptions:e,position:t="bottom-right"}){return e?.hideAttribution?null:k.createElement(ut,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},k.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}var ur=(0,k.memo)(({x:e,y:t,label:n,labelStyle:r={},labelShowBg:i=!0,labelBgStyle:s={},labelBgPadding:o=[2,4],labelBgBorderRadius:a=2,children:l,className:c,...u})=>{let h=(0,k.useRef)(null),[d,f]=(0,k.useState)({x:0,y:0,width:0,height:0}),p=ac(["react-flow__edge-textwrapper",c]);return((0,k.useEffect)(()=>{if(h.current){let e=h.current.getBBox();f({x:e.x,y:e.y,width:e.width,height:e.height})}},[n]),void 0!==n&&n)?k.createElement("g",{transform:`translate(${e-d.width/2} ${t-d.height/2})`,className:p,visibility:d.width?"visible":"hidden",...u},i&&k.createElement("rect",{width:d.width+2*o[0],x:-o[0],y:-o[1],height:d.height+2*o[1],className:"react-flow__edge-textbg",style:s,rx:a,ry:a}),k.createElement("text",{className:"react-flow__edge-text",y:d.height/2,dy:"0.3em",ref:h,style:r},n),l):null});let ui=e=>({width:e.offsetWidth,height:e.offsetHeight}),us=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),uo=(e={x:0,y:0},t)=>({x:us(e.x,t[0][0],t[1][0]),y:us(e.y,t[0][1],t[1][1])}),ua=(e,t,n)=>e<t?us(Math.abs(e-t),1,50)/50:e>n?-us(Math.abs(e-n),1,50)/50:0,ul=(e,t)=>[20*ua(e.x,35,t.width-35),20*ua(e.y,35,t.height-35)],uc=e=>e.getRootNode?.()||window?.document,uu=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),uh=({x:e,y:t,width:n,height:r})=>({x:e,y:t,x2:e+n,y2:t+r}),ud=({x:e,y:t,x2:n,y2:r})=>({x:e,y:t,width:n-e,height:r-t}),uf=e=>({...e.positionAbsolute||{x:0,y:0},width:e.width||0,height:e.height||0}),up=(e,t)=>Math.ceil(Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x))*Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y))),ug=e=>um(e.width)&&um(e.height)&&um(e.x)&&um(e.y),um=e=>!isNaN(e)&&isFinite(e),u_=Symbol.for("internals"),uy=["Enter"," ","Escape"],uv=(e,t)=>{},ub=e=>"nativeEvent"in e;function uw(e){let t=ub(e)?e.nativeEvent:e,n=t.composedPath?.()?.[0]||e.target;return["INPUT","SELECT","TEXTAREA"].includes(n?.nodeName)||n?.hasAttribute("contenteditable")||!!n?.closest(".nokey")}let ux=e=>"clientX"in e,uE=(e,t)=>{let n=ux(e),r=n?e.clientX:e.touches?.[0].clientX,i=n?e.clientY:e.touches?.[0].clientY;return{x:r-(t?.left??0),y:i-(t?.top??0)}},uC=()=>"undefined"!=typeof navigator&&navigator?.userAgent?.indexOf("Mac")>=0,uS=({id:e,path:t,labelX:n,labelY:r,label:i,labelStyle:s,labelShowBg:o,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:h,markerStart:d,interactionWidth:f=20})=>k.createElement(k.Fragment,null,k.createElement("path",{id:e,style:u,d:t,fill:"none",className:"react-flow__edge-path",markerEnd:h,markerStart:d}),f&&k.createElement("path",{d:t,fill:"none",strokeOpacity:0,strokeWidth:f,className:"react-flow__edge-interaction"}),i&&um(n)&&um(r)?k.createElement(ur,{x:n,y:r,label:i,labelStyle:s,labelShowBg:o,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c}):null);function uk(e,t,n){return void 0===n?n:r=>{let i=t().edges.find(t=>t.id===e);i&&n(r,{...i})}}function uN({sourceX:e,sourceY:t,targetX:n,targetY:r}){let i=Math.abs(n-e)/2,s=Math.abs(r-t)/2;return[n<e?n+i:n-i,r<t?r+s:r-s,i,s]}function uI({sourceX:e,sourceY:t,targetX:n,targetY:r,sourceControlX:i,sourceControlY:s,targetControlX:o,targetControlY:a}){let l=.125*e+.375*i+.375*o+.125*n,c=.125*t+.375*s+.375*a+.125*r;return[l,c,Math.abs(l-e),Math.abs(c-t)]}function uT({pos:e,x1:t,y1:n,x2:r,y2:i}){return e===E.Left||e===E.Right?[.5*(t+r),n]:[t,.5*(n+i)]}function uD({sourceX:e,sourceY:t,sourcePosition:n=E.Bottom,targetX:r,targetY:i,targetPosition:s=E.Top}){let[o,a]=uT({pos:n,x1:e,y1:t,x2:r,y2:i}),[l,c]=uT({pos:s,x1:r,y1:i,x2:e,y2:t}),[u,h,d,f]=uI({sourceX:e,sourceY:t,targetX:r,targetY:i,sourceControlX:o,sourceControlY:a,targetControlX:l,targetControlY:c});return[`M${e},${t} C${o},${a} ${l},${c} ${r},${i}`,u,h,d,f]}uS.displayName="BaseEdge",function(e){e.Strict="strict",e.Loose="loose"}(y||(y={})),function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"}(v||(v={})),function(e){e.Partial="partial",e.Full="full"}(b||(b={})),function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"}(w||(w={})),function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"}(x||(x={})),function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"}(E||(E={}));let uA=(0,k.memo)(({sourceX:e,sourceY:t,targetX:n,targetY:r,sourcePosition:i=E.Bottom,targetPosition:s=E.Top,label:o,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:h,style:d,markerEnd:f,markerStart:p,interactionWidth:g})=>{let[m,_,y]=uD({sourceX:e,sourceY:t,sourcePosition:i,targetX:n,targetY:r,targetPosition:s});return k.createElement(uS,{path:m,labelX:_,labelY:y,label:o,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:h,style:d,markerEnd:f,markerStart:p,interactionWidth:g})});uA.displayName="SimpleBezierEdge";let uR={[E.Left]:{x:-1,y:0},[E.Right]:{x:1,y:0},[E.Top]:{x:0,y:-1},[E.Bottom]:{x:0,y:1}},uP=({source:e,sourcePosition:t=E.Bottom,target:n})=>t===E.Left||t===E.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},uM=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function uO({sourceX:e,sourceY:t,sourcePosition:n=E.Bottom,targetX:r,targetY:i,targetPosition:s=E.Top,borderRadius:o=5,centerX:a,centerY:l,offset:c=20}){let[u,h,d,f,p]=function({source:e,sourcePosition:t=E.Bottom,target:n,targetPosition:r=E.Top,center:i,offset:s}){let o,a;let l=uR[t],c=uR[r],u={x:e.x+l.x*s,y:e.y+l.y*s},h={x:n.x+c.x*s,y:n.y+c.y*s},d=uP({source:u,sourcePosition:t,target:h}),f=0!==d.x?"x":"y",p=d[f],g=[],m={x:0,y:0},_={x:0,y:0},[y,v,b,w]=uN({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(l[f]*c[f]==-1){o=i.x??y,a=i.y??v;let e=[{x:o,y:u.y},{x:o,y:h.y}],t=[{x:u.x,y:a},{x:h.x,y:a}];g=l[f]===p?"x"===f?e:t:"x"===f?t:e}else{let i=[{x:u.x,y:h.y}],d=[{x:h.x,y:u.y}];if(g="x"===f?l.x===p?d:i:l.y===p?i:d,t===r){let t=Math.abs(e[f]-n[f]);if(t<=s){let r=Math.min(s-1,s-t);l[f]===p?m[f]=(u[f]>e[f]?-1:1)*r:_[f]=(h[f]>n[f]?-1:1)*r}}if(t!==r){let e="x"===f?"y":"x",t=l[f]===c[e],n=u[e]>h[e],r=u[e]<h[e];(1===l[f]&&(!t&&n||t&&r)||1!==l[f]&&(!t&&r||t&&n))&&(g="x"===f?i:d)}let y={x:u.x+m.x,y:u.y+m.y},v={x:h.x+_.x,y:h.y+_.y};Math.max(Math.abs(y.x-g[0].x),Math.abs(v.x-g[0].x))>=Math.max(Math.abs(y.y-g[0].y),Math.abs(v.y-g[0].y))?(o=(y.x+v.x)/2,a=g[0].y):(o=g[0].x,a=(y.y+v.y)/2)}return[[e,{x:u.x+m.x,y:u.y+m.y},...g,{x:h.x+_.x,y:h.y+_.y},n],o,a,b,w]}({source:{x:e,y:t},sourcePosition:n,target:{x:r,y:i},targetPosition:s,center:{x:a,y:l},offset:c});return[u.reduce((e,t,n)=>e+(n>0&&n<u.length-1?function(e,t,n,r){let i=Math.min(uM(e,t)/2,uM(t,n)/2,r),{x:s,y:o}=t;if(e.x===s&&s===n.x||e.y===o&&o===n.y)return`L${s} ${o}`;if(e.y===o){let t=e.x<n.x?-1:1,r=e.y<n.y?1:-1;return`L ${s+i*t},${o}Q ${s},${o} ${s},${o+i*r}`}let a=e.x<n.x?1:-1,l=e.y<n.y?-1:1;return`L ${s},${o+i*l}Q ${s},${o} ${s+i*a},${o}`}(u[n-1],t,u[n+1],o):`${0===n?"M":"L"}${t.x} ${t.y}`),""),h,d,f,p]}let uL=(0,k.memo)(({sourceX:e,sourceY:t,targetX:n,targetY:r,label:i,labelStyle:s,labelShowBg:o,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,sourcePosition:h=E.Bottom,targetPosition:d=E.Top,markerEnd:f,markerStart:p,pathOptions:g,interactionWidth:m})=>{let[_,y,v]=uO({sourceX:e,sourceY:t,sourcePosition:h,targetX:n,targetY:r,targetPosition:d,borderRadius:g?.borderRadius,offset:g?.offset});return k.createElement(uS,{path:_,labelX:y,labelY:v,label:i,labelStyle:s,labelShowBg:o,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:f,markerStart:p,interactionWidth:m})});uL.displayName="SmoothStepEdge";let uB=(0,k.memo)(e=>k.createElement(uL,{...e,pathOptions:(0,k.useMemo)(()=>({borderRadius:0,offset:e.pathOptions?.offset}),[e.pathOptions?.offset])}));uB.displayName="StepEdge";let uF=(0,k.memo)(({sourceX:e,sourceY:t,targetX:n,targetY:r,label:i,labelStyle:s,labelShowBg:o,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:h,markerStart:d,interactionWidth:f})=>{let[p,g,m]=function({sourceX:e,sourceY:t,targetX:n,targetY:r}){let[i,s,o,a]=uN({sourceX:e,sourceY:t,targetX:n,targetY:r});return[`M ${e},${t}L ${n},${r}`,i,s,o,a]}({sourceX:e,sourceY:t,targetX:n,targetY:r});return k.createElement(uS,{path:p,labelX:g,labelY:m,label:i,labelStyle:s,labelShowBg:o,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:h,markerStart:d,interactionWidth:f})});function uH(e,t){return e>=0?.5*e:25*t*Math.sqrt(-e)}function uj({pos:e,x1:t,y1:n,x2:r,y2:i,c:s}){switch(e){case E.Left:return[t-uH(t-r,s),n];case E.Right:return[t+uH(r-t,s),n];case E.Top:return[t,n-uH(n-i,s)];case E.Bottom:return[t,n+uH(i-n,s)]}}function uz({sourceX:e,sourceY:t,sourcePosition:n=E.Bottom,targetX:r,targetY:i,targetPosition:s=E.Top,curvature:o=.25}){let[a,l]=uj({pos:n,x1:e,y1:t,x2:r,y2:i,c:o}),[c,u]=uj({pos:s,x1:r,y1:i,x2:e,y2:t,c:o}),[h,d,f,p]=uI({sourceX:e,sourceY:t,targetX:r,targetY:i,sourceControlX:a,sourceControlY:l,targetControlX:c,targetControlY:u});return[`M${e},${t} C${a},${l} ${c},${u} ${r},${i}`,h,d,f,p]}uF.displayName="StraightEdge";let u$=(0,k.memo)(({sourceX:e,sourceY:t,targetX:n,targetY:r,sourcePosition:i=E.Bottom,targetPosition:s=E.Top,label:o,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:h,style:d,markerEnd:f,markerStart:p,pathOptions:g,interactionWidth:m})=>{let[_,y,v]=uz({sourceX:e,sourceY:t,sourcePosition:i,targetX:n,targetY:r,targetPosition:s,curvature:g?.curvature});return k.createElement(uS,{path:_,labelX:y,labelY:v,label:o,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:h,style:d,markerEnd:f,markerStart:p,interactionWidth:m})});u$.displayName="BezierEdge";let uq=(0,k.createContext)(null),uU=uq.Provider;uq.Consumer;let uV=()=>(0,k.useContext)(uq),uW=e=>"id"in e&&"source"in e&&"target"in e,uY=({source:e,sourceHandle:t,target:n,targetHandle:r})=>`reactflow__edge-${e}${t||""}-${n}${r||""}`,uK=(e,t)=>{if(void 0===e)return"";if("string"==typeof e)return e;let n=t?`${t}__`:"";return`${n}${Object.keys(e).sort().map(t=>`${t}=${e[t]}`).join("&")}`},uG=(e,t)=>t.some(t=>t.source===e.source&&t.target===e.target&&(t.sourceHandle===e.sourceHandle||!t.sourceHandle&&!e.sourceHandle)&&(t.targetHandle===e.targetHandle||!t.targetHandle&&!e.targetHandle)),uX=(e,t)=>{let n;return e.source&&e.target?uG(n=uW(e)?{...e}:{...e,id:uY(e)},t)?t:t.concat(n):(uv("006",c6.error006()),t)},uQ=({x:e,y:t},[n,r,i],s,[o,a])=>{let l={x:(e-n)/i,y:(t-r)/i};return s?{x:o*Math.round(l.x/o),y:a*Math.round(l.y/a)}:l},uZ=({x:e,y:t},[n,r,i])=>({x:e*i+n,y:t*i+r}),uJ=(e,t=[0,0])=>{if(!e)return{x:0,y:0,positionAbsolute:{x:0,y:0}};let n=(e.width??0)*t[0],r=(e.height??0)*t[1],i={x:e.position.x-n,y:e.position.y-r};return{...i,positionAbsolute:e.positionAbsolute?{x:e.positionAbsolute.x-n,y:e.positionAbsolute.y-r}:i}},u0=(e,t=[0,0])=>0===e.length?{x:0,y:0,width:0,height:0}:ud(e.reduce((e,n)=>{let{x:r,y:i}=uJ(n,t).positionAbsolute;return uu(e,uh({x:r,y:i,width:n.width||0,height:n.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0})),u1=(e,t,[n,r,i]=[0,0,1],s=!1,o=!1,a=[0,0])=>{let l={x:(t.x-n)/i,y:(t.y-r)/i,width:t.width/i,height:t.height/i},c=[];return e.forEach(e=>{let{width:t,height:n,selectable:r=!0,hidden:i=!1}=e;if(o&&!r||i)return!1;let{positionAbsolute:u}=uJ(e,a),h=up(l,{x:u.x,y:u.y,width:t||0,height:n||0}),d=void 0===t||void 0===n||null===t||null===n,f=(t||0)*(n||0);(d||s&&h>0||h>=f||e.dragging)&&c.push(e)}),c},u2=(e,t)=>{let n=e.map(e=>e.id);return t.filter(e=>n.includes(e.source)||n.includes(e.target))},u3=(e,t,n,r,i,s=.1)=>{let o=us(Math.min(t/(e.width*(1+s)),n/(e.height*(1+s))),r,i);return{x:t/2-(e.x+e.width/2)*o,y:n/2-(e.y+e.height/2)*o,zoom:o}},u5=(e,t=0)=>e.transition().duration(t);function u4(e,t,n,r){return(t[n]||[]).reduce((t,i)=>(`${e.id}-${i.id}-${n}`!==r&&t.push({id:i.id||null,type:n,nodeId:e.id,x:(e.positionAbsolute?.x??0)+i.x+i.width/2,y:(e.positionAbsolute?.y??0)+i.y+i.height/2}),t),[])}let u6={source:null,target:null,sourceHandle:null,targetHandle:null},u8=()=>({handleDomNode:null,isValid:!1,connection:u6,endHandle:null});function u7(e,t,n,r,i,s,o){let a="target"===i,l=o.querySelector(`.react-flow__handle[data-id="${e?.nodeId}-${e?.id}-${e?.type}"]`),c={...u8(),handleDomNode:l};if(l){let e=u9(void 0,l),i=l.getAttribute("data-nodeid"),o=l.getAttribute("data-handleid"),u=l.classList.contains("connectable"),h=l.classList.contains("connectableend"),d={source:a?i:n,sourceHandle:a?o:r,target:a?n:i,targetHandle:a?r:o};c.connection=d,u&&h&&(t===y.Strict?a&&"source"===e||!a&&"target"===e:i!==n||o!==r)&&(c.endHandle={nodeId:i,handleId:o,type:e},c.isValid=s(d))}return c}function u9(e,t){return e||(t?.classList.contains("target")?"target":t?.classList.contains("source")?"source":null)}function he(e){e?.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function ht({event:e,handleId:t,nodeId:n,onConnect:r,isTarget:i,getState:s,setState:o,isValidConnection:a,edgeUpdaterType:l,onReconnectEnd:c}){let u,h;let d=uc(e.target),{connectionMode:f,domNode:p,autoPanOnConnect:g,connectionRadius:m,onConnectStart:_,panBy:y,getNodes:v,cancelConnection:b}=s(),w=0,{x,y:E}=uE(e),C=u9(l,d?.elementFromPoint(x,E)),S=p?.getBoundingClientRect();if(!S||!C)return;let k=uE(e,S),N=!1,I=null,T=!1,D=null,A=function({nodes:e,nodeId:t,handleId:n,handleType:r}){return e.reduce((e,i)=>{if(i[u_]){let{handleBounds:s}=i[u_],o=[],a=[];s&&(o=u4(i,s,"source",`${t}-${n}-${r}`),a=u4(i,s,"target",`${t}-${n}-${r}`)),e.push(...o,...a)}return e},[])}({nodes:v(),nodeId:n,handleId:t,handleType:C}),R=()=>{if(!g)return;let[e,t]=ul(k,S);y({x:e,y:t}),w=requestAnimationFrame(R)};function P(e){var r,l;let c;let{transform:p}=s();k=uE(e,S);let{handle:g,validHandleResult:_}=function(e,t,n,r,i,s){let{x:o,y:a}=uE(e),l=t.elementsFromPoint(o,a).find(e=>e.classList.contains("react-flow__handle"));if(l){let e=l.getAttribute("data-nodeid");if(e){let t=u9(void 0,l),r=l.getAttribute("data-handleid"),o=s({nodeId:e,id:r,type:t});if(o){let s=i.find(n=>n.nodeId===e&&n.type===t&&n.id===r);return{handle:{id:r,type:t,nodeId:e,x:s?.x||n.x,y:s?.y||n.y},validHandleResult:o}}}}let c=[],u=1/0;if(i.forEach(e=>{let t=Math.sqrt((e.x-n.x)**2+(e.y-n.y)**2);if(t<=r){let n=s(e);t<=u&&(t<u?c=[{handle:e,validHandleResult:n}]:t===u&&c.push({handle:e,validHandleResult:n}),u=t)}}),!c.length)return{handle:null,validHandleResult:u8()};if(1===c.length)return c[0];let h=c.some(({validHandleResult:e})=>e.isValid),d=c.some(({handle:e})=>"target"===e.type);return c.find(({handle:e,validHandleResult:t})=>d?"target"===e.type:!h||t.isValid)||c[0]}(e,d,uQ(k,p,!1,[1,1]),m,A,e=>u7(e,f,n,t,i?"target":"source",a,d));if(u=g,N||(R(),N=!0),D=_.handleDomNode,I=_.connection,T=_.isValid,o({connectionPosition:u&&T?uZ({x:u.x,y:u.y},p):k,connectionStatus:(r=!!u,c=null,(l=T)?c="valid":r&&!l&&(c="invalid"),c),connectionEndHandle:_.endHandle}),!u&&!T&&!D)return he(h);I.source!==I.target&&D&&(he(h),h=D,D.classList.add("connecting","react-flow__handle-connecting"),D.classList.toggle("valid",T),D.classList.toggle("react-flow__handle-valid",T))}function M(e){(u||D)&&I&&T&&r?.(I),s().onConnectEnd?.(e),l&&c?.(e),he(h),b(),cancelAnimationFrame(w),N=!1,T=!1,I=null,D=null,d.removeEventListener("mousemove",P),d.removeEventListener("mouseup",M),d.removeEventListener("touchmove",P),d.removeEventListener("touchend",M)}o({connectionPosition:k,connectionStatus:null,connectionNodeId:n,connectionHandleId:t,connectionHandleType:C,connectionStartHandle:{nodeId:n,handleId:t,type:C},connectionEndHandle:null}),_?.(e,{nodeId:n,handleId:t,handleType:C}),d.addEventListener("mousemove",P),d.addEventListener("mouseup",M),d.addEventListener("touchmove",P),d.addEventListener("touchend",M)}let hn=()=>!0,hr=e=>({connectionStartHandle:e.connectionStartHandle,connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName}),hi=(e,t,n)=>r=>{let{connectionStartHandle:i,connectionEndHandle:s,connectionClickStartHandle:o}=r;return{connecting:i?.nodeId===e&&i?.handleId===t&&i?.type===n||s?.nodeId===e&&s?.handleId===t&&s?.type===n,clickConnecting:o?.nodeId===e&&o?.handleId===t&&o?.type===n}},hs=(0,k.forwardRef)(({type:e="source",position:t=E.Top,isValidConnection:n,isConnectable:r=!0,isConnectableStart:i=!0,isConnectableEnd:s=!0,id:o,onConnect:a,children:l,className:c,onMouseDown:u,onTouchStart:h,...d},f)=>{let p=o||null,g="target"===e,m=c9(),_=uV(),{connectOnClick:y,noPanClassName:v}=c7(hr,av),{connecting:b,clickConnecting:w}=c7(hi(_,p,e),av);_||m.getState().onError?.("010",c6.error010());let x=e=>{let{defaultEdgeOptions:t,onConnect:n,hasDefaultEdges:r}=m.getState(),i={...t,...e};if(r){let{edges:e,setEdges:t}=m.getState();t(uX(i,e))}n?.(i),a?.(i)},C=e=>{if(!_)return;let t=ux(e);i&&(t&&0===e.button||!t)&&ht({event:e,handleId:p,nodeId:_,onConnect:x,isTarget:g,getState:m.getState,setState:m.setState,isValidConnection:n||m.getState().isValidConnection||hn}),t?u?.(e):h?.(e)};return k.createElement("div",{"data-handleid":p,"data-nodeid":_,"data-handlepos":t,"data-id":`${_}-${p}-${e}`,className:ac(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",v,c,{source:!g,target:g,connectable:r,connectablestart:i,connectableend:s,connecting:w,connectionindicator:r&&(i&&!b||s&&b)}]),onMouseDown:C,onTouchStart:C,onClick:y?t=>{let{onClickConnectStart:r,onClickConnectEnd:s,connectionClickStartHandle:o,connectionMode:a,isValidConnection:l}=m.getState();if(!_||!o&&!i)return;if(!o){r?.(t,{nodeId:_,handleId:p,handleType:e}),m.setState({connectionClickStartHandle:{nodeId:_,type:e,handleId:p}});return}let c=uc(t.target),u=n||l||hn,{connection:h,isValid:d}=u7({nodeId:_,id:p,type:e},a,o.nodeId,o.handleId||null,o.type,u,c);d&&x(h),s?.(t),m.setState({connectionClickStartHandle:null})}:void 0,ref:f,...d},l)});hs.displayName="Handle";var ho=(0,k.memo)(hs);let ha=({data:e,isConnectable:t,targetPosition:n=E.Top,sourcePosition:r=E.Bottom})=>k.createElement(k.Fragment,null,k.createElement(ho,{type:"target",position:n,isConnectable:t}),e?.label,k.createElement(ho,{type:"source",position:r,isConnectable:t}));ha.displayName="DefaultNode";var hl=(0,k.memo)(ha);let hc=({data:e,isConnectable:t,sourcePosition:n=E.Bottom})=>k.createElement(k.Fragment,null,e?.label,k.createElement(ho,{type:"source",position:n,isConnectable:t}));hc.displayName="InputNode";var hu=(0,k.memo)(hc);let hh=({data:e,isConnectable:t,targetPosition:n=E.Top})=>k.createElement(k.Fragment,null,k.createElement(ho,{type:"target",position:n,isConnectable:t}),e?.label);hh.displayName="OutputNode";var hd=(0,k.memo)(hh);let hf=()=>null;hf.displayName="GroupNode";let hp=e=>({selectedNodes:e.getNodes().filter(e=>e.selected),selectedEdges:e.edges.filter(e=>e.selected).map(e=>({...e}))}),hg=e=>e.id;function hm(e,t){return av(e.selectedNodes.map(hg),t.selectedNodes.map(hg))&&av(e.selectedEdges.map(hg),t.selectedEdges.map(hg))}let h_=(0,k.memo)(({onSelectionChange:e})=>{let t=c9(),{selectedNodes:n,selectedEdges:r}=c7(hp,hm);return(0,k.useEffect)(()=>{let i={nodes:n,edges:r};e?.(i),t.getState().onSelectionChange.forEach(e=>e(i))},[n,r,e]),null});h_.displayName="SelectionListener";let hy=e=>!!e.onSelectionChange;function hv({onSelectionChange:e}){let t=c7(hy);return e||t?k.createElement(h_,{onSelectionChange:e}):null}let hb=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset});function hw(e,t){(0,k.useEffect)(()=>{void 0!==e&&t(e)},[e])}function hx(e,t,n){(0,k.useEffect)(()=>{void 0!==t&&n({[e]:t})},[t])}let hE=({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,onConnect:i,onConnectStart:s,onConnectEnd:o,onClickConnectStart:a,onClickConnectEnd:l,nodesDraggable:c,nodesConnectable:u,nodesFocusable:h,edgesFocusable:d,edgesUpdatable:f,elevateNodesOnSelect:p,minZoom:g,maxZoom:m,nodeExtent:_,onNodesChange:y,onEdgesChange:v,elementsSelectable:b,connectionMode:w,snapGrid:x,snapToGrid:E,translateExtent:C,connectOnClick:S,defaultEdgeOptions:N,fitView:I,fitViewOptions:T,onNodesDelete:D,onEdgesDelete:A,onNodeDrag:R,onNodeDragStart:P,onNodeDragStop:M,onSelectionDrag:O,onSelectionDragStart:L,onSelectionDragStop:B,noPanClassName:F,nodeOrigin:H,rfId:j,autoPanOnConnect:z,autoPanOnNodeDrag:$,onError:q,connectionRadius:U,isValidConnection:V,nodeDragThreshold:W})=>{let{setNodes:Y,setEdges:K,setDefaultNodesAndEdges:G,setMinZoom:X,setMaxZoom:Q,setTranslateExtent:Z,setNodeExtent:J,reset:ee}=c7(hb,av),et=c9();return(0,k.useEffect)(()=>(G(n,r?.map(e=>({...e,...N}))),()=>{ee()}),[]),hx("defaultEdgeOptions",N,et.setState),hx("connectionMode",w,et.setState),hx("onConnect",i,et.setState),hx("onConnectStart",s,et.setState),hx("onConnectEnd",o,et.setState),hx("onClickConnectStart",a,et.setState),hx("onClickConnectEnd",l,et.setState),hx("nodesDraggable",c,et.setState),hx("nodesConnectable",u,et.setState),hx("nodesFocusable",h,et.setState),hx("edgesFocusable",d,et.setState),hx("edgesUpdatable",f,et.setState),hx("elementsSelectable",b,et.setState),hx("elevateNodesOnSelect",p,et.setState),hx("snapToGrid",E,et.setState),hx("snapGrid",x,et.setState),hx("onNodesChange",y,et.setState),hx("onEdgesChange",v,et.setState),hx("connectOnClick",S,et.setState),hx("fitViewOnInit",I,et.setState),hx("fitViewOnInitOptions",T,et.setState),hx("onNodesDelete",D,et.setState),hx("onEdgesDelete",A,et.setState),hx("onNodeDrag",R,et.setState),hx("onNodeDragStart",P,et.setState),hx("onNodeDragStop",M,et.setState),hx("onSelectionDrag",O,et.setState),hx("onSelectionDragStart",L,et.setState),hx("onSelectionDragStop",B,et.setState),hx("noPanClassName",F,et.setState),hx("nodeOrigin",H,et.setState),hx("rfId",j,et.setState),hx("autoPanOnConnect",z,et.setState),hx("autoPanOnNodeDrag",$,et.setState),hx("onError",q,et.setState),hx("connectionRadius",U,et.setState),hx("isValidConnection",V,et.setState),hx("nodeDragThreshold",W,et.setState),hw(e,Y),hw(t,K),hw(g,X),hw(m,Q),hw(C,Z),hw(_,J),null},hC={display:"none"},hS={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},hk="react-flow__node-desc",hN="react-flow__edge-desc",hI=e=>e.ariaLiveMessage;function hT({rfId:e}){let t=c7(hI);return k.createElement("div",{id:`react-flow__aria-live-${e}`,"aria-live":"assertive","aria-atomic":"true",style:hS},t)}function hD({rfId:e,disableKeyboardA11y:t}){return k.createElement(k.Fragment,null,k.createElement("div",{id:`${hk}-${e}`,style:hC},"Press enter or space to select a node.",!t&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),k.createElement("div",{id:`${hN}-${e}`,style:hC},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!t&&k.createElement(hT,{rfId:e}))}var hA=(e=null,t={actInsideInputWithModifier:!0})=>{let[n,r]=(0,k.useState)(!1),i=(0,k.useRef)(!1),s=(0,k.useRef)(new Set([])),[o,a]=(0,k.useMemo)(()=>{if(null!==e){let t=(Array.isArray(e)?e:[e]).filter(e=>"string"==typeof e).map(e=>e.split("+")),n=t.reduce((e,t)=>e.concat(...t),[]);return[t,n]}return[[],[]]},[e]);return(0,k.useEffect)(()=>{let n="undefined"!=typeof document?document:null,l=t?.target||n;if(null!==e){let e=e=>{if(i.current=e.ctrlKey||e.metaKey||e.shiftKey,(!i.current||i.current&&!t.actInsideInputWithModifier)&&uw(e))return!1;let n=hP(e.code,a);s.current.add(e[n]),hR(o,s.current,!1)&&(e.preventDefault(),r(!0))},n=e=>{if((!i.current||i.current&&!t.actInsideInputWithModifier)&&uw(e))return!1;let n=hP(e.code,a);hR(o,s.current,!0)?(r(!1),s.current.clear()):s.current.delete(e[n]),"Meta"===e.key&&s.current.clear(),i.current=!1},c=()=>{s.current.clear(),r(!1)};return l?.addEventListener("keydown",e),l?.addEventListener("keyup",n),window.addEventListener("blur",c),()=>{l?.removeEventListener("keydown",e),l?.removeEventListener("keyup",n),window.removeEventListener("blur",c)}}},[e,r]),n};function hR(e,t,n){return e.filter(e=>n||e.length===t.size).some(e=>e.every(e=>t.has(e)))}function hP(e,t){return t.includes(e)?"code":"key"}function hM(e,t,n){e.forEach(r=>{let i=r.parentNode||r.parentId;if(i&&!e.has(i))throw Error(`Parent node ${i} not found`);if(i||n?.[r.id]){let{x:i,y:s,z:o}=function e(t,n,r,i){let s=t.parentNode||t.parentId;if(!s)return r;let o=n.get(s),a=uJ(o,i);return e(o,n,{x:(r.x??0)+a.x,y:(r.y??0)+a.y,z:(o[u_]?.z??0)>(r.z??0)?o[u_]?.z??0:r.z??0},i)}(r,e,{...r.position,z:r[u_]?.z??0},t);r.positionAbsolute={x:i,y:s},r[u_].z=o,n?.[r.id]&&(r[u_].isParent=!0)}})}function hO(e,t,n,r){let i=new Map,s={},o=r?1e3:0;return e.forEach(e=>{let n=(um(e.zIndex)?e.zIndex:0)+(e.selected?o:0),r=t.get(e.id),a={...e,positionAbsolute:{x:e.position.x,y:e.position.y}},l=e.parentNode||e.parentId;l&&(s[l]=!0),Object.defineProperty(a,u_,{enumerable:!1,value:{handleBounds:r?.type&&r?.type!==e.type?void 0:r?.[u_]?.handleBounds,z:n}}),i.set(e.id,a)}),hM(i,n,s),i}function hL(e,t={}){let{getNodes:n,width:r,height:i,minZoom:s,maxZoom:o,d3Zoom:a,d3Selection:l,fitViewOnInitDone:c,fitViewOnInit:u,nodeOrigin:h}=e(),d=t.initial&&!c&&u;if(a&&l&&(d||!t.initial)){let e=n().filter(e=>{let n=t.includeHiddenNodes?e.width&&e.height:!e.hidden;return t.nodes?.length?n&&t.nodes.some(t=>t.id===e.id):n}),c=e.every(e=>e.width&&e.height);if(e.length>0&&c){let{x:n,y:c,zoom:u}=u3(u0(e,h),r,i,t.minZoom??s,t.maxZoom??o,t.padding??.1),d=cq.translate(n,c).scale(u);return"number"==typeof t.duration&&t.duration>0?a.transform(u5(l,t.duration),d):a.transform(l,d),!0}}return!1}function hB({changedNodes:e,changedEdges:t,get:n,set:r}){let{nodeInternals:i,edges:s,onNodesChange:o,onEdgesChange:a,hasDefaultNodes:l,hasDefaultEdges:c}=n();e?.length&&(l&&r({nodeInternals:(e.forEach(e=>{let t=i.get(e.id);t&&i.set(t.id,{...t,[u_]:t[u_],selected:e.selected})}),new Map(i))}),o?.(e)),t?.length&&(c&&r({edges:s.map(e=>{let n=t.find(t=>t.id===e.id);return n&&(e.selected=n.selected),e})}),a?.(t))}let hF=()=>{},hH={zoomIn:hF,zoomOut:hF,zoomTo:hF,getZoom:()=>1,setViewport:hF,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:hF,fitBounds:hF,project:e=>e,screenToFlowPosition:e=>e,flowToScreenPosition:e=>e,viewportInitialized:!1},hj=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection}),hz=()=>{let e=c9(),{d3Zoom:t,d3Selection:n}=c7(hj,av);return(0,k.useMemo)(()=>n&&t?{zoomIn:e=>t.scaleBy(u5(n,e?.duration),1.2),zoomOut:e=>t.scaleBy(u5(n,e?.duration),1/1.2),zoomTo:(e,r)=>t.scaleTo(u5(n,r?.duration),e),getZoom:()=>e.getState().transform[2],setViewport:(r,i)=>{let[s,o,a]=e.getState().transform,l=cq.translate(r.x??s,r.y??o).scale(r.zoom??a);t.transform(u5(n,i?.duration),l)},getViewport:()=>{let[t,n,r]=e.getState().transform;return{x:t,y:n,zoom:r}},fitView:t=>hL(e.getState,t),setCenter:(r,i,s)=>{let{width:o,height:a,maxZoom:l}=e.getState(),c=void 0!==s?.zoom?s.zoom:l,u=o/2-r*c,h=a/2-i*c,d=cq.translate(u,h).scale(c);t.transform(u5(n,s?.duration),d)},fitBounds:(r,i)=>{let{width:s,height:o,minZoom:a,maxZoom:l}=e.getState(),{x:c,y:u,zoom:h}=u3(r,s,o,a,l,i?.padding??.1),d=cq.translate(c,u).scale(h);t.transform(u5(n,i?.duration),d)},project:t=>{let{transform:n,snapToGrid:r,snapGrid:i}=e.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),uQ(t,n,r,i)},screenToFlowPosition:t=>{let{transform:n,snapToGrid:r,snapGrid:i,domNode:s}=e.getState();if(!s)return t;let{x:o,y:a}=s.getBoundingClientRect();return uQ({x:t.x-o,y:t.y-a},n,r,i)},flowToScreenPosition:t=>{let{transform:n,domNode:r}=e.getState();if(!r)return t;let{x:i,y:s}=r.getBoundingClientRect(),o=uZ(t,n);return{x:o.x+i,y:o.y+s}},viewportInitialized:!0}:hH,[t,n])};function h$(){let e=hz(),t=c9(),n=(0,k.useCallback)(()=>t.getState().getNodes().map(e=>({...e})),[]),r=(0,k.useCallback)(e=>t.getState().nodeInternals.get(e),[]),i=(0,k.useCallback)(()=>{let{edges:e=[]}=t.getState();return e.map(e=>({...e}))},[]),s=(0,k.useCallback)(e=>{let{edges:n=[]}=t.getState();return n.find(t=>t.id===e)},[]),o=(0,k.useCallback)(e=>{let{getNodes:n,setNodes:r,hasDefaultNodes:i,onNodesChange:s}=t.getState(),o=n(),a="function"==typeof e?e(o):e;i?r(a):s&&s(0===a.length?o.map(e=>({type:"remove",id:e.id})):a.map(e=>({item:e,type:"reset"})))},[]),a=(0,k.useCallback)(e=>{let{edges:n=[],setEdges:r,hasDefaultEdges:i,onEdgesChange:s}=t.getState(),o="function"==typeof e?e(n):e;i?r(o):s&&s(0===o.length?n.map(e=>({type:"remove",id:e.id})):o.map(e=>({item:e,type:"reset"})))},[]),l=(0,k.useCallback)(e=>{let n=Array.isArray(e)?e:[e],{getNodes:r,setNodes:i,hasDefaultNodes:s,onNodesChange:o}=t.getState();s?i([...r(),...n]):o&&o(n.map(e=>({item:e,type:"add"})))},[]),c=(0,k.useCallback)(e=>{let n=Array.isArray(e)?e:[e],{edges:r=[],setEdges:i,hasDefaultEdges:s,onEdgesChange:o}=t.getState();s?i([...r,...n]):o&&o(n.map(e=>({item:e,type:"add"})))},[]),u=(0,k.useCallback)(()=>{let{getNodes:e,edges:n=[],transform:r}=t.getState(),[i,s,o]=r;return{nodes:e().map(e=>({...e})),edges:n.map(e=>({...e})),viewport:{x:i,y:s,zoom:o}}},[]),h=(0,k.useCallback)(({nodes:e,edges:n})=>{let{nodeInternals:r,getNodes:i,edges:s,hasDefaultNodes:o,hasDefaultEdges:a,onNodesDelete:l,onEdgesDelete:c,onNodesChange:u,onEdgesChange:h}=t.getState(),d=(e||[]).map(e=>e.id),f=(n||[]).map(e=>e.id),p=i().reduce((e,t)=>{let n=t.parentNode||t.parentId,r=!d.includes(t.id)&&n&&e.find(e=>e.id===n);return("boolean"!=typeof t.deletable||t.deletable)&&(d.includes(t.id)||r)&&e.push(t),e},[]),g=s.filter(e=>"boolean"!=typeof e.deletable||e.deletable),m=g.filter(e=>f.includes(e.id));if(p||m){let e=[...m,...u2(p,g)],n=e.reduce((e,t)=>(e.includes(t.id)||e.push(t.id),e),[]);(a||o)&&(a&&t.setState({edges:s.filter(e=>!n.includes(e.id))}),o&&(p.forEach(e=>{r.delete(e.id)}),t.setState({nodeInternals:new Map(r)}))),n.length>0&&(c?.(e),h&&h(n.map(e=>({id:e,type:"remove"})))),p.length>0&&(l?.(p),u&&u(p.map(e=>({id:e.id,type:"remove"}))))}},[]),d=(0,k.useCallback)(e=>{let n=ug(e),r=n?null:t.getState().nodeInternals.get(e.id);return n||r?[n?e:uf(r),r,n]:[null,null,n]},[]),f=(0,k.useCallback)((e,n=!0,r)=>{let[i,s,o]=d(e);return i?(r||t.getState().getNodes()).filter(e=>{if(!o&&(e.id===s.id||!e.positionAbsolute))return!1;let t=up(uf(e),i);return n&&t>0||t>=i.width*i.height}):[]},[]),p=(0,k.useCallback)((e,t,n=!0)=>{let[r]=d(e);if(!r)return!1;let i=up(r,t);return n&&i>0||i>=r.width*r.height},[]);return(0,k.useMemo)(()=>({...e,getNodes:n,getNode:r,getEdges:i,getEdge:s,setNodes:o,setEdges:a,addNodes:l,addEdges:c,toObject:u,deleteElements:h,getIntersectingNodes:f,isNodeIntersecting:p}),[e,n,r,i,s,o,a,l,c,u,h,f,p])}let hq={actInsideInputWithModifier:!1};var hU=({deleteKeyCode:e,multiSelectionKeyCode:t})=>{let n=c9(),{deleteElements:r}=h$(),i=hA(e,hq),s=hA(t);(0,k.useEffect)(()=>{if(i){let{edges:e,getNodes:t}=n.getState();r({nodes:t().filter(e=>e.selected),edges:e.filter(e=>e.selected)}),n.setState({nodesSelectionActive:!1})}},[i]),(0,k.useEffect)(()=>{n.setState({multiSelectionActive:s})},[s])};let hV={position:"absolute",width:"100%",height:"100%",top:0,left:0},hW=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,hY=e=>({x:e.x,y:e.y,zoom:e.k}),hK=(e,t)=>e.target.closest(`.${t}`),hG=(e,t)=>2===t&&Array.isArray(e)&&e.includes(2),hX=e=>{let t=e.ctrlKey&&uC()?10:1;return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*t},hQ=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection,d3ZoomHandler:e.d3ZoomHandler,userSelectionActive:e.userSelectionActive}),hZ=({onMove:e,onMoveStart:t,onMoveEnd:n,onPaneContextMenu:r,zoomOnScroll:i=!0,zoomOnPinch:s=!0,panOnScroll:o=!1,panOnScrollSpeed:a=.5,panOnScrollMode:l=v.Free,zoomOnDoubleClick:c=!0,elementsSelectable:u,panOnDrag:h=!0,defaultViewport:d,translateExtent:f,minZoom:p,maxZoom:g,zoomActivationKeyCode:m,preventScrolling:_=!0,children:y,noWheelClassName:b,noPanClassName:w})=>{let x=(0,k.useRef)(),E=c9(),C=(0,k.useRef)(!1),S=(0,k.useRef)(!1),N=(0,k.useRef)(null),I=(0,k.useRef)({x:0,y:0,zoom:0}),{d3Zoom:T,d3Selection:D,d3ZoomHandler:A,userSelectionActive:R}=c7(hQ,av),P=hA(m),M=(0,k.useRef)(0),O=(0,k.useRef)(!1),L=(0,k.useRef)();return function(e){let t=c9();(0,k.useEffect)(()=>{let n;let r=()=>{if(!e.current)return;let n=ui(e.current);(0===n.height||0===n.width)&&t.getState().onError?.("004",c6.error004()),t.setState({width:n.width||500,height:n.height||500})};return r(),window.addEventListener("resize",r),e.current&&(n=new ResizeObserver(()=>r())).observe(e.current),()=>{window.removeEventListener("resize",r),n&&e.current&&n.unobserve(e.current)}},[])}(N),(0,k.useEffect)(()=>{if(N.current){let e=N.current.getBoundingClientRect(),t=(function(){var e,t,n,r=cW,i=cY,s=cQ,o=cG,a=cX,l=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],u=250,h=lc,d=aw("start","zoom","end"),f=0,p=10;function g(e){e.property("__zoom",cK).on("wheel.zoom",x,{passive:!1}).on("mousedown.zoom",E).on("dblclick.zoom",C).filter(a).on("touchstart.zoom",S).on("touchmove.zoom",k).on("touchend.zoom touchcancel.zoom",N).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(e,t){return(t=Math.max(l[0],Math.min(l[1],t)))===e.k?e:new c$(t,e.x,e.y)}function _(e,t,n){var r=t[0]-n[0]*e.k,i=t[1]-n[1]*e.k;return r===e.x&&i===e.y?e:new c$(e.k,r,i)}function y(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function v(e,t,n,r){e.on("start.zoom",function(){b(this,arguments).event(r).start()}).on("interrupt.zoom end.zoom",function(){b(this,arguments).event(r).end()}).tween("zoom",function(){var e=arguments,s=b(this,e).event(r),o=i.apply(this,e),a=null==n?y(o):"function"==typeof n?n.apply(this,e):n,l=Math.max(o[1][0]-o[0][0],o[1][1]-o[0][1]),c=this.__zoom,u="function"==typeof t?t.apply(this,e):t,d=h(c.invert(a).concat(l/c.k),u.invert(a).concat(l/u.k));return function(e){if(1===e)e=u;else{var t=d(e),n=l/t[2];e=new c$(n,a[0]-t[0]*n,a[1]-t[1]*n)}s.zoom(null,e)}})}function b(e,t,n){return!n&&e.__zooming||new w(e,t)}function w(e,t){this.that=e,this.args=t,this.active=0,this.sourceEvent=null,this.extent=i.apply(e,t),this.taps=0}function x(e,...t){if(r.apply(this,arguments)){var n=b(this,t).event(e),i=this.__zoom,a=Math.max(l[0],Math.min(l[1],i.k*Math.pow(2,o.apply(this,arguments)))),u=lu(e);if(n.wheel)(n.mouse[0][0]!==u[0]||n.mouse[0][1]!==u[1])&&(n.mouse[1]=i.invert(n.mouse[0]=u)),clearTimeout(n.wheel);else{if(i.k===a)return;n.mouse=[u,i.invert(u)],lG(this),n.start()}cV(e),n.wheel=setTimeout(function(){n.wheel=null,n.end()},150),n.zoom("mouse",s(_(m(i,a),n.mouse[0],n.mouse[1]),n.extent,c))}}function E(e,...t){if(!n&&r.apply(this,arguments)){var i=e.currentTarget,o=b(this,t,!0).event(e),a=lt(e.view).on("mousemove.zoom",function(e){if(cV(e),!o.moved){var t=e.clientX-u,n=e.clientY-h;o.moved=t*t+n*n>f}o.event(e).zoom("mouse",s(_(o.that.__zoom,o.mouse[0]=lu(e,i),o.mouse[1]),o.extent,c))},!0).on("mouseup.zoom",function(e){a.on("mousemove.zoom mouseup.zoom",null),la(e.view,o.moved),cV(e),o.event(e).end()},!0),l=lu(e,i),u=e.clientX,h=e.clientY;lo(e.view),cU(e),o.mouse=[l,this.__zoom.invert(l)],lG(this),o.start()}}function C(e,...t){if(r.apply(this,arguments)){var n=this.__zoom,o=lu(e.changedTouches?e.changedTouches[0]:e,this),a=n.invert(o),l=n.k*(e.shiftKey?.5:2),h=s(_(m(n,l),o,a),i.apply(this,t),c);cV(e),u>0?lt(this).transition().duration(u).call(v,h,o,e):lt(this).call(g.transform,h,o,e)}}function S(n,...i){if(r.apply(this,arguments)){var s,o,a,l,c=n.touches,u=c.length,h=b(this,i,n.changedTouches.length===u).event(n);for(cU(n),o=0;o<u;++o)l=[l=lu(a=c[o],this),this.__zoom.invert(l),a.identifier],h.touch0?h.touch1||h.touch0[2]===l[2]||(h.touch1=l,h.taps=0):(h.touch0=l,s=!0,h.taps=1+!!e);e&&(e=clearTimeout(e)),s&&(h.taps<2&&(t=l[0],e=setTimeout(function(){e=null},500)),lG(this),h.start())}}function k(e,...t){if(this.__zooming){var n,r,i,o,a=b(this,t).event(e),l=e.changedTouches,u=l.length;for(cV(e),n=0;n<u;++n)i=lu(r=l[n],this),a.touch0&&a.touch0[2]===r.identifier?a.touch0[0]=i:a.touch1&&a.touch1[2]===r.identifier&&(a.touch1[0]=i);if(r=a.that.__zoom,a.touch1){var h=a.touch0[0],d=a.touch0[1],f=a.touch1[0],p=a.touch1[1],g=(g=f[0]-h[0])*g+(g=f[1]-h[1])*g,y=(y=p[0]-d[0])*y+(y=p[1]-d[1])*y;r=m(r,Math.sqrt(g/y)),i=[(h[0]+f[0])/2,(h[1]+f[1])/2],o=[(d[0]+p[0])/2,(d[1]+p[1])/2]}else{if(!a.touch0)return;i=a.touch0[0],o=a.touch0[1]}a.zoom("touch",s(_(r,i,o),a.extent,c))}}function N(e,...r){if(this.__zooming){var i,s,o=b(this,r).event(e),a=e.changedTouches,l=a.length;for(cU(e),n&&clearTimeout(n),n=setTimeout(function(){n=null},500),i=0;i<l;++i)s=a[i],o.touch0&&o.touch0[2]===s.identifier?delete o.touch0:o.touch1&&o.touch1[2]===s.identifier&&delete o.touch1;if(o.touch1&&!o.touch0&&(o.touch0=o.touch1,delete o.touch1),o.touch0)o.touch0[1]=this.__zoom.invert(o.touch0[0]);else if(o.end(),2===o.taps&&(s=lu(s,this),Math.hypot(t[0]-s[0],t[1]-s[1])<p)){var c=lt(this).on("dblclick.zoom");c&&c.apply(this,arguments)}}}return g.transform=function(e,t,n,r){var i=e.selection?e.selection():e;i.property("__zoom",cK),e!==i?v(e,t,n,r):i.interrupt().each(function(){b(this,arguments).event(r).start().zoom(null,"function"==typeof t?t.apply(this,arguments):t).end()})},g.scaleBy=function(e,t,n,r){g.scaleTo(e,function(){var e=this.__zoom.k,n="function"==typeof t?t.apply(this,arguments):t;return e*n},n,r)},g.scaleTo=function(e,t,n,r){g.transform(e,function(){var e=i.apply(this,arguments),r=this.__zoom,o=null==n?y(e):"function"==typeof n?n.apply(this,arguments):n,a=r.invert(o),l="function"==typeof t?t.apply(this,arguments):t;return s(_(m(r,l),o,a),e,c)},n,r)},g.translateBy=function(e,t,n,r){g.transform(e,function(){return s(this.__zoom.translate("function"==typeof t?t.apply(this,arguments):t,"function"==typeof n?n.apply(this,arguments):n),i.apply(this,arguments),c)},null,r)},g.translateTo=function(e,t,n,r,o){g.transform(e,function(){var e=i.apply(this,arguments),o=this.__zoom,a=null==r?y(e):"function"==typeof r?r.apply(this,arguments):r;return s(cq.translate(a[0],a[1]).scale(o.k).translate("function"==typeof t?-t.apply(this,arguments):-t,"function"==typeof n?-n.apply(this,arguments):-n),e,c)},r,o)},w.prototype={event:function(e){return e&&(this.sourceEvent=e),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){var t=lt(this.that).datum();d.call(e,this.that,new cz(e,{sourceEvent:this.sourceEvent,target:g,type:e,transform:this.that.__zoom,dispatch:d}),t)}},g.wheelDelta=function(e){return arguments.length?(o="function"==typeof e?e:cj(+e),g):o},g.filter=function(e){return arguments.length?(r="function"==typeof e?e:cj(!!e),g):r},g.touchable=function(e){return arguments.length?(a="function"==typeof e?e:cj(!!e),g):a},g.extent=function(e){return arguments.length?(i="function"==typeof e?e:cj([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),g):i},g.scaleExtent=function(e){return arguments.length?(l[0]=+e[0],l[1]=+e[1],g):[l[0],l[1]]},g.translateExtent=function(e){return arguments.length?(c[0][0]=+e[0][0],c[1][0]=+e[1][0],c[0][1]=+e[0][1],c[1][1]=+e[1][1],g):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},g.constrain=function(e){return arguments.length?(s=e,g):s},g.duration=function(e){return arguments.length?(u=+e,g):u},g.interpolate=function(e){return arguments.length?(h=e,g):h},g.on=function(){var e=d.on.apply(d,arguments);return e===d?g:e},g.clickDistance=function(e){return arguments.length?(f=(e=+e)*e,g):Math.sqrt(f)},g.tapDistance=function(e){return arguments.length?(p=+e,g):p},g})().scaleExtent([p,g]).translateExtent(f),n=lt(N.current).call(t),r=cq.translate(d.x,d.y).scale(us(d.zoom,p,g)),i=[[0,0],[e.width,e.height]],s=t.constrain()(r,i,f);t.transform(n,s),t.wheelDelta(hX),E.setState({d3Zoom:t,d3Selection:n,d3ZoomHandler:n.on("wheel.zoom"),transform:[s.x,s.y,s.k],domNode:N.current.closest(".react-flow")})}},[]),(0,k.useEffect)(()=>{D&&T&&(!o||P||R?void 0!==A&&D.on("wheel.zoom",function(e,t){if(!_&&"wheel"===e.type&&!e.ctrlKey||hK(e,b))return null;e.preventDefault(),A.call(this,e,t)},{passive:!1}):D.on("wheel.zoom",r=>{if(hK(r,b))return!1;r.preventDefault(),r.stopImmediatePropagation();let i=D.property("__zoom").k||1;if(r.ctrlKey&&s){let e=lu(r),t=hX(r);T.scaleTo(D,i*Math.pow(2,t),e,r);return}let o=1===r.deltaMode?20:1,c=l===v.Vertical?0:r.deltaX*o,u=l===v.Horizontal?0:r.deltaY*o;!uC()&&r.shiftKey&&l!==v.Vertical&&(c=r.deltaY*o,u=0),T.translateBy(D,-(c/i)*a,-(u/i)*a,{internal:!0});let h=hY(D.property("__zoom")),{onViewportChangeStart:d,onViewportChange:f,onViewportChangeEnd:p}=E.getState();clearTimeout(L.current),O.current||(O.current=!0,t?.(r,h),d?.(h)),O.current&&(e?.(r,h),f?.(h),L.current=setTimeout(()=>{n?.(r,h),p?.(h),O.current=!1},150))},{passive:!1}))},[R,o,l,D,T,A,P,s,_,b,t,e,n]),(0,k.useEffect)(()=>{T&&T.on("start",e=>{if(!e.sourceEvent||e.sourceEvent.internal)return null;M.current=e.sourceEvent?.button;let{onViewportChangeStart:n}=E.getState(),r=hY(e.transform);C.current=!0,I.current=r,e.sourceEvent?.type==="mousedown"&&E.setState({paneDragging:!0}),n?.(r),t?.(e.sourceEvent,r)})},[T,t]),(0,k.useEffect)(()=>{T&&(R&&!C.current?T.on("zoom",null):R||T.on("zoom",t=>{let{onViewportChange:n}=E.getState();if(E.setState({transform:[t.transform.x,t.transform.y,t.transform.k]}),S.current=!!(r&&hG(h,M.current??0)),(e||n)&&!t.sourceEvent?.internal){let r=hY(t.transform);n?.(r),e?.(t.sourceEvent,r)}}))},[R,T,e,h,r]),(0,k.useEffect)(()=>{T&&T.on("end",e=>{if(!e.sourceEvent||e.sourceEvent.internal)return null;let{onViewportChangeEnd:t}=E.getState();if(C.current=!1,E.setState({paneDragging:!1}),r&&hG(h,M.current??0)&&!S.current&&r(e.sourceEvent),S.current=!1,(n||t)&&hW(I.current,e.transform)){let r=hY(e.transform);I.current=r,clearTimeout(x.current),x.current=setTimeout(()=>{t?.(r),n?.(e.sourceEvent,r)},o?150:0)}})},[T,o,h,n,r]),(0,k.useEffect)(()=>{T&&T.filter(e=>{let t=P||i,n=s&&e.ctrlKey;if((!0===h||Array.isArray(h)&&h.includes(1))&&1===e.button&&"mousedown"===e.type&&(hK(e,"react-flow__node")||hK(e,"react-flow__edge")))return!0;if(!h&&!t&&!o&&!c&&!s||R||!c&&"dblclick"===e.type||hK(e,b)&&"wheel"===e.type||hK(e,w)&&("wheel"!==e.type||o&&"wheel"===e.type&&!P)||!s&&e.ctrlKey&&"wheel"===e.type||!t&&!o&&!n&&"wheel"===e.type||!h&&("mousedown"===e.type||"touchstart"===e.type)||Array.isArray(h)&&!h.includes(e.button)&&"mousedown"===e.type)return!1;let r=Array.isArray(h)&&h.includes(e.button)||!e.button||e.button<=1;return(!e.ctrlKey||"wheel"===e.type)&&r})},[R,T,i,s,o,c,h,u,P]),k.createElement("div",{className:"react-flow__renderer",ref:N,style:hV},y)},hJ=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function h0(){let{userSelectionActive:e,userSelectionRect:t}=c7(hJ,av);return e&&t?k.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}function h1(e,t){let n=t.parentNode||t.parentId,r=e.find(e=>e.id===n);if(r){let e=t.position.x+t.width-r.width,n=t.position.y+t.height-r.height;if(e>0||n>0||t.position.x<0||t.position.y<0){if(r.style={...r.style},r.style.width=r.style.width??r.width,r.style.height=r.style.height??r.height,e>0&&(r.style.width+=e),n>0&&(r.style.height+=n),t.position.x<0){let e=Math.abs(t.position.x);r.position.x=r.position.x-e,r.style.width+=e,t.position.x=0}if(t.position.y<0){let e=Math.abs(t.position.y);r.position.y=r.position.y-e,r.style.height+=e,t.position.y=0}r.width=r.style.width,r.height=r.style.height}}}function h2(e,t){if(e.some(e=>"reset"===e.type))return e.filter(e=>"reset"===e.type).map(e=>e.item);let n=e.filter(e=>"add"===e.type).map(e=>e.item);return t.reduce((t,n)=>{let r=e.filter(e=>e.id===n.id);if(0===r.length)return t.push(n),t;let i={...n};for(let e of r)if(e)switch(e.type){case"select":i.selected=e.selected;break;case"position":void 0!==e.position&&(i.position=e.position),void 0!==e.positionAbsolute&&(i.positionAbsolute=e.positionAbsolute),void 0!==e.dragging&&(i.dragging=e.dragging),i.expandParent&&h1(t,i);break;case"dimensions":void 0!==e.dimensions&&(i.width=e.dimensions.width,i.height=e.dimensions.height),void 0!==e.updateStyle&&(i.style={...i.style||{},...e.dimensions}),"boolean"==typeof e.resizing&&(i.resizing=e.resizing),i.expandParent&&h1(t,i);break;case"remove":return t}return t.push(i),t},n)}function h3(e,t){return h2(e,t)}let h5=(e,t)=>({id:e,type:"select",selected:t});function h4(e,t){return e.reduce((e,n)=>{let r=t.includes(n.id);return!n.selected&&r?(n.selected=!0,e.push(h5(n.id,!0))):n.selected&&!r&&(n.selected=!1,e.push(h5(n.id,!1))),e},[])}let h6=(e,t)=>n=>{n.target===t.current&&e?.(n)},h8=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,dragging:e.paneDragging}),h7=(0,k.memo)(({isSelecting:e,selectionMode:t=b.Full,panOnDrag:n,onSelectionStart:r,onSelectionEnd:i,onPaneClick:s,onPaneContextMenu:o,onPaneScroll:a,onPaneMouseEnter:l,onPaneMouseMove:c,onPaneMouseLeave:u,children:h})=>{let d=(0,k.useRef)(null),f=c9(),p=(0,k.useRef)(0),g=(0,k.useRef)(0),m=(0,k.useRef)(),{userSelectionActive:_,elementsSelectable:y,dragging:v}=c7(h8,av),w=()=>{f.setState({userSelectionActive:!1,userSelectionRect:null}),p.current=0,g.current=0},x=e=>{s?.(e),f.getState().resetSelectedElements(),f.setState({nodesSelectionActive:!1})},E=y&&(e||_);return k.createElement("div",{className:ac(["react-flow__pane",{dragging:v,selection:e}]),onClick:E?void 0:h6(x,d),onContextMenu:h6(e=>{if(Array.isArray(n)&&n?.includes(2)){e.preventDefault();return}o?.(e)},d),onWheel:h6(a?e=>a(e):void 0,d),onMouseEnter:E?void 0:l,onMouseDown:E?t=>{let{resetSelectedElements:n,domNode:i}=f.getState();if(m.current=i?.getBoundingClientRect(),!y||!e||0!==t.button||t.target!==d.current||!m.current)return;let{x:s,y:o}=uE(t,m.current);n(),f.setState({userSelectionRect:{width:0,height:0,startX:s,startY:o,x:s,y:o}}),r?.(t)}:void 0,onMouseMove:E?n=>{let{userSelectionRect:r,nodeInternals:i,edges:s,transform:o,onNodesChange:a,onEdgesChange:l,nodeOrigin:c,getNodes:u}=f.getState();if(!e||!m.current||!r)return;f.setState({userSelectionActive:!0,nodesSelectionActive:!1});let h=uE(n,m.current),d=r.startX??0,_=r.startY??0,y={...r,x:h.x<d?h.x:d,y:h.y<_?h.y:_,width:Math.abs(h.x-d),height:Math.abs(h.y-_)},v=u(),w=u1(i,y,o,t===b.Partial,!0,c),x=u2(w,s).map(e=>e.id),E=w.map(e=>e.id);if(p.current!==E.length){p.current=E.length;let e=h4(v,E);e.length&&a?.(e)}if(g.current!==x.length){g.current=x.length;let e=h4(s,x);e.length&&l?.(e)}f.setState({userSelectionRect:y})}:c,onMouseUp:E?e=>{if(0!==e.button)return;let{userSelectionRect:t}=f.getState();!_&&t&&e.target===d.current&&x?.(e),f.setState({nodesSelectionActive:p.current>0}),w(),i?.(e)}:void 0,onMouseLeave:E?e=>{_&&(f.setState({nodesSelectionActive:p.current>0}),i?.(e)),w()}:u,ref:d,style:hV},h,k.createElement(h0,null))});function h9(e,t,n){let r=e;do{if(r?.matches(t))return!0;if(r===n.current)break;r=r.parentElement}while(r);return!1}function de(e,t,n,r,i=[0,0],s){var o;let a=(o=e.extent||r)&&"parent"!==o?[o[0],[o[1][0]-(e.width||0),o[1][1]-(e.height||0)]]:o,l=a,c=e.parentNode||e.parentId;if("parent"!==e.extent||e.expandParent){if(e.extent&&c&&"parent"!==e.extent){let{x:t,y:r}=uJ(n.get(c),i).positionAbsolute;l=[[e.extent[0][0]+t,e.extent[0][1]+r],[e.extent[1][0]+t,e.extent[1][1]+r]]}}else if(c&&e.width&&e.height){let t=n.get(c),{x:r,y:s}=uJ(t,i).positionAbsolute;l=t&&um(r)&&um(s)&&um(t.width)&&um(t.height)?[[r+e.width*i[0],s+e.height*i[1]],[r+t.width-e.width+e.width*i[0],s+t.height-e.height+e.height*i[1]]]:l}else s?.("005",c6.error005()),l=a;let u={x:0,y:0};c&&(u=uJ(n.get(c),i).positionAbsolute);let h=l&&"parent"!==l?uo(t,l):t;return{position:{x:h.x-u.x,y:h.y-u.y},positionAbsolute:h}}function dt({nodeId:e,dragItems:t,nodeInternals:n}){let r=t.map(e=>({...n.get(e.id),position:e.position,positionAbsolute:e.positionAbsolute}));return[e?r.find(t=>t.id===e):r[0],r]}h7.displayName="Pane";let dn=(e,t,n,r)=>{let i=t.querySelectorAll(e);if(!i||!i.length)return null;let s=Array.from(i),o=t.getBoundingClientRect(),a={x:o.width*r[0],y:o.height*r[1]};return s.map(e=>{let t=e.getBoundingClientRect();return{id:e.getAttribute("data-handleid"),position:e.getAttribute("data-handlepos"),x:(t.left-o.left-a.x)/n,y:(t.top-o.top-a.y)/n,...ui(e)}})};function dr(e,t,n){return void 0===n?n:r=>{let i=t().nodeInternals.get(e);i&&n(r,{...i})}}function di({id:e,store:t,unselect:n=!1,nodeRef:r}){let{addSelectedNodes:i,unselectNodesAndEdges:s,multiSelectionActive:o,nodeInternals:a,onError:l}=t.getState(),c=a.get(e);if(!c){l?.("012",c6.error012(e));return}t.setState({nodesSelectionActive:!1}),c.selected?(n||c.selected&&o)&&(s({nodes:[c],edges:[]}),requestAnimationFrame(()=>r?.current?.blur())):i([e])}function ds(e){return(t,n,r)=>e?.(t,r)}function da({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:r,nodeId:i,isSelectable:s,selectNodesOnDrag:o}){let a=c9(),[l,c]=(0,k.useState)(!1),u=(0,k.useRef)([]),h=(0,k.useRef)({x:null,y:null}),d=(0,k.useRef)(0),f=(0,k.useRef)(null),p=(0,k.useRef)({x:0,y:0}),g=(0,k.useRef)(null),m=(0,k.useRef)(!1),_=(0,k.useRef)(!1),y=(0,k.useRef)(!1),v=function(){let e=c9();return(0,k.useCallback)(({sourceEvent:t})=>{let{transform:n,snapGrid:r,snapToGrid:i}=e.getState(),s=t.touches?t.touches[0].clientX:t.clientX,o=t.touches?t.touches[0].clientY:t.clientY,a={x:(s-n[0])/n[2],y:(o-n[1])/n[2]};return{xSnapped:i?r[0]*Math.round(a.x/r[0]):a.x,ySnapped:i?r[1]*Math.round(a.y/r[1]):a.y,...a}},[])}();return(0,k.useEffect)(()=>{if(e?.current){let l=lt(e.current),b=({x:e,y:t})=>{let{nodeInternals:n,onNodeDrag:r,onSelectionDrag:s,updateNodePositions:o,nodeExtent:l,snapGrid:d,snapToGrid:f,nodeOrigin:p,onError:m}=a.getState();h.current={x:e,y:t};let _=!1,y={x:0,y:0,x2:0,y2:0};if(u.current.length>1&&l&&(y=uh(u0(u.current,p))),u.current=u.current.map(r=>{let i={x:e-r.distance.x,y:t-r.distance.y};f&&(i.x=d[0]*Math.round(i.x/d[0]),i.y=d[1]*Math.round(i.y/d[1]));let s=[[l[0][0],l[0][1]],[l[1][0],l[1][1]]];u.current.length>1&&l&&!r.extent&&(s[0][0]=r.positionAbsolute.x-y.x+l[0][0],s[1][0]=r.positionAbsolute.x+(r.width??0)-y.x2+l[1][0],s[0][1]=r.positionAbsolute.y-y.y+l[0][1],s[1][1]=r.positionAbsolute.y+(r.height??0)-y.y2+l[1][1]);let o=de(r,i,n,s,p,m);return _=_||r.position.x!==o.position.x||r.position.y!==o.position.y,r.position=o.position,r.positionAbsolute=o.positionAbsolute,r}),!_)return;o(u.current,!0,!0),c(!0);let v=i?r:ds(s);if(v&&g.current){let[e,t]=dt({nodeId:i,dragItems:u.current,nodeInternals:n});v(g.current,e,t)}},w=()=>{if(!f.current)return;let[e,t]=ul(p.current,f.current);if(0!==e||0!==t){let{transform:n,panBy:r}=a.getState();h.current.x=(h.current.x??0)-e/n[2],h.current.y=(h.current.y??0)-t/n[2],r({x:e,y:t})&&b(h.current)}d.current=requestAnimationFrame(w)},x=t=>{let{nodeInternals:n,multiSelectionActive:r,nodesDraggable:l,unselectNodesAndEdges:c,onNodeDragStart:d,onSelectionDragStart:f}=a.getState();_.current=!0;let p=i?d:ds(f);o&&s||r||!i||n.get(i)?.selected||c(),i&&s&&o&&di({id:i,store:a,nodeRef:e});let g=v(t);if(h.current=g,u.current=Array.from(n.values()).filter(e=>(e.selected||e.id===i)&&(!e.parentNode||e.parentId||!function e(t,n){let r=t.parentNode||t.parentId;if(!r)return!1;let i=n.get(r);return!!i&&(!!i.selected||e(i,n))}(e,n))&&(e.draggable||l&&void 0===e.draggable)).map(e=>({id:e.id,position:e.position||{x:0,y:0},positionAbsolute:e.positionAbsolute||{x:0,y:0},distance:{x:g.x-(e.positionAbsolute?.x??0),y:g.y-(e.positionAbsolute?.y??0)},delta:{x:0,y:0},extent:e.extent,parentNode:e.parentNode||e.parentId,parentId:e.parentNode||e.parentId,width:e.width,height:e.height,expandParent:e.expandParent})),p&&u.current){let[e,r]=dt({nodeId:i,dragItems:u.current,nodeInternals:n});p(t.sourceEvent,e,r)}};if(t)l.on(".drag",null);else{let t=(function(){var e,t,n,r,i=c0,s=c1,o=c2,a=c3,l={},c=aw("start","drag","end"),u=0,h=0;function d(e){e.on("mousedown.drag",f).filter(a).on("touchstart.drag",m).on("touchmove.drag",_,ln).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(o,a){if(!r&&i.call(this,o,a)){var l=v(this,s.call(this,o,a),o,a,"mouse");l&&(lt(o.view).on("mousemove.drag",p,lr).on("mouseup.drag",g,lr),lo(o.view),li(o),n=!1,e=o.clientX,t=o.clientY,l("start",o))}}function p(r){if(ls(r),!n){var i=r.clientX-e,s=r.clientY-t;n=i*i+s*s>h}l.mouse("drag",r)}function g(e){lt(e.view).on("mousemove.drag mouseup.drag",null),la(e.view,n),ls(e),l.mouse("end",e)}function m(e,t){if(i.call(this,e,t)){var n,r,o=e.changedTouches,a=s.call(this,e,t),l=o.length;for(n=0;n<l;++n)(r=v(this,a,e,t,o[n].identifier,o[n]))&&(li(e),r("start",e,o[n]))}}function _(e){var t,n,r=e.changedTouches,i=r.length;for(t=0;t<i;++t)(n=l[r[t].identifier])&&(ls(e),n("drag",e,r[t]))}function y(e){var t,n,i=e.changedTouches,s=i.length;for(r&&clearTimeout(r),r=setTimeout(function(){r=null},500),t=0;t<s;++t)(n=l[i[t].identifier])&&(li(e),n("end",e,i[t]))}function v(e,t,n,r,i,s){var a,h,f,p=c.copy(),g=lu(s||n,t);if(null!=(f=o.call(e,new cJ("beforestart",{sourceEvent:n,target:d,identifier:i,active:u,x:g[0],y:g[1],dx:0,dy:0,dispatch:p}),r)))return a=f.x-g[0]||0,h=f.y-g[1]||0,function n(s,o,c){var m,_=g;switch(s){case"start":l[i]=n,m=u++;break;case"end":delete l[i],--u;case"drag":g=lu(c||o,t),m=u}p.call(s,e,new cJ(s,{sourceEvent:o,subject:f,target:d,identifier:i,active:m,x:g[0]+a,y:g[1]+h,dx:g[0]-_[0],dy:g[1]-_[1],dispatch:p}),r)}}return d.filter=function(e){return arguments.length?(i="function"==typeof e?e:cZ(!!e),d):i},d.container=function(e){return arguments.length?(s="function"==typeof e?e:cZ(e),d):s},d.subject=function(e){return arguments.length?(o="function"==typeof e?e:cZ(e),d):o},d.touchable=function(e){return arguments.length?(a="function"==typeof e?e:cZ(!!e),d):a},d.on=function(){var e=c.on.apply(c,arguments);return e===c?d:e},d.clickDistance=function(e){return arguments.length?(h=(e=+e)*e,d):Math.sqrt(h)},d})().on("start",e=>{let{domNode:t,nodeDragThreshold:n}=a.getState();0===n&&x(e),y.current=!1;let r=v(e);h.current=r,f.current=t?.getBoundingClientRect()||null,p.current=uE(e.sourceEvent,f.current)}).on("drag",e=>{let t=v(e),{autoPanOnNodeDrag:n,nodeDragThreshold:r}=a.getState();if("touchmove"===e.sourceEvent.type&&e.sourceEvent.touches.length>1&&(y.current=!0),!y.current){if(!m.current&&_.current&&n&&(m.current=!0,w()),!_.current){let n=t.xSnapped-(h?.current?.x??0),i=t.ySnapped-(h?.current?.y??0);Math.sqrt(n*n+i*i)>r&&x(e)}(h.current.x!==t.xSnapped||h.current.y!==t.ySnapped)&&u.current&&_.current&&(g.current=e.sourceEvent,p.current=uE(e.sourceEvent,f.current),b(t))}}).on("end",e=>{if(_.current&&!y.current&&(c(!1),m.current=!1,_.current=!1,cancelAnimationFrame(d.current),u.current)){let{updateNodePositions:t,nodeInternals:n,onNodeDragStop:r,onSelectionDragStop:s}=a.getState(),o=i?r:ds(s);if(t(u.current,!1,!1),o){let[t,r]=dt({nodeId:i,dragItems:u.current,nodeInternals:n});o(e.sourceEvent,t,r)}}}).filter(t=>{let i=t.target;return!t.button&&(!n||!h9(i,`.${n}`,e))&&(!r||h9(i,r,e))});return l.call(t),()=>{l.on(".drag",null)}}}},[e,t,n,r,s,a,i,o,v]),l}function dl(){let e=c9();return(0,k.useCallback)(t=>{let{nodeInternals:n,nodeExtent:r,updateNodePositions:i,getNodes:s,snapToGrid:o,snapGrid:a,onError:l,nodesDraggable:c}=e.getState(),u=s().filter(e=>e.selected&&(e.draggable||c&&void 0===e.draggable)),h=o?a[0]:5,d=o?a[1]:5,f=t.isShiftPressed?4:1,p=t.x*h*f,g=t.y*d*f;i(u.map(e=>{if(e.positionAbsolute){let t={x:e.positionAbsolute.x+p,y:e.positionAbsolute.y+g};o&&(t.x=a[0]*Math.round(t.x/a[0]),t.y=a[1]*Math.round(t.y/a[1]));let{positionAbsolute:i,position:s}=de(e,t,n,r,void 0,l);e.position=s,e.positionAbsolute=i}return e}),!0,!1)},[])}let dc={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var du=e=>{let t=({id:t,type:n,data:r,xPos:i,yPos:s,xPosOrigin:o,yPosOrigin:a,selected:l,onClick:c,onMouseEnter:u,onMouseMove:h,onMouseLeave:d,onContextMenu:f,onDoubleClick:p,style:g,className:m,isDraggable:_,isSelectable:y,isConnectable:v,isFocusable:b,selectNodesOnDrag:w,sourcePosition:x,targetPosition:E,hidden:C,resizeObserver:S,dragHandle:N,zIndex:I,isParent:T,noDragClassName:D,noPanClassName:A,initialized:R,disableKeyboardA11y:P,ariaLabel:M,rfId:O,hasHandleBounds:L})=>{let B=c9(),F=(0,k.useRef)(null),H=(0,k.useRef)(null),j=(0,k.useRef)(x),z=(0,k.useRef)(E),$=(0,k.useRef)(n),q=y||_||c||u||h||d,U=dl(),V=dr(t,B.getState,u),W=dr(t,B.getState,h),Y=dr(t,B.getState,d),K=dr(t,B.getState,f),G=dr(t,B.getState,p);(0,k.useEffect)(()=>()=>{H.current&&(S?.unobserve(H.current),H.current=null)},[]),(0,k.useEffect)(()=>{if(F.current&&!C){let e=F.current;R&&L&&H.current===e||(H.current&&S?.unobserve(H.current),S?.observe(e),H.current=e)}},[C,R,L]),(0,k.useEffect)(()=>{let e=$.current!==n,r=j.current!==x,i=z.current!==E;F.current&&(e||r||i)&&(e&&($.current=n),r&&(j.current=x),i&&(z.current=E),B.getState().updateNodeDimensions([{id:t,nodeElement:F.current,forceUpdate:!0}]))},[t,n,x,E]);let X=da({nodeRef:F,disabled:C||!_,noDragClassName:D,handleSelector:N,nodeId:t,isSelectable:y,selectNodesOnDrag:w});return C?null:k.createElement("div",{className:ac(["react-flow__node",`react-flow__node-${n}`,{[A]:_},m,{selected:l,selectable:y,parent:T,dragging:X}]),ref:F,style:{zIndex:I,transform:`translate(${o}px,${a}px)`,pointerEvents:q?"all":"none",visibility:R?"visible":"hidden",...g},"data-id":t,"data-testid":`rf__node-${t}`,onMouseEnter:V,onMouseMove:W,onMouseLeave:Y,onContextMenu:K,onClick:e=>{let{nodeDragThreshold:n}=B.getState();if(y&&(!w||!_||n>0)&&di({id:t,store:B,nodeRef:F}),c){let n=B.getState().nodeInternals.get(t);n&&c(e,{...n})}},onDoubleClick:G,onKeyDown:b?e=>{!uw(e)&&!P&&(uy.includes(e.key)&&y?di({id:t,store:B,unselect:"Escape"===e.key,nodeRef:F}):_&&l&&Object.prototype.hasOwnProperty.call(dc,e.key)&&(B.setState({ariaLiveMessage:`Moved selected node ${e.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~i}, y: ${~~s}`}),U({x:dc[e.key].x,y:dc[e.key].y,isShiftPressed:e.shiftKey})))}:void 0,tabIndex:b?0:void 0,role:b?"button":void 0,"aria-describedby":P?void 0:`${hk}-${O}`,"aria-label":M},k.createElement(uU,{value:t},k.createElement(e,{id:t,data:r,type:n,xPos:i,yPos:s,selected:l,isConnectable:v,sourcePosition:x,targetPosition:E,dragging:X,dragHandle:N,zIndex:I})))};return t.displayName="NodeWrapper",(0,k.memo)(t)};let dh=e=>({...u0(e.getNodes().filter(e=>e.selected),e.nodeOrigin),transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`,userSelectionActive:e.userSelectionActive});var dd=(0,k.memo)(function({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){let r=c9(),{width:i,height:s,x:o,y:a,transformString:l,userSelectionActive:c}=c7(dh,av),u=dl(),h=(0,k.useRef)(null);return((0,k.useEffect)(()=>{n||h.current?.focus({preventScroll:!0})},[n]),da({nodeRef:h}),!c&&i&&s)?k.createElement("div",{className:ac(["react-flow__nodesselection","react-flow__container",t]),style:{transform:l}},k.createElement("div",{ref:h,className:"react-flow__nodesselection-rect",onContextMenu:e?t=>{e(t,r.getState().getNodes().filter(e=>e.selected))}:void 0,tabIndex:n?void 0:-1,onKeyDown:n?void 0:e=>{Object.prototype.hasOwnProperty.call(dc,e.key)&&u({x:dc[e.key].x,y:dc[e.key].y,isShiftPressed:e.shiftKey})},style:{width:i,height:s,top:a,left:o}})):null});let df=e=>e.nodesSelectionActive,dp=({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:i,onPaneContextMenu:s,onPaneScroll:o,deleteKeyCode:a,onMove:l,onMoveStart:c,onMoveEnd:u,selectionKeyCode:h,selectionOnDrag:d,selectionMode:f,onSelectionStart:p,onSelectionEnd:g,multiSelectionKeyCode:m,panActivationKeyCode:_,zoomActivationKeyCode:y,elementsSelectable:v,zoomOnScroll:b,zoomOnPinch:w,panOnScroll:x,panOnScrollSpeed:E,panOnScrollMode:C,zoomOnDoubleClick:S,panOnDrag:N,defaultViewport:I,translateExtent:T,minZoom:D,maxZoom:A,preventScrolling:R,onSelectionContextMenu:P,noWheelClassName:M,noPanClassName:O,disableKeyboardA11y:L})=>{let B=c7(df),F=hA(h),H=hA(_),j=H||N,z=H||x,$=F||d&&!0!==j;return hU({deleteKeyCode:a,multiSelectionKeyCode:m}),k.createElement(hZ,{onMove:l,onMoveStart:c,onMoveEnd:u,onPaneContextMenu:s,elementsSelectable:v,zoomOnScroll:b,zoomOnPinch:w,panOnScroll:z,panOnScrollSpeed:E,panOnScrollMode:C,zoomOnDoubleClick:S,panOnDrag:!F&&j,defaultViewport:I,translateExtent:T,minZoom:D,maxZoom:A,zoomActivationKeyCode:y,preventScrolling:R,noWheelClassName:M,noPanClassName:O},k.createElement(h7,{onSelectionStart:p,onSelectionEnd:g,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:i,onPaneContextMenu:s,onPaneScroll:o,panOnDrag:j,isSelecting:!!$,selectionMode:f},e,B&&k.createElement(dd,{onSelectionContextMenu:P,noPanClassName:O,disableKeyboardA11y:L})))};dp.displayName="FlowRenderer";var dg=(0,k.memo)(dp);function dm(e){let t={input:du(e.input||hu),default:du(e.default||hl),output:du(e.output||hd),group:du(e.group||hf)},n=Object.keys(e).filter(e=>!["input","default","output","group"].includes(e)).reduce((t,n)=>(t[n]=du(e[n]||hl),t),{});return{...t,...n}}let d_=({x:e,y:t,width:n,height:r,origin:i})=>!n||!r||i[0]<0||i[1]<0||i[0]>1||i[1]>1?{x:e,y:t}:{x:e-n*i[0],y:t-r*i[1]},dy=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,updateNodeDimensions:e.updateNodeDimensions,onError:e.onError}),dv=e=>{let{nodesDraggable:t,nodesConnectable:n,nodesFocusable:r,elementsSelectable:i,updateNodeDimensions:s,onError:o}=c7(dy,av),a=function(e){return c7((0,k.useCallback)(t=>e?u1(t.nodeInternals,{x:0,y:0,width:t.width,height:t.height},t.transform,!0):t.getNodes(),[e]))}(e.onlyRenderVisibleElements),l=(0,k.useRef)(),c=(0,k.useMemo)(()=>{if("undefined"==typeof ResizeObserver)return null;let e=new ResizeObserver(e=>{s(e.map(e=>({id:e.target.getAttribute("data-id"),nodeElement:e.target,forceUpdate:!0})))});return l.current=e,e},[]);return(0,k.useEffect)(()=>()=>{l?.current?.disconnect()},[]),k.createElement("div",{className:"react-flow__nodes",style:hV},a.map(s=>{let a=s.type||"default";e.nodeTypes[a]||(o?.("003",c6.error003(a)),a="default");let l=e.nodeTypes[a]||e.nodeTypes.default,u=!!(s.draggable||t&&void 0===s.draggable),h=!!(s.selectable||i&&void 0===s.selectable),d=!!(s.connectable||n&&void 0===s.connectable),f=!!(s.focusable||r&&void 0===s.focusable),p=e.nodeExtent?uo(s.positionAbsolute,e.nodeExtent):s.positionAbsolute,g=p?.x??0,m=p?.y??0,_=d_({x:g,y:m,width:s.width??0,height:s.height??0,origin:e.nodeOrigin});return k.createElement(l,{key:s.id,id:s.id,className:s.className,style:s.style,type:a,data:s.data,sourcePosition:s.sourcePosition||E.Bottom,targetPosition:s.targetPosition||E.Top,hidden:s.hidden,xPos:g,yPos:m,xPosOrigin:_.x,yPosOrigin:_.y,selectNodesOnDrag:e.selectNodesOnDrag,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,selected:!!s.selected,isDraggable:u,isSelectable:h,isConnectable:d,isFocusable:f,resizeObserver:c,dragHandle:s.dragHandle,zIndex:s[u_]?.z??0,isParent:!!s[u_]?.isParent,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,initialized:!!s.width&&!!s.height,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,ariaLabel:s.ariaLabel,hasHandleBounds:!!s[u_]?.handleBounds})}))};dv.displayName="NodeRenderer";var db=(0,k.memo)(dv);let dw=(e,t,n)=>n===E.Left?e-t:n===E.Right?e+t:e,dx=(e,t,n)=>n===E.Top?e-t:n===E.Bottom?e+t:e,dE="react-flow__edgeupdater",dC=({position:e,centerX:t,centerY:n,radius:r=10,onMouseDown:i,onMouseEnter:s,onMouseOut:o,type:a})=>k.createElement("circle",{onMouseDown:i,onMouseEnter:s,onMouseOut:o,className:ac([dE,`${dE}-${a}`]),cx:dw(t,r,e),cy:dx(n,r,e),r:r,stroke:"transparent",fill:"transparent"}),dS=()=>!0;var dk=e=>{let t=({id:t,className:n,type:r,data:i,onClick:s,onEdgeDoubleClick:o,selected:a,animated:l,label:c,labelStyle:u,labelShowBg:h,labelBgStyle:d,labelBgPadding:f,labelBgBorderRadius:p,style:g,source:m,target:_,sourceX:y,sourceY:v,targetX:b,targetY:w,sourcePosition:x,targetPosition:E,elementsSelectable:C,hidden:S,sourceHandleId:N,targetHandleId:I,onContextMenu:T,onMouseEnter:D,onMouseMove:A,onMouseLeave:R,reconnectRadius:P,onReconnect:M,onReconnectStart:O,onReconnectEnd:L,markerEnd:B,markerStart:F,rfId:H,ariaLabel:j,isFocusable:z,isReconnectable:$,pathOptions:q,interactionWidth:U,disableKeyboardA11y:V})=>{let W=(0,k.useRef)(null),[Y,K]=(0,k.useState)(!1),[G,X]=(0,k.useState)(!1),Q=c9(),Z=(0,k.useMemo)(()=>`url('#${uK(F,H)}')`,[F,H]),J=(0,k.useMemo)(()=>`url('#${uK(B,H)}')`,[B,H]);if(S)return null;let ee=uk(t,Q.getState,o),et=uk(t,Q.getState,T),en=uk(t,Q.getState,D),er=uk(t,Q.getState,A),ei=uk(t,Q.getState,R),es=(e,n)=>{if(0!==e.button)return;let{edges:r,isValidConnection:i}=Q.getState(),s=n?_:m,o=(n?I:N)||null,a=n?"target":"source",l=i||dS,c=r.find(e=>e.id===t);X(!0),O?.(e,c,a),ht({event:e,handleId:o,nodeId:s,onConnect:e=>M?.(c,e),isTarget:n,getState:Q.getState,setState:Q.setState,isValidConnection:l,edgeUpdaterType:a,onReconnectEnd:e=>{X(!1),L?.(e,c,a)}})},eo=()=>K(!0),ea=()=>K(!1);return k.createElement("g",{className:ac(["react-flow__edge",`react-flow__edge-${r}`,n,{selected:a,animated:l,inactive:!C&&!s,updating:Y}]),onClick:e=>{let{edges:n,addSelectedEdges:r,unselectNodesAndEdges:i,multiSelectionActive:o}=Q.getState(),a=n.find(e=>e.id===t);a&&(C&&(Q.setState({nodesSelectionActive:!1}),a.selected&&o?(i({nodes:[],edges:[a]}),W.current?.blur()):r([t])),s&&s(e,a))},onDoubleClick:ee,onContextMenu:et,onMouseEnter:en,onMouseMove:er,onMouseLeave:ei,onKeyDown:z?e=>{if(!V&&uy.includes(e.key)&&C){let{unselectNodesAndEdges:n,addSelectedEdges:r,edges:i}=Q.getState();"Escape"===e.key?(W.current?.blur(),n({edges:[i.find(e=>e.id===t)]})):r([t])}}:void 0,tabIndex:z?0:void 0,role:z?"button":"img","data-testid":`rf__edge-${t}`,"aria-label":null===j?void 0:j||`Edge from ${m} to ${_}`,"aria-describedby":z?`${hN}-${H}`:void 0,ref:W},!G&&k.createElement(e,{id:t,source:m,target:_,selected:a,animated:l,label:c,labelStyle:u,labelShowBg:h,labelBgStyle:d,labelBgPadding:f,labelBgBorderRadius:p,data:i,style:g,sourceX:y,sourceY:v,targetX:b,targetY:w,sourcePosition:x,targetPosition:E,sourceHandleId:N,targetHandleId:I,markerStart:Z,markerEnd:J,pathOptions:q,interactionWidth:U}),$&&k.createElement(k.Fragment,null,("source"===$||!0===$)&&k.createElement(dC,{position:x,centerX:y,centerY:v,radius:P,onMouseDown:e=>es(e,!0),onMouseEnter:eo,onMouseOut:ea,type:"source"}),("target"===$||!0===$)&&k.createElement(dC,{position:E,centerX:b,centerY:w,radius:P,onMouseDown:e=>es(e,!1),onMouseEnter:eo,onMouseOut:ea,type:"target"})))};return t.displayName="EdgeWrapper",(0,k.memo)(t)};function dN(e){let t={default:dk(e.default||u$),straight:dk(e.bezier||uF),step:dk(e.step||uB),smoothstep:dk(e.step||uL),simplebezier:dk(e.simplebezier||uA)},n=Object.keys(e).filter(e=>!["default","bezier"].includes(e)).reduce((t,n)=>(t[n]=dk(e[n]||u$),t),{});return{...t,...n}}function dI(e,t,n=null){let r=(n?.x||0)+t.x,i=(n?.y||0)+t.y,s=n?.width||t.width,o=n?.height||t.height;switch(e){case E.Top:return{x:r+s/2,y:i};case E.Right:return{x:r+s,y:i+o/2};case E.Bottom:return{x:r+s/2,y:i+o};case E.Left:return{x:r,y:i+o/2}}}function dT(e,t){return e?1!==e.length&&t?t&&e.find(e=>e.id===t)||null:e[0]:null}let dD=(e,t,n,r,i,s)=>{let o=dI(n,e,t),a=dI(s,r,i);return{sourceX:o.x,sourceY:o.y,targetX:a.x,targetY:a.y}};function dA(e){let t=e?.[u_]?.handleBounds||null,n=t&&e?.width&&e?.height&&void 0!==e?.positionAbsolute?.x&&void 0!==e?.positionAbsolute?.y;return[{x:e?.positionAbsolute?.x||0,y:e?.positionAbsolute?.y||0,width:e?.width||0,height:e?.height||0},t,!!n]}let dR=[{level:0,isMaxLevel:!0,edges:[]}],dP={[x.Arrow]:({color:e="none",strokeWidth:t=1})=>k.createElement("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),[x.ArrowClosed]:({color:e="none",strokeWidth:t=1})=>k.createElement("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},dM=({id:e,type:t,color:n,width:r=12.5,height:i=12.5,markerUnits:s="strokeWidth",strokeWidth:o,orient:a="auto-start-reverse"})=>{let l=function(e){let t=c9();return(0,k.useMemo)(()=>Object.prototype.hasOwnProperty.call(dP,e)?dP[e]:(t.getState().onError?.("009",c6.error009(e)),null),[e])}(t);return l?k.createElement("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${r}`,markerHeight:`${i}`,viewBox:"-10 -10 20 20",markerUnits:s,orient:a,refX:"0",refY:"0"},k.createElement(l,{color:n,strokeWidth:o})):null},dO=({defaultColor:e,rfId:t})=>n=>{let r=[];return n.edges.reduce((n,i)=>([i.markerStart,i.markerEnd].forEach(i=>{if(i&&"object"==typeof i){let s=uK(i,t);r.includes(s)||(n.push({id:s,color:i.color||e,...i}),r.push(s))}}),n),[]).sort((e,t)=>e.id.localeCompare(t.id))},dL=({defaultColor:e,rfId:t})=>{let n=c7((0,k.useCallback)(dO({defaultColor:e,rfId:t}),[e,t]),(e,t)=>!(e.length!==t.length||e.some((e,n)=>e.id!==t[n].id)));return k.createElement("defs",null,n.map(e=>k.createElement(dM,{id:e.id,key:e.id,type:e.type,color:e.color,width:e.width,height:e.height,markerUnits:e.markerUnits,strokeWidth:e.strokeWidth,orient:e.orient})))};dL.displayName="MarkerDefinitions";var dB=(0,k.memo)(dL);let dF=e=>({nodesConnectable:e.nodesConnectable,edgesFocusable:e.edgesFocusable,edgesUpdatable:e.edgesUpdatable,elementsSelectable:e.elementsSelectable,width:e.width,height:e.height,connectionMode:e.connectionMode,nodeInternals:e.nodeInternals,onError:e.onError}),dH=({defaultMarkerColor:e,onlyRenderVisibleElements:t,elevateEdgesOnSelect:n,rfId:r,edgeTypes:i,noPanClassName:s,onEdgeContextMenu:o,onEdgeMouseEnter:a,onEdgeMouseMove:l,onEdgeMouseLeave:c,onEdgeClick:u,onEdgeDoubleClick:h,onReconnect:d,onReconnectStart:f,onReconnectEnd:p,reconnectRadius:g,children:m,disableKeyboardA11y:_})=>{let{edgesFocusable:v,edgesUpdatable:b,elementsSelectable:w,width:x,height:C,connectionMode:S,nodeInternals:N,onError:I}=c7(dF,av),T=function(e,t,n){return function(e,t,n=!1){let r=-1,i=Object.entries(e.reduce((e,i)=>{let s=um(i.zIndex),o=s?i.zIndex:0;if(n){let e=t.get(i.target),n=t.get(i.source),r=i.selected||e?.selected||n?.selected,a=Math.max(n?.[u_]?.z||0,e?.[u_]?.z||0,1e3);o=(s?i.zIndex:0)+(r?a:0)}return e[o]?e[o].push(i):e[o]=[i],r=o>r?o:r,e},{})).map(([e,t])=>{let n=+e;return{edges:t,level:n,isMaxLevel:n===r}});return 0===i.length?dR:i}(c7((0,k.useCallback)(n=>e?n.edges.filter(e=>{let r=t.get(e.source),i=t.get(e.target);return r?.width&&r?.height&&i?.width&&i?.height&&function({sourcePos:e,targetPos:t,sourceWidth:n,sourceHeight:r,targetWidth:i,targetHeight:s,width:o,height:a,transform:l}){let c={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x+n,t.x+i),y2:Math.max(e.y+r,t.y+s)};c.x===c.x2&&(c.x2+=1),c.y===c.y2&&(c.y2+=1);let u=uh({x:(0-l[0])/l[2],y:(0-l[1])/l[2],width:o/l[2],height:a/l[2]});return Math.ceil(Math.max(0,Math.min(u.x2,c.x2)-Math.max(u.x,c.x))*Math.max(0,Math.min(u.y2,c.y2)-Math.max(u.y,c.y)))>0}({sourcePos:r.positionAbsolute||{x:0,y:0},targetPos:i.positionAbsolute||{x:0,y:0},sourceWidth:r.width,sourceHeight:r.height,targetWidth:i.width,targetHeight:i.height,width:n.width,height:n.height,transform:n.transform})}):n.edges,[e,t])),t,n)}(t,N,n);return x?k.createElement(k.Fragment,null,T.map(({level:t,edges:n,isMaxLevel:m})=>k.createElement("svg",{key:t,style:{zIndex:t},width:x,height:C,className:"react-flow__edges react-flow__container"},m&&k.createElement(dB,{defaultColor:e,rfId:r}),k.createElement("g",null,n.map(e=>{let[t,n,m]=dA(N.get(e.source)),[x,C,T]=dA(N.get(e.target));if(!m||!T)return null;let D=e.type||"default";i[D]||(I?.("011",c6.error011(D)),D="default");let A=i[D]||i.default,R=S===y.Strict?C.target:(C.target??[]).concat(C.source??[]),P=dT(n.source,e.sourceHandle),M=dT(R,e.targetHandle),O=P?.position||E.Bottom,L=M?.position||E.Top,B=!!(e.focusable||v&&void 0===e.focusable),F=e.reconnectable||e.updatable;if(!P||!M)return I?.("008",c6.error008(P,e)),null;let{sourceX:H,sourceY:j,targetX:z,targetY:$}=dD(t,P,O,x,M,L);return k.createElement(A,{key:e.id,id:e.id,className:ac([e.className,s]),type:D,data:e.data,selected:!!e.selected,animated:!!e.animated,hidden:!!e.hidden,label:e.label,labelStyle:e.labelStyle,labelShowBg:e.labelShowBg,labelBgStyle:e.labelBgStyle,labelBgPadding:e.labelBgPadding,labelBgBorderRadius:e.labelBgBorderRadius,style:e.style,source:e.source,target:e.target,sourceHandleId:e.sourceHandle,targetHandleId:e.targetHandle,markerEnd:e.markerEnd,markerStart:e.markerStart,sourceX:H,sourceY:j,targetX:z,targetY:$,sourcePosition:O,targetPosition:L,elementsSelectable:w,onContextMenu:o,onMouseEnter:a,onMouseMove:l,onMouseLeave:c,onClick:u,onEdgeDoubleClick:h,onReconnect:d,onReconnectStart:f,onReconnectEnd:p,reconnectRadius:g,rfId:r,ariaLabel:e.ariaLabel,isFocusable:B,isReconnectable:void 0!==d&&(F||b&&void 0===F),pathOptions:"pathOptions"in e?e.pathOptions:void 0,interactionWidth:e.interactionWidth,disableKeyboardA11y:_})})))),m):null};dH.displayName="EdgeRenderer";var dj=(0,k.memo)(dH);let dz=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function d$({children:e}){let t=c7(dz);return k.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:t}},e)}let dq={[E.Left]:E.Right,[E.Right]:E.Left,[E.Top]:E.Bottom,[E.Bottom]:E.Top},dU=({nodeId:e,handleType:t,style:n,type:r=w.Bezier,CustomComponent:i,connectionStatus:s})=>{let{fromNode:o,handleId:a,toX:l,toY:c,connectionMode:u}=c7((0,k.useCallback)(t=>({fromNode:t.nodeInternals.get(e),handleId:t.connectionHandleId,toX:(t.connectionPosition.x-t.transform[0])/t.transform[2],toY:(t.connectionPosition.y-t.transform[1])/t.transform[2],connectionMode:t.connectionMode}),[e]),av),h=o?.[u_]?.handleBounds,d=h?.[t];if(u===y.Loose&&(d=d||h?.["source"===t?"target":"source"]),!o||!d)return null;let f=a?d.find(e=>e.id===a):d[0],p=f?f.x+f.width/2:(o.width??0)/2,g=f?f.y+f.height/2:o.height??0,m=(o.positionAbsolute?.x??0)+p,_=(o.positionAbsolute?.y??0)+g,v=f?.position,b=v?dq[v]:null;if(!v||!b)return null;if(i)return k.createElement(i,{connectionLineType:r,connectionLineStyle:n,fromNode:o,fromHandle:f,fromX:m,fromY:_,toX:l,toY:c,fromPosition:v,toPosition:b,connectionStatus:s});let x="",E={sourceX:m,sourceY:_,sourcePosition:v,targetX:l,targetY:c,targetPosition:b};return r===w.Bezier?[x]=uz(E):r===w.Step?[x]=uO({...E,borderRadius:0}):r===w.SmoothStep?[x]=uO(E):r===w.SimpleBezier?[x]=uD(E):x=`M${m},${_} ${l},${c}`,k.createElement("path",{d:x,fill:"none",className:"react-flow__connection-path",style:n})};dU.displayName="ConnectionLine";let dV=e=>({nodeId:e.connectionNodeId,handleType:e.connectionHandleType,nodesConnectable:e.nodesConnectable,connectionStatus:e.connectionStatus,width:e.width,height:e.height});function dW({containerStyle:e,style:t,type:n,component:r}){let{nodeId:i,handleType:s,nodesConnectable:o,width:a,height:l,connectionStatus:c}=c7(dV,av);return i&&s&&a&&o?k.createElement("svg",{style:e,width:a,height:l,className:"react-flow__edges react-flow__connectionline react-flow__container"},k.createElement("g",{className:ac(["react-flow__connection",c])},k.createElement(dU,{nodeId:i,handleType:s,style:t,type:n,CustomComponent:r,connectionStatus:c}))):null}function dY(e,t){return(0,k.useRef)(null),c9(),(0,k.useMemo)(()=>t(e),[e])}let dK=({nodeTypes:e,edgeTypes:t,onMove:n,onMoveStart:r,onMoveEnd:i,onInit:s,onNodeClick:o,onEdgeClick:a,onNodeDoubleClick:l,onEdgeDoubleClick:c,onNodeMouseEnter:u,onNodeMouseMove:h,onNodeMouseLeave:d,onNodeContextMenu:f,onSelectionContextMenu:p,onSelectionStart:g,onSelectionEnd:m,connectionLineType:_,connectionLineStyle:y,connectionLineComponent:v,connectionLineContainerStyle:b,selectionKeyCode:w,selectionOnDrag:x,selectionMode:E,multiSelectionKeyCode:C,panActivationKeyCode:S,zoomActivationKeyCode:N,deleteKeyCode:I,onlyRenderVisibleElements:T,elementsSelectable:D,selectNodesOnDrag:A,defaultViewport:R,translateExtent:P,minZoom:M,maxZoom:O,preventScrolling:L,defaultMarkerColor:B,zoomOnScroll:F,zoomOnPinch:H,panOnScroll:j,panOnScrollSpeed:z,panOnScrollMode:$,zoomOnDoubleClick:q,panOnDrag:U,onPaneClick:V,onPaneMouseEnter:W,onPaneMouseMove:Y,onPaneMouseLeave:K,onPaneScroll:G,onPaneContextMenu:X,onEdgeContextMenu:Q,onEdgeMouseEnter:Z,onEdgeMouseMove:J,onEdgeMouseLeave:ee,onReconnect:et,onReconnectStart:en,onReconnectEnd:er,reconnectRadius:ei,noDragClassName:es,noWheelClassName:eo,noPanClassName:ea,elevateEdgesOnSelect:el,disableKeyboardA11y:ec,nodeOrigin:eu,nodeExtent:eh,rfId:ed})=>{let ef=dY(e,dm),ep=dY(t,dN);return function(e){let t=h$(),n=(0,k.useRef)(!1);(0,k.useEffect)(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}(s),k.createElement(dg,{onPaneClick:V,onPaneMouseEnter:W,onPaneMouseMove:Y,onPaneMouseLeave:K,onPaneContextMenu:X,onPaneScroll:G,deleteKeyCode:I,selectionKeyCode:w,selectionOnDrag:x,selectionMode:E,onSelectionStart:g,onSelectionEnd:m,multiSelectionKeyCode:C,panActivationKeyCode:S,zoomActivationKeyCode:N,elementsSelectable:D,onMove:n,onMoveStart:r,onMoveEnd:i,zoomOnScroll:F,zoomOnPinch:H,zoomOnDoubleClick:q,panOnScroll:j,panOnScrollSpeed:z,panOnScrollMode:$,panOnDrag:U,defaultViewport:R,translateExtent:P,minZoom:M,maxZoom:O,onSelectionContextMenu:p,preventScrolling:L,noDragClassName:es,noWheelClassName:eo,noPanClassName:ea,disableKeyboardA11y:ec},k.createElement(d$,null,k.createElement(dj,{edgeTypes:ep,onEdgeClick:a,onEdgeDoubleClick:c,onlyRenderVisibleElements:T,onEdgeContextMenu:Q,onEdgeMouseEnter:Z,onEdgeMouseMove:J,onEdgeMouseLeave:ee,onReconnect:et,onReconnectStart:en,onReconnectEnd:er,reconnectRadius:ei,defaultMarkerColor:B,noPanClassName:ea,elevateEdgesOnSelect:!!el,disableKeyboardA11y:ec,rfId:ed},k.createElement(dW,{style:y,type:_,component:v,containerStyle:b})),k.createElement("div",{className:"react-flow__edgelabel-renderer"}),k.createElement(db,{nodeTypes:ef,onNodeClick:o,onNodeDoubleClick:l,onNodeMouseEnter:u,onNodeMouseMove:h,onNodeMouseLeave:d,onNodeContextMenu:f,selectNodesOnDrag:A,onlyRenderVisibleElements:T,noPanClassName:ea,noDragClassName:es,disableKeyboardA11y:ec,nodeOrigin:eu,nodeExtent:eh,rfId:ed})))};dK.displayName="GraphView";var dG=(0,k.memo)(dK);let dX=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],dQ={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:dX,nodeExtent:dX,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:y.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:uv,isValidConnection:void 0},dZ=()=>ay((e,t)=>({...dQ,setNodes:n=>{let{nodeInternals:r,nodeOrigin:i,elevateNodesOnSelect:s}=t();e({nodeInternals:hO(n,r,i,s)})},getNodes:()=>Array.from(t().nodeInternals.values()),setEdges:n=>{let{defaultEdgeOptions:r={}}=t();e({edges:n.map(e=>({...r,...e}))})},setDefaultNodesAndEdges:(n,r)=>{let i=void 0!==n,s=void 0!==r;e({nodeInternals:i?hO(n,new Map,t().nodeOrigin,t().elevateNodesOnSelect):new Map,edges:s?r:[],hasDefaultNodes:i,hasDefaultEdges:s})},updateNodeDimensions:n=>{let{onNodesChange:r,nodeInternals:i,fitViewOnInit:s,fitViewOnInitDone:o,fitViewOnInitOptions:a,domNode:l,nodeOrigin:c}=t(),u=l?.querySelector(".react-flow__viewport");if(!u)return;let h=window.getComputedStyle(u),{m22:d}=new window.DOMMatrixReadOnly(h.transform),f=n.reduce((e,t)=>{let n=i.get(t.id);if(n?.hidden)i.set(n.id,{...n,[u_]:{...n[u_],handleBounds:void 0}});else if(n){let r=ui(t.nodeElement);r.width&&r.height&&(n.width!==r.width||n.height!==r.height||t.forceUpdate)&&(i.set(n.id,{...n,[u_]:{...n[u_],handleBounds:{source:dn(".source",t.nodeElement,d,c),target:dn(".target",t.nodeElement,d,c)}},...r}),e.push({id:n.id,type:"dimensions",dimensions:r}))}return e},[]);hM(i,c);let p=o||s&&!o&&hL(t,{initial:!0,...a});e({nodeInternals:new Map(i),fitViewOnInitDone:p}),f?.length>0&&r?.(f)},updateNodePositions:(e,n=!0,r=!1)=>{let{triggerNodeChanges:i}=t();i(e.map(e=>{let t={id:e.id,type:"position",dragging:r};return n&&(t.positionAbsolute=e.positionAbsolute,t.position=e.position),t}))},triggerNodeChanges:n=>{let{onNodesChange:r,nodeInternals:i,hasDefaultNodes:s,nodeOrigin:o,getNodes:a,elevateNodesOnSelect:l}=t();n?.length&&(s&&e({nodeInternals:hO(h3(n,a()),i,o,l)}),r?.(n))},addSelectedNodes:n=>{let r;let{multiSelectionActive:i,edges:s,getNodes:o}=t(),a=null;i?r=n.map(e=>h5(e,!0)):(r=h4(o(),n),a=h4(s,[])),hB({changedNodes:r,changedEdges:a,get:t,set:e})},addSelectedEdges:n=>{let r;let{multiSelectionActive:i,edges:s,getNodes:o}=t(),a=null;i?r=n.map(e=>h5(e,!0)):(r=h4(s,n),a=h4(o(),[])),hB({changedNodes:a,changedEdges:r,get:t,set:e})},unselectNodesAndEdges:({nodes:n,edges:r}={})=>{let{edges:i,getNodes:s}=t();hB({changedNodes:(n||s()).map(e=>(e.selected=!1,h5(e.id,!1))),changedEdges:(r||i).map(e=>h5(e.id,!1)),get:t,set:e})},setMinZoom:n=>{let{d3Zoom:r,maxZoom:i}=t();r?.scaleExtent([n,i]),e({minZoom:n})},setMaxZoom:n=>{let{d3Zoom:r,minZoom:i}=t();r?.scaleExtent([i,n]),e({maxZoom:n})},setTranslateExtent:n=>{t().d3Zoom?.translateExtent(n),e({translateExtent:n})},resetSelectedElements:()=>{let{edges:n,getNodes:r}=t();hB({changedNodes:r().filter(e=>e.selected).map(e=>h5(e.id,!1)),changedEdges:n.filter(e=>e.selected).map(e=>h5(e.id,!1)),get:t,set:e})},setNodeExtent:n=>{let{nodeInternals:r}=t();r.forEach(e=>{e.positionAbsolute=uo(e.position,n)}),e({nodeExtent:n,nodeInternals:new Map(r)})},panBy:e=>{let{transform:n,width:r,height:i,d3Zoom:s,d3Selection:o,translateExtent:a}=t();if(!s||!o||!e.x&&!e.y)return!1;let l=cq.translate(n[0]+e.x,n[1]+e.y).scale(n[2]),c=s?.constrain()(l,[[0,0],[r,i]],a);return s.transform(o,c),n[0]!==c.x||n[1]!==c.y||n[2]!==c.k},cancelConnection:()=>e({connectionNodeId:dQ.connectionNodeId,connectionHandleId:dQ.connectionHandleId,connectionHandleType:dQ.connectionHandleType,connectionStatus:dQ.connectionStatus,connectionStartHandle:dQ.connectionStartHandle,connectionEndHandle:dQ.connectionEndHandle}),reset:()=>e({...dQ})}),Object.is),dJ=({children:e})=>{let t=(0,k.useRef)(null);return t.current||(t.current=dZ()),k.createElement(c4,{value:t.current},e)};dJ.displayName="ReactFlowProvider";let d0=({children:e})=>(0,k.useContext)(c5)?k.createElement(k.Fragment,null,e):k.createElement(dJ,null,e);d0.displayName="ReactFlowWrapper";let d1={input:hu,default:hl,output:hd,group:hf},d2={default:u$,straight:uF,step:uB,smoothstep:uL,simplebezier:uA},d3=[0,0],d5=[15,15],d4={x:0,y:0,zoom:1},d6={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},d8=(0,k.forwardRef)(({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,className:i,nodeTypes:s=d1,edgeTypes:o=d2,onNodeClick:a,onEdgeClick:l,onInit:c,onMove:u,onMoveStart:h,onMoveEnd:d,onConnect:f,onConnectStart:p,onConnectEnd:g,onClickConnectStart:m,onClickConnectEnd:_,onNodeMouseEnter:x,onNodeMouseMove:E,onNodeMouseLeave:C,onNodeContextMenu:S,onNodeDoubleClick:N,onNodeDragStart:I,onNodeDrag:T,onNodeDragStop:D,onNodesDelete:A,onEdgesDelete:R,onSelectionChange:P,onSelectionDragStart:M,onSelectionDrag:O,onSelectionDragStop:L,onSelectionContextMenu:B,onSelectionStart:F,onSelectionEnd:H,connectionMode:j=y.Strict,connectionLineType:z=w.Bezier,connectionLineStyle:$,connectionLineComponent:q,connectionLineContainerStyle:U,deleteKeyCode:V="Backspace",selectionKeyCode:W="Shift",selectionOnDrag:Y=!1,selectionMode:K=b.Full,panActivationKeyCode:G="Space",multiSelectionKeyCode:X=uC()?"Meta":"Control",zoomActivationKeyCode:Q=uC()?"Meta":"Control",snapToGrid:Z=!1,snapGrid:J=d5,onlyRenderVisibleElements:ee=!1,selectNodesOnDrag:et=!0,nodesDraggable:en,nodesConnectable:er,nodesFocusable:ei,nodeOrigin:es=d3,edgesFocusable:eo,edgesUpdatable:ea,elementsSelectable:el,defaultViewport:ec=d4,minZoom:eu=.5,maxZoom:eh=2,translateExtent:ed=dX,preventScrolling:ef=!0,nodeExtent:ep,defaultMarkerColor:eg="#b1b1b7",zoomOnScroll:em=!0,zoomOnPinch:e_=!0,panOnScroll:ey=!1,panOnScrollSpeed:ev=.5,panOnScrollMode:eb=v.Free,zoomOnDoubleClick:ew=!0,panOnDrag:ex=!0,onPaneClick:eE,onPaneMouseEnter:eC,onPaneMouseMove:eS,onPaneMouseLeave:ek,onPaneScroll:eN,onPaneContextMenu:eI,children:eT,onEdgeContextMenu:eD,onEdgeDoubleClick:eA,onEdgeMouseEnter:eR,onEdgeMouseMove:eP,onEdgeMouseLeave:eM,onEdgeUpdate:eO,onEdgeUpdateStart:eL,onEdgeUpdateEnd:eB,onReconnect:eF,onReconnectStart:eH,onReconnectEnd:ej,reconnectRadius:ez=10,edgeUpdaterRadius:e$=10,onNodesChange:eq,onEdgesChange:eU,noDragClassName:eV="nodrag",noWheelClassName:eW="nowheel",noPanClassName:eY="nopan",fitView:eK=!1,fitViewOptions:eG,connectOnClick:eX=!0,attributionPosition:eQ,proOptions:eZ,defaultEdgeOptions:eJ,elevateNodesOnSelect:e0=!0,elevateEdgesOnSelect:e1=!1,disableKeyboardA11y:e2=!1,autoPanOnConnect:e3=!0,autoPanOnNodeDrag:e5=!0,connectionRadius:e4=20,isValidConnection:e6,onError:e8,style:e7,id:e9,nodeDragThreshold:te,...tt},tn)=>{let tr=e9||"1";return k.createElement("div",{...tt,style:{...e7,...d6},ref:tn,className:ac(["react-flow",i]),"data-testid":"rf__wrapper",id:e9},k.createElement(d0,null,k.createElement(dG,{onInit:c,onMove:u,onMoveStart:h,onMoveEnd:d,onNodeClick:a,onEdgeClick:l,onNodeMouseEnter:x,onNodeMouseMove:E,onNodeMouseLeave:C,onNodeContextMenu:S,onNodeDoubleClick:N,nodeTypes:s,edgeTypes:o,connectionLineType:z,connectionLineStyle:$,connectionLineComponent:q,connectionLineContainerStyle:U,selectionKeyCode:W,selectionOnDrag:Y,selectionMode:K,deleteKeyCode:V,multiSelectionKeyCode:X,panActivationKeyCode:G,zoomActivationKeyCode:Q,onlyRenderVisibleElements:ee,selectNodesOnDrag:et,defaultViewport:ec,translateExtent:ed,minZoom:eu,maxZoom:eh,preventScrolling:ef,zoomOnScroll:em,zoomOnPinch:e_,zoomOnDoubleClick:ew,panOnScroll:ey,panOnScrollSpeed:ev,panOnScrollMode:eb,panOnDrag:ex,onPaneClick:eE,onPaneMouseEnter:eC,onPaneMouseMove:eS,onPaneMouseLeave:ek,onPaneScroll:eN,onPaneContextMenu:eI,onSelectionContextMenu:B,onSelectionStart:F,onSelectionEnd:H,onEdgeContextMenu:eD,onEdgeDoubleClick:eA,onEdgeMouseEnter:eR,onEdgeMouseMove:eP,onEdgeMouseLeave:eM,onReconnect:eF??eO,onReconnectStart:eH??eL,onReconnectEnd:ej??eB,reconnectRadius:ez??e$,defaultMarkerColor:eg,noDragClassName:eV,noWheelClassName:eW,noPanClassName:eY,elevateEdgesOnSelect:e1,rfId:tr,disableKeyboardA11y:e2,nodeOrigin:es,nodeExtent:ep}),k.createElement(hE,{nodes:e,edges:t,defaultNodes:n,defaultEdges:r,onConnect:f,onConnectStart:p,onConnectEnd:g,onClickConnectStart:m,onClickConnectEnd:_,nodesDraggable:en,nodesConnectable:er,nodesFocusable:ei,edgesFocusable:eo,edgesUpdatable:ea,elementsSelectable:el,elevateNodesOnSelect:e0,minZoom:eu,maxZoom:eh,nodeExtent:ep,onNodesChange:eq,onEdgesChange:eU,snapToGrid:Z,snapGrid:J,connectionMode:j,translateExtent:ed,connectOnClick:eX,defaultEdgeOptions:eJ,fitView:eK,fitViewOptions:eG,onNodesDelete:A,onEdgesDelete:R,onNodeDragStart:I,onNodeDrag:T,onNodeDragStop:D,onSelectionDrag:O,onSelectionDragStart:M,onSelectionDragStop:L,noPanClassName:eY,nodeOrigin:es,rfId:tr,autoPanOnConnect:e3,autoPanOnNodeDrag:e5,onError:e8,connectionRadius:e4,isValidConnection:e6,nodeDragThreshold:te}),k.createElement(hv,{onSelectionChange:P}),eT,k.createElement(un,{proOptions:eZ,position:eQ}),k.createElement(hD,{rfId:tr,disableKeyboardA11y:e2})))});function d7(e){return t=>{let[n,r]=(0,k.useState)(t),i=(0,k.useCallback)(t=>r(n=>e(t,n)),[]);return[n,r,i]}}d8.displayName="ReactFlow";let d9=d7(h3),fe=d7(function(e,t){return h2(e,t)});function ft({color:e,dimensions:t,lineWidth:n}){return k.createElement("path",{stroke:e,strokeWidth:n,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`})}function fn({color:e,radius:t}){return k.createElement("circle",{cx:t,cy:t,r:t,fill:e})}!function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"}(C||(C={}));let fr={[C.Dots]:"#91919a",[C.Lines]:"#eee",[C.Cross]:"#e2e2e2"},fi={[C.Dots]:1,[C.Lines]:1,[C.Cross]:6},fs=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function fo({id:e,variant:t=C.Dots,gap:n=20,size:r,lineWidth:i=1,offset:s=2,color:o,style:a,className:l}){let c=(0,k.useRef)(null),{transform:u,patternId:h}=c7(fs,av),d=o||fr[t],f=r||fi[t],p=t===C.Dots,g=t===C.Cross,m=Array.isArray(n)?n:[n,n],_=[m[0]*u[2]||1,m[1]*u[2]||1],y=f*u[2],v=g?[y,y]:_,b=p?[y/s,y/s]:[v[0]/s,v[1]/s];return k.createElement("svg",{className:ac(["react-flow__background",l]),style:{...a,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:c,"data-testid":"rf__background"},k.createElement("pattern",{id:h+e,x:u[0]%_[0],y:u[1]%_[1],width:_[0],height:_[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${b[0]},-${b[1]})`},p?k.createElement(fn,{color:d,radius:y/s}):k.createElement(ft,{dimensions:v,color:d,lineWidth:i})),k.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${h+e})`}))}fo.displayName="Background";var fa=(0,k.memo)(fo);function fl(){return k.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},k.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function fc(){return k.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},k.createElement("path",{d:"M0 0h32v4.2H0z"}))}function fu(){return k.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},k.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function fh(){return k.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},k.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function fd(){return k.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},k.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}let ff=({children:e,className:t,...n})=>k.createElement("button",{type:"button",className:ac(["react-flow__controls-button",t]),...n},e);ff.displayName="ControlButton";let fp=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom}),fg=({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:r=!0,fitViewOptions:i,onZoomIn:s,onZoomOut:o,onFitView:a,onInteractiveChange:l,className:c,children:u,position:h="bottom-left"})=>{let d=c9(),[f,p]=(0,k.useState)(!1),{isInteractive:g,minZoomReached:m,maxZoomReached:_}=c7(fp,av),{zoomIn:y,zoomOut:v,fitView:b}=h$();return((0,k.useEffect)(()=>{p(!0)},[]),f)?k.createElement(ut,{className:ac(["react-flow__controls",c]),position:h,style:e,"data-testid":"rf__controls"},t&&k.createElement(k.Fragment,null,k.createElement(ff,{onClick:()=>{y(),s?.()},className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:_},k.createElement(fl,null)),k.createElement(ff,{onClick:()=>{v(),o?.()},className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:m},k.createElement(fc,null))),n&&k.createElement(ff,{className:"react-flow__controls-fitview",onClick:()=>{b(i),a?.()},title:"fit view","aria-label":"fit view"},k.createElement(fu,null)),r&&k.createElement(ff,{className:"react-flow__controls-interactive",onClick:()=>{d.setState({nodesDraggable:!g,nodesConnectable:!g,elementsSelectable:!g}),l?.(!g)},title:"toggle interactivity","aria-label":"toggle interactivity"},g?k.createElement(fd,null):k.createElement(fh,null)),u):null};fg.displayName="Controls";var fm=(0,k.memo)(fg);n(1972);let f_={opportunities:"#fff5f5",enablers:"#f0f7ff",actors:"#fffff0"},fy={opportunities:"#fed7d7",enablers:"#bee3f8",actors:"#faf089"},fv={"10months":"10 Months","3years":"3 Years","10years":"10 Years",foundational:"Foundational"},fb=["10months","3years","10years","foundational"],fw=["opportunities","enablers","actors"],fx={noteNode:function({data:e}){return(0,S.jsxs)("div",{style:{background:e.background,border:`1px solid ${e.border}`,borderRadius:"6px",padding:"8px",fontSize:"10px",width:150,cursor:"pointer"},children:[S.jsx(ho,{type:"target",position:E.Top,style:{background:"#667eea"}}),S.jsx("div",{children:e.label}),S.jsx(ho,{type:"source",position:E.Bottom,style:{background:"#667eea"}})]})}};function fE({notes:e,connections:t,onNoteClick:n,onConnect:r}){let i=(0,k.useCallback)(()=>{let t=[],n={};return fb.forEach((e,n)=>{t.push({id:`header-${e}`,position:{x:180+320*n+160-60,y:10},data:{label:fv[e]},style:{background:"#1a1a2e",color:"white",border:"none",borderRadius:"6px",padding:"8px 16px",fontSize:"12px",fontWeight:"600",width:100,textAlign:"center"},draggable:!1,selectable:!1})}),fw.forEach((e,n)=>{t.push({id:`label-${e}`,position:{x:20,y:70+280*n+40},data:{label:e.charAt(0).toUpperCase()+e.slice(1)},style:{background:f_[e],border:`2px solid ${fy[e]}`,borderRadius:"6px",padding:"8px 12px",fontSize:"11px",fontWeight:"600",width:100,textAlign:"center"},draggable:!1,selectable:!1})}),e.forEach(e=>{let r=fb.indexOf(e.timeframe),i=fw.indexOf(e.category);if(-1===r||-1===i)return;let s=`${e.category}-${e.timeframe}`;n[s]=n[s]||0;let o=n[s];n[s]++,t.push({id:e.id,type:"noteNode",position:{x:180+320*r+o%2*165,y:70+280*i+85*Math.floor(o/2)},data:{label:e.text.length>35?e.text.substring(0,35)+"...":e.text,note:e,background:f_[e.category],border:fy[e.category]}})}),t},[e]),s=(0,k.useCallback)(()=>t.map(e=>({id:e.id,source:e.sourceId,target:e.targetId,style:{stroke:"#667eea",strokeWidth:2},markerEnd:{type:x.ArrowClosed,color:"#667eea"},animated:!0})),[t]),[o,a,l]=d9(i()),[c,u,h]=fe(s());(0,k.useEffect)(()=>{a(i())},[e,i,a]),(0,k.useEffect)(()=>{u(s())},[t,s,u]);let d=(0,k.useCallback)(e=>{e.source&&e.target&&r(e.source,e.target)},[r]),f=(0,k.useCallback)((e,t)=>{!(t.id.startsWith("header-")||t.id.startsWith("label-"))&&t.data.note&&n(t.data.note)},[n]);return S.jsx("div",{style:{width:"100%",height:"700px",background:"white",borderRadius:"12px",border:"1px solid #e9ecef"},children:(0,S.jsxs)(d8,{nodes:o,edges:c,onNodesChange:l,onEdgesChange:h,onConnect:d,onNodeClick:f,nodeTypes:fx,fitView:!0,fitViewOptions:{padding:.1},connectionLineStyle:{stroke:"#667eea",strokeWidth:2},children:[S.jsx(fa,{color:"#f1f3f4",gap:20}),S.jsx(fm,{})]})})}function fC(e){return(e.split("").reduce((e,t)=>e+t.charCodeAt(0),0)%13-6)*.1}function fS(){let{notes:e,loading:t,addNote:n,editNote:r,removeNote:i,vote:s,seed:o}=function(){let[e,t]=(0,k.useState)([]),[n,r]=(0,k.useState)(!0),[i,s]=(0,k.useState)(null);(0,k.useEffect)(()=>{r(!0);let e=function(e){let t=sk(sC),n=t=>{if(!t.exists()){e([]);return}e(Object.values(t.val()))};return sh(t,n),()=>sd(t,"value",n)}(e=>{t(e),r(!1)});return()=>e()},[]);let o=(0,k.useCallback)(async e=>{try{return await sN(e)}catch(e){throw s(e),e}},[]),a=(0,k.useCallback)(async(e,t)=>{try{await sI(e,t)}catch(e){throw s(e),e}},[]);return{notes:e,loading:n,error:i,addNote:o,editNote:a,removeNote:(0,k.useCallback)(async e=>{try{await sT(e)}catch(e){throw s(e),e}},[]),vote:(0,k.useCallback)(async(e,t=1)=>{try{await sR(e,t)}catch(e){throw s(e),e}},[]),seed:(0,k.useCallback)(async()=>{try{await sO(I)}catch(e){throw s(e),e}},[])}}(),{connections:a,addConnection:l,removeConnection:c}=function(){let[e,t]=(0,k.useState)([]),[n,r]=(0,k.useState)(!0),[i,s]=(0,k.useState)(null);return(0,k.useEffect)(()=>{r(!0);let e=function(e){let t=sk(sS),n=t=>{if(!t.exists()){e([]);return}e(Object.values(t.val()))};return sh(t,n),()=>sd(t,"value",n)}(e=>{t(e),r(!1)});return()=>e()},[]),{connections:e,loading:n,error:i,addConnection:(0,k.useCallback)(async(e,t,n)=>{try{return await sP(e,t,n)}catch(e){throw s(e),e}},[]),removeConnection:(0,k.useCallback)(async e=>{try{await sM(e)}catch(e){throw s(e),e}},[])}}(),[u,h]=(0,k.useState)("board"),[d,f]=(0,k.useState)({timeframe:"all",category:"all",searchQuery:"",showConnections:!1}),[p,g]=(0,k.useState)(null),[m,_]=(0,k.useState)(!1),[y,v]=(0,k.useState)(null),b=e.filter(e=>{if("all"!==d.timeframe&&e.timeframe!==d.timeframe||"all"!==d.category&&e.category!==d.category)return!1;if(d.searchQuery){let t=d.searchQuery.toLowerCase(),n=e.text.toLowerCase().includes(t),r=(e.tags||[]).some(e=>e.toLowerCase().includes(t));if(!n&&!r)return!1}return!0}),w=function(e){let t=e.length,n=e.reduce((e,t)=>e+(t.votes||0),0),r=new Set(e.map(e=>e.createdBy).filter(Boolean)).size||8;return{totalIdeas:t,totalVotes:n,contributors:r,topVoted:[...e].sort((e,t)=>(t.votes||0)-(e.votes||0)).slice(0,5),byCategory:{opportunities:e.filter(e=>"opportunities"===e.category).length,enablers:e.filter(e=>"enablers"===e.category).length,actors:e.filter(e=>"actors"===e.category).length},byTimeframe:{"10months":e.filter(e=>"10months"===e.timeframe).length,"3years":e.filter(e=>"3years"===e.timeframe).length,"10years":e.filter(e=>"10years"===e.timeframe).length,foundational:e.filter(e=>"foundational"===e.timeframe).length}}}(e);(0,k.useEffect)(()=>{t||0!==e.length||o()},[t,e.length,o]);let x=e=>{y?(y!==e.id&&l(y,e.id),v(null)):(g(e),_(!0))},E=async e=>{p?await r(p.id,e):await n(e)},C=async t=>{let{active:n,over:i}=t;if(!i)return;let s=n.id,[o,a]=i.id.split("-"),l=e.find(e=>e.id===s);l&&(l.category!==o||l.timeframe!==a)&&await r(s,{category:o,timeframe:a})},N=(e,t)=>b.filter(n=>n.category===e&&n.timeframe===t);return t?S.jsx("div",{className:sB().loading,children:"Loading..."}):(0,S.jsxs)("div",{className:sB().container,children:[(0,S.jsxs)("header",{className:sB().header,children:[S.jsx("h1",{className:sB().title,children:"AI Landscape"}),S.jsx("p",{className:sB().subtitle,children:"Mapping the future of artificial intelligence across opportunities, enabling technologies, and key actors"})]}),(0,S.jsxs)("div",{className:sB().stats,children:[(0,S.jsxs)("div",{className:sB().stat,children:[S.jsx("div",{className:sB().statNumber,children:w.totalIdeas}),S.jsx("div",{className:sB().statLabel,children:"Ideas"})]}),(0,S.jsxs)("div",{className:sB().stat,children:[S.jsx("div",{className:sB().statNumber,children:w.totalVotes}),S.jsx("div",{className:sB().statLabel,children:"Total Votes"})]}),(0,S.jsxs)("div",{className:sB().stat,children:[S.jsx("div",{className:sB().statNumber,children:w.contributors}),S.jsx("div",{className:sB().statLabel,children:"Contributors"})]})]}),(0,S.jsxs)("div",{className:sB().topVoted,children:[(0,S.jsxs)("div",{className:sB().topVotedHeader,children:[S.jsx("span",{className:sB().trophyIcon,children:"\uD83C\uDFC6"}),S.jsx("h2",{children:"Top Voted Ideas"})]}),S.jsx("div",{className:sB().topVotedList,children:w.topVoted.map((e,t)=>{let n=e.category||"opportunities",r=T[n]?.colour||"pink";return(0,S.jsxs)("div",{className:`${sB().topVotedItem} ${sB()[r]}`,children:[(0,S.jsxs)("div",{className:sB().topVotedRank,children:["#",t+1]}),(0,S.jsxs)("div",{className:sB().topVotedContent,children:[S.jsx("p",{className:sB().topVotedText,children:e.text}),(0,S.jsxs)("div",{className:sB().topVotedMeta,children:[S.jsx("span",{className:sB().topVotedCategory,children:n}),S.jsx("span",{className:sB().topVotedTime,children:D[e.timeframe]?.label||e.timeframe})]})]}),(0,S.jsxs)("div",{className:sB().topVotedDots,children:[S.jsx("span",{className:sB().dotCount,children:e.votes||0}),S.jsx("span",{className:sB().dotLabel,children:"votes"})]})]},e.id)})})]}),(0,S.jsxs)("div",{className:sB().controls,children:[(0,S.jsxs)("div",{className:sB().viewToggle,children:[S.jsx("button",{className:`${sB().viewBtn} ${"grid"===u?sB().active:""}`,onClick:()=>h("grid"),children:"Grid"}),S.jsx("button",{className:`${sB().viewBtn} ${"board"===u?sB().active:""}`,onClick:()=>h("board"),children:"Board"}),S.jsx("button",{className:`${sB().viewBtn} ${"flow"===u?sB().active:""}`,onClick:()=>h("flow"),children:"Flow"})]}),S.jsx("input",{type:"text",placeholder:"Search ideas...",className:sB().searchInput,value:d.searchQuery,onChange:e=>f(t=>({...t,searchQuery:e.target.value}))}),(0,S.jsxs)("div",{className:sB().filterGroup,children:[S.jsx("button",{className:`${sB().filterBtn} ${"all"===d.timeframe?sB().active:""}`,onClick:()=>f(e=>({...e,timeframe:"all"})),children:"All Times"}),Object.entries(D).filter(([e])=>"foundational"!==e).map(([e,t])=>S.jsx("button",{className:`${sB().filterBtn} ${d.timeframe===e?sB().active:""}`,onClick:()=>f(t=>({...t,timeframe:e})),children:t.label},e))]}),(0,S.jsxs)("div",{className:sB().filterGroup,children:[S.jsx("button",{className:`${sB().filterBtn} ${"all"===d.category?sB().active:""}`,onClick:()=>f(e=>({...e,category:"all"})),children:"All Categories"}),Object.entries(T).map(([e,t])=>S.jsx("button",{className:`${sB().filterBtn} ${d.category===e?sB().active:""}`,onClick:()=>f(t=>({...t,category:e})),children:t.label},e))]}),S.jsx("button",{className:sB().addNoteBtn,onClick:()=>{g(null),_(!0)},children:"+ Add Note"}),S.jsx("button",{className:sB().filterBtn,onClick:()=>(function(e,t="ai-landscape-export"){let n=JSON.stringify(e,null,2);s$(new Blob([n],{type:"application/json"}),`${t}.json`)})(e),children:"JSON"}),S.jsx("button",{className:sB().filterBtn,onClick:()=>(function(e,t="ai-landscape-export"){let n=["ID,Text,Category,Timeframe,Votes,Tags,Created",...e.map(e=>[e.id,`"${e.text.replace(/"/g,'""')}"`,e.category,e.timeframe,e.votes||0,`"${(e.tags||[]).join(", ")}"`,new Date(e.createdAt).toISOString()]).map(e=>e.join(","))].join("\n");s$(new Blob([n],{type:"text/csv"}),`${t}.csv`)})(e),children:"CSV"}),S.jsx("button",{className:sB().filterBtn,onClick:()=>sz(e),children:"PDF"})]}),"board"===u&&S.jsx(an,{onDragEnd:C,children:(0,S.jsxs)("div",{className:`${sB().board} ${sB().fadeIn}`,children:[(0,S.jsxs)("div",{className:sB().boardHeader,children:[S.jsx("div",{className:sB().boardRowLabel}),S.jsx("div",{className:sB().timeframeHeader,children:"Next 10 months"}),S.jsx("div",{className:sB().timeframeHeader,children:"3 years"}),S.jsx("div",{className:sB().timeframeHeader,children:"10 years"})]}),(0,S.jsxs)("div",{className:`${sB().boardRow} ${sB().pinkRow}`,children:[S.jsx("div",{className:sB().boardRowLabel,children:S.jsx("div",{className:`${sB().categoryBadge} ${sB().pink}`,children:"Opportunities"})}),["10months","3years","10years"].map(e=>S.jsx(al,{category:"opportunities",timeframe:e,children:N("opportunities",e).map(e=>S.jsx(aa,{note:e,onClick:()=>x(e),rotation:fC(e.id)},e.id))},e))]}),(0,S.jsxs)("div",{className:`${sB().boardRow} ${sB().blueRow}`,children:[S.jsx("div",{className:sB().boardRowLabel,children:S.jsx("div",{className:`${sB().categoryBadge} ${sB().blue}`,children:"Enablers"})}),["10months","3years","10years"].map(e=>S.jsx(al,{category:"enablers",timeframe:e,children:N("enablers",e).map(e=>S.jsx(aa,{note:e,onClick:()=>x(e),rotation:fC(e.id)},e.id))},e))]}),(0,S.jsxs)("div",{className:`${sB().boardRow} ${sB().yellowRow}`,children:[S.jsx("div",{className:sB().boardRowLabel,children:S.jsx("div",{className:`${sB().categoryBadge} ${sB().yellow}`,children:"Actors"})}),["10months","3years","10years"].map(e=>S.jsx(al,{category:"actors",timeframe:e,children:N("actors",e).map(e=>S.jsx(aa,{note:e,onClick:()=>x(e),rotation:fC(e.id)},e.id))},e))]})]})}),"grid"===u&&S.jsx("div",{className:sB().gridView,children:b.map(e=>S.jsx(sH,{note:e,onClick:()=>x(e),rotation:fC(e.id)},e.id))}),"flow"===u&&S.jsx(fE,{notes:b,connections:a,onNoteClick:x,onConnect:l}),S.jsx(sj,{note:p,isOpen:m,onClose:()=>{_(!1),g(null)},onSave:E,onDelete:i,onVote:s})]})}function fk(){return(0,k.useEffect)(()=>{sm()},[]),S.jsx(fS,{})}},1413:e=>{e.exports={container:"Dashboard_container__6rOOg",header:"Dashboard_header__jcHc0",title:"Dashboard_title__8qkrH",subtitle:"Dashboard_subtitle__ey_Kt",stats:"Dashboard_stats__AIRd5",stat:"Dashboard_stat__voLFe",statNumber:"Dashboard_statNumber__bKpSM",statLabel:"Dashboard_statLabel__kbIyq",topVoted:"Dashboard_topVoted__z7WQI",topVotedHeader:"Dashboard_topVotedHeader__CUnsO",trophyIcon:"Dashboard_trophyIcon__svEDU",topVotedList:"Dashboard_topVotedList__bP5_U",topVotedItem:"Dashboard_topVotedItem__IPzBn",pink:"Dashboard_pink__LlAlN",blue:"Dashboard_blue__PAJoM",yellow:"Dashboard_yellow__SyuBX",topVotedRank:"Dashboard_topVotedRank__nEjal",topVotedContent:"Dashboard_topVotedContent__nBkQo",topVotedText:"Dashboard_topVotedText__eaXb1",topVotedMeta:"Dashboard_topVotedMeta__6gFbW",topVotedCategory:"Dashboard_topVotedCategory__bn4P_",topVotedTime:"Dashboard_topVotedTime__o_Gbe",topVotedDots:"Dashboard_topVotedDots__o8D2D",dotCount:"Dashboard_dotCount__SK0k9",dotLabel:"Dashboard_dotLabel__2logt",controls:"Dashboard_controls__nl8ZK",viewToggle:"Dashboard_viewToggle__Ti917",viewBtn:"Dashboard_viewBtn__1rrbP",active:"Dashboard_active__4iCeR",searchInput:"Dashboard_searchInput__j3YZX",filterGroup:"Dashboard_filterGroup__Arsfz",filterBtn:"Dashboard_filterBtn__up06x",addNoteBtn:"Dashboard_addNoteBtn__WO19E",board:"Dashboard_board__0Vs4l",boardHeader:"Dashboard_boardHeader__bJHqN",boardRowLabel:"Dashboard_boardRowLabel__7HjGT",timeframeHeader:"Dashboard_timeframeHeader__JXrun",boardRow:"Dashboard_boardRow__7FLNn",categoryBadge:"Dashboard_categoryBadge__NTfH4",categoryQuestion:"Dashboard_categoryQuestion__6IV4n",boardCell:"Dashboard_boardCell__1y_Xa",card:"Dashboard_card__CiI3J",cardText:"Dashboard_cardText__bIBq0",cardFooter:"Dashboard_cardFooter__xxqu9",dots:"Dashboard_dots__oFO_q",dot:"Dashboard_dot__Z8PMN",tags:"Dashboard_tags__lW0oy",tag:"Dashboard_tag__GsyF6",gridView:"Dashboard_gridView___YvlR",emptyState:"Dashboard_emptyState__P7IHg",loading:"Dashboard_loading__4ZfRx",modal:"Dashboard_modal__wM0Ku",modalContent:"Dashboard_modalContent__TzfN4",modalTitle:"Dashboard_modalTitle___6_sp",formGroup:"Dashboard_formGroup__JzSEM",voteControls:"Dashboard_voteControls__x95Fd",voteBtn:"Dashboard_voteBtn__1XT1i",modalActions:"Dashboard_modalActions__ZTxAg",saveBtn:"Dashboard_saveBtn__AS_yO",cancelBtn:"Dashboard_cancelBtn__eZxNv",deleteBtn:"Dashboard_deleteBtn__bVa5L",footer:"Dashboard_footer__BWnUG",fadeIn:"Dashboard_fadeIn__z2RZ1"}},1342:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s,metadata:()=>i});var r=n(5036);n(5023);let i={title:"AI Landscape - Foresight Workshop",description:"Mapping the future of artificial intelligence across opportunities, enabling technologies, and key actors"};function s({children:e}){return(0,r.jsxs)("html",{lang:"en",children:[(0,r.jsxs)("head",{children:[r.jsx("link",{rel:"preconnect",href:"https://fonts.googleapis.com"}),r.jsx("link",{rel:"preconnect",href:"https://fonts.gstatic.com",crossOrigin:"anonymous"}),r.jsx("link",{href:"https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Space+Mono:wght@400;700&family=Nunito:wght@400;500;600;700&family=Inter:wght@300;400;500&display=swap",rel:"stylesheet"})]}),r.jsx("body",{children:e})]})}},1136:(e,t,n)=>{"use strict";n.r(t),n.d(t,{$$typeof:()=>s,__esModule:()=>i,default:()=>o});let r=(0,n(6843).createProxy)(String.raw`/Users/ameliag/Downloads/ai-landscape-tool/ai-landscape-tool/src/app/page.tsx`),{__esModule:i,$$typeof:s}=r,o=r.default},1972:()=>{},5023:()=>{}};var t=require("../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[73],()=>n(9555));module.exports=r})();